
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../tips_and_tricks/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Reference 📚 - ALSEK</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ALSEK" class="md-header__button md-logo" aria-label="ALSEK" data-md-component="logo">
      
  <img src="../assets/images/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ALSEK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference 📚
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/TariqAHassan/alsek" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ALSEK" class="md-nav__button md-logo" aria-label="ALSEK" data-md-component="logo">
      
  <img src="../assets/images/favicon.ico" alt="logo">

    </a>
    ALSEK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TariqAHassan/alsek" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alsek ⛰
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../guided_tour/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guided tour
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tips_and_tricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tips &amp; Tricks ⛷️
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Reference 📚
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Reference 📚
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#alsek" class="md-nav__link">
    <span class="md-ellipsis">
      alsek
    </span>
  </a>
  
    <nav class="md-nav" aria-label="alsek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli.process_pool" class="md-nav__link">
    <span class="md-ellipsis">
      process_pool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli.thread_pool" class="md-nav__link">
    <span class="md-ellipsis">
      thread_pool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.cli.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli.helpers.package2path" class="md-nav__link">
    <span class="md-ellipsis">
      package2path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core" class="md-nav__link">
    <span class="md-ellipsis">
      core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff" class="md-nav__link">
    <span class="md-ellipsis">
      backoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="backoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff" class="md-nav__link">
    <span class="md-ellipsis">
      Backoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.settings" class="md-nav__link">
    <span class="md-ellipsis">
      settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ConstantBackoff" class="md-nav__link">
    <span class="md-ellipsis">
      ConstantBackoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConstantBackoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ConstantBackoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ConstantBackoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ExponentialBackoff" class="md-nav__link">
    <span class="md-ellipsis">
      ExponentialBackoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExponentialBackoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ExponentialBackoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ExponentialBackoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.LinearBackoff" class="md-nav__link">
    <span class="md-ellipsis">
      LinearBackoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LinearBackoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.LinearBackoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.LinearBackoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.settings2backoff" class="md-nav__link">
    <span class="md-ellipsis">
      settings2backoff
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker" class="md-nav__link">
    <span class="md-ellipsis">
      broker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="broker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker" class="md-nav__link">
    <span class="md-ellipsis">
      Broker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Broker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.ack" class="md-nav__link">
    <span class="md-ellipsis">
      ack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.fail" class="md-nav__link">
    <span class="md-ellipsis">
      fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.in_dlq" class="md-nav__link">
    <span class="md-ellipsis">
      in_dlq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.remove" class="md-nav__link">
    <span class="md-ellipsis">
      remove
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.retry" class="md-nav__link">
    <span class="md-ellipsis">
      retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.submit" class="md-nav__link">
    <span class="md-ellipsis">
      submit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.sync_from_backend" class="md-nav__link">
    <span class="md-ellipsis">
      sync_from_backend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.sync_to_backend" class="md-nav__link">
    <span class="md-ellipsis">
      sync_to_backend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      concurrency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="concurrency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock" class="md-nav__link">
    <span class="md-ellipsis">
      Lock
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.full_name" class="md-nav__link">
    <span class="md-ellipsis">
      full_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.held" class="md-nav__link">
    <span class="md-ellipsis">
      held
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.holder" class="md-nav__link">
    <span class="md-ellipsis">
      holder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.acquire" class="md-nav__link">
    <span class="md-ellipsis">
      acquire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.release" class="md-nav__link">
    <span class="md-ellipsis">
      release
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.ProcessLock" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessLock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.ThreadLock" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadLock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.consumer" class="md-nav__link">
    <span class="md-ellipsis">
      consumer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="consumer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.consumer.Consumer" class="md-nav__link">
    <span class="md-ellipsis">
      Consumer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Consumer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.consumer.Consumer.stream" class="md-nav__link">
    <span class="md-ellipsis">
      stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures" class="md-nav__link">
    <span class="md-ellipsis">
      futures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="futures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ProcessTaskFuture" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessTaskFuture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessTaskFuture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ProcessTaskFuture.complete" class="md-nav__link">
    <span class="md-ellipsis">
      complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ProcessTaskFuture.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture" class="md-nav__link">
    <span class="md-ellipsis">
      TaskFuture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TaskFuture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture.complete" class="md-nav__link">
    <span class="md-ellipsis">
      complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture.time_limit_exceeded" class="md-nav__link">
    <span class="md-ellipsis">
      time_limit_exceeded
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ThreadTaskFuture" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadTaskFuture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ThreadTaskFuture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ThreadTaskFuture.complete" class="md-nav__link">
    <span class="md-ellipsis">
      complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ThreadTaskFuture.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message" class="md-nav__link">
    <span class="md-ellipsis">
      message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message" class="md-nav__link">
    <span class="md-ellipsis">
      Message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.descendant_uuids" class="md-nav__link">
    <span class="md-ellipsis">
      descendant_uuids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.exception_details" class="md-nav__link">
    <span class="md-ellipsis">
      exception_details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.ready" class="md-nav__link">
    <span class="md-ellipsis">
      ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.ready_at" class="md-nav__link">
    <span class="md-ellipsis">
      ready_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.summary" class="md-nav__link">
    <span class="md-ellipsis">
      summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.ttr" class="md-nav__link">
    <span class="md-ellipsis">
      ttr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.add_to_ephemeral_state" class="md-nav__link">
    <span class="md-ellipsis">
      add_to_ephemeral_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.add_to_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      add_to_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.clone" class="md-nav__link">
    <span class="md-ellipsis">
      clone
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.duplicate" class="md-nav__link">
    <span class="md-ellipsis">
      duplicate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.get_backoff_duration" class="md-nav__link">
    <span class="md-ellipsis">
      get_backoff_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.increment_retries" class="md-nav__link">
    <span class="md-ellipsis">
      increment_retries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.link_lock" class="md-nav__link">
    <span class="md-ellipsis">
      link_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.release_lock" class="md-nav__link">
    <span class="md-ellipsis">
      release_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
    <nav class="md-nav" aria-label="status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.abstract" class="md-nav__link">
    <span class="md-ellipsis">
      abstract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="abstract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.abstract.BaseStatusTracker" class="md-nav__link">
    <span class="md-ellipsis">
      BaseStatusTracker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="asyncio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.asyncio.AsyncStatusTracker" class="md-nav__link">
    <span class="md-ellipsis">
      AsyncStatusTracker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.integrity" class="md-nav__link">
    <span class="md-ellipsis">
      integrity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="integrity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.integrity.StatusTrackerIntegrityScanner" class="md-nav__link">
    <span class="md-ellipsis">
      StatusTrackerIntegrityScanner
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.standard" class="md-nav__link">
    <span class="md-ellipsis">
      standard
    </span>
  </a>
  
    <nav class="md-nav" aria-label="standard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.standard.StatusTracker" class="md-nav__link">
    <span class="md-ellipsis">
      StatusTracker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.types" class="md-nav__link">
    <span class="md-ellipsis">
      types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.types.StatusUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      StatusUpdate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.types.TaskStatus" class="md-nav__link">
    <span class="md-ellipsis">
      TaskStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task" class="md-nav__link">
    <span class="md-ellipsis">
      task
    </span>
  </a>
  
    <nav class="md-nav" aria-label="task">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.deferred" class="md-nav__link">
    <span class="md-ellipsis">
      deferred
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.cancel_defer" class="md-nav__link">
    <span class="md-ellipsis">
      cancel_defer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.defer" class="md-nav__link">
    <span class="md-ellipsis">
      defer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.do_callback" class="md-nav__link">
    <span class="md-ellipsis">
      do_callback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.do_retry" class="md-nav__link">
    <span class="md-ellipsis">
      do_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.is_revoked" class="md-nav__link">
    <span class="md-ellipsis">
      is_revoked
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_failure" class="md-nav__link">
    <span class="md-ellipsis">
      on_failure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_retry" class="md-nav__link">
    <span class="md-ellipsis">
      on_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_revocation" class="md-nav__link">
    <span class="md-ellipsis">
      on_revocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_submit" class="md-nav__link">
    <span class="md-ellipsis">
      on_submit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_success" class="md-nav__link">
    <span class="md-ellipsis">
      on_success
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.op" class="md-nav__link">
    <span class="md-ellipsis">
      op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.post_op" class="md-nav__link">
    <span class="md-ellipsis">
      post_op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.pre_op" class="md-nav__link">
    <span class="md-ellipsis">
      pre_op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.revoke" class="md-nav__link">
    <span class="md-ellipsis">
      revoke
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.update_status" class="md-nav__link">
    <span class="md-ellipsis">
      update_status
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask" class="md-nav__link">
    <span class="md-ellipsis">
      TriggerTask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TriggerTask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.generated" class="md-nav__link">
    <span class="md-ellipsis">
      generated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.clear" class="md-nav__link">
    <span class="md-ellipsis">
      clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.pause" class="md-nav__link">
    <span class="md-ellipsis">
      pause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.resume" class="md-nav__link">
    <span class="md-ellipsis">
      resume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.task" class="md-nav__link">
    <span class="md-ellipsis">
      task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker" class="md-nav__link">
    <span class="md-ellipsis">
      worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.process.ProcessWorkerPool" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessWorkerPool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread" class="md-nav__link">
    <span class="md-ellipsis">
      thread
    </span>
  </a>
  
    <nav class="md-nav" aria-label="thread">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread.ProcessGroup" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessGroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread.ThreadWorkerPool" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadWorkerPool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread.ThreadsInProcessGroup" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadsInProcessGroup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.defaults" class="md-nav__link">
    <span class="md-ellipsis">
      defaults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      exceptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="exceptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.AlsekError" class="md-nav__link">
    <span class="md-ellipsis">
      AlsekError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.MessageAlreadyExistsError" class="md-nav__link">
    <span class="md-ellipsis">
      MessageAlreadyExistsError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.MessageDoesNotExistsError" class="md-nav__link">
    <span class="md-ellipsis">
      MessageDoesNotExistsError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.MultipleBrokersError" class="md-nav__link">
    <span class="md-ellipsis">
      MultipleBrokersError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.NoTasksFoundError" class="md-nav__link">
    <span class="md-ellipsis">
      NoTasksFoundError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.RevokedError" class="md-nav__link">
    <span class="md-ellipsis">
      RevokedError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.SchedulingError" class="md-nav__link">
    <span class="md-ellipsis">
      SchedulingError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.TaskNameCollisionError" class="md-nav__link">
    <span class="md-ellipsis">
      TaskNameCollisionError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.TerminationError" class="md-nav__link">
    <span class="md-ellipsis">
      TerminationError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.ValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      ValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage" class="md-nav__link">
    <span class="md-ellipsis">
      storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends" class="md-nav__link">
    <span class="md-ellipsis">
      backends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.abstract" class="md-nav__link">
    <span class="md-ellipsis">
      abstract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="abstract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.abstract.BaseBackend" class="md-nav__link">
    <span class="md-ellipsis">
      BaseBackend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.lazy" class="md-nav__link">
    <span class="md-ellipsis">
      lazy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lazy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.lazy.LazyClient" class="md-nav__link">
    <span class="md-ellipsis">
      LazyClient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.redis" class="md-nav__link">
    <span class="md-ellipsis">
      redis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="redis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.redis.asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.redis.standard" class="md-nav__link">
    <span class="md-ellipsis">
      standard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore" class="md-nav__link">
    <span class="md-ellipsis">
      ResultStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResultStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.get_storage_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_storage_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization" class="md-nav__link">
    <span class="md-ellipsis">
      serialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="serialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.BinarySerializer" class="md-nav__link">
    <span class="md-ellipsis">
      BinarySerializer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BinarySerializer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.BinarySerializer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.BinarySerializer.reverse" class="md-nav__link">
    <span class="md-ellipsis">
      reverse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.JsonSerializer" class="md-nav__link">
    <span class="md-ellipsis">
      JsonSerializer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JsonSerializer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.JsonSerializer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.JsonSerializer.reverse" class="md-nav__link">
    <span class="md-ellipsis">
      reverse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.Serializer" class="md-nav__link">
    <span class="md-ellipsis">
      Serializer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Serializer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.Serializer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.Serializer.reverse" class="md-nav__link">
    <span class="md-ellipsis">
      reverse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.tools" class="md-nav__link">
    <span class="md-ellipsis">
      tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration" class="md-nav__link">
    <span class="md-ellipsis">
      iteration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iteration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration.ResultPool" class="md-nav__link">
    <span class="md-ellipsis">
      ResultPool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResultPool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration.ResultPool.istream" class="md-nav__link">
    <span class="md-ellipsis">
      istream
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration.ResultPool.stream" class="md-nav__link">
    <span class="md-ellipsis">
      stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.types" class="md-nav__link">
    <span class="md-ellipsis">
      types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.types.Empty" class="md-nav__link">
    <span class="md-ellipsis">
      Empty
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      aggregation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aggregation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.aggregation.gather_init_params" class="md-nav__link">
    <span class="md-ellipsis">
      gather_init_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.checks" class="md-nav__link">
    <span class="md-ellipsis">
      checks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.checks.has_duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      has_duplicates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.decorators" class="md-nav__link">
    <span class="md-ellipsis">
      decorators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging" class="md-nav__link">
    <span class="md-ellipsis">
      logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging.magic_logger" class="md-nav__link">
    <span class="md-ellipsis">
      magic_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing" class="md-nav__link">
    <span class="md-ellipsis">
      namespacing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="namespacing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_dlq_message_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_dlq_message_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_message_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_message_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_message_signature" class="md-nav__link">
    <span class="md-ellipsis">
      get_message_signature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_messages_namespace" class="md-nav__link">
    <span class="md-ellipsis">
      get_messages_namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_priority_namespace" class="md-nav__link">
    <span class="md-ellipsis">
      get_priority_namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_priority_namespace_from_message" class="md-nav__link">
    <span class="md-ellipsis">
      get_priority_namespace_from_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_subnamespace" class="md-nav__link">
    <span class="md-ellipsis">
      get_subnamespace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing" class="md-nav__link">
    <span class="md-ellipsis">
      parsing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parsing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.ExceptionDetails" class="md-nav__link">
    <span class="md-ellipsis">
      ExceptionDetails
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExceptionDetails">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.ExceptionDetails.as_dict" class="md-nav__link">
    <span class="md-ellipsis">
      as_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.ExceptionDetails.as_exception" class="md-nav__link">
    <span class="md-ellipsis">
      as_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.get_exception_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_exception_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.parse_exception" class="md-nav__link">
    <span class="md-ellipsis">
      parse_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.printing" class="md-nav__link">
    <span class="md-ellipsis">
      printing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="printing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.printing.auto_repr" class="md-nav__link">
    <span class="md-ellipsis">
      auto_repr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.scanning" class="md-nav__link">
    <span class="md-ellipsis">
      scanning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scanning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.scanning.collect_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      collect_tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.sorting" class="md-nav__link">
    <span class="md-ellipsis">
      sorting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sorting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.sorting.dict_sort" class="md-nav__link">
    <span class="md-ellipsis">
      dict_sort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.string" class="md-nav__link">
    <span class="md-ellipsis">
      string
    </span>
  </a>
  
    <nav class="md-nav" aria-label="string">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.string.smart_join" class="md-nav__link">
    <span class="md-ellipsis">
      smart_join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system" class="md-nav__link">
    <span class="md-ellipsis">
      system
    </span>
  </a>
  
    <nav class="md-nav" aria-label="system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.StopSignalListener" class="md-nav__link">
    <span class="md-ellipsis">
      StopSignalListener
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StopSignalListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.StopSignalListener.received" class="md-nav__link">
    <span class="md-ellipsis">
      received
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.StopSignalListener.wait" class="md-nav__link">
    <span class="md-ellipsis">
      wait
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.smart_cpu_count" class="md-nav__link">
    <span class="md-ellipsis">
      smart_cpu_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.thread_raise" class="md-nav__link">
    <span class="md-ellipsis">
      thread_raise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal" class="md-nav__link">
    <span class="md-ellipsis">
      temporal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="temporal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal.from_timestamp_ms" class="md-nav__link">
    <span class="md-ellipsis">
      from_timestamp_ms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal.time_ms" class="md-nav__link">
    <span class="md-ellipsis">
      time_ms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal.utcnow_timestamp_ms" class="md-nav__link">
    <span class="md-ellipsis">
      utcnow_timestamp_ms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.waiting" class="md-nav__link">
    <span class="md-ellipsis">
      waiting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="waiting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.waiting.waiter" class="md-nav__link">
    <span class="md-ellipsis">
      waiter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#alsek" class="md-nav__link">
    <span class="md-ellipsis">
      alsek
    </span>
  </a>
  
    <nav class="md-nav" aria-label="alsek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli.process_pool" class="md-nav__link">
    <span class="md-ellipsis">
      process_pool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.cli.cli.thread_pool" class="md-nav__link">
    <span class="md-ellipsis">
      thread_pool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.cli.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.cli.helpers.package2path" class="md-nav__link">
    <span class="md-ellipsis">
      package2path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core" class="md-nav__link">
    <span class="md-ellipsis">
      core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff" class="md-nav__link">
    <span class="md-ellipsis">
      backoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="backoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff" class="md-nav__link">
    <span class="md-ellipsis">
      Backoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.settings" class="md-nav__link">
    <span class="md-ellipsis">
      settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.Backoff.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ConstantBackoff" class="md-nav__link">
    <span class="md-ellipsis">
      ConstantBackoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConstantBackoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ConstantBackoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ConstantBackoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ExponentialBackoff" class="md-nav__link">
    <span class="md-ellipsis">
      ExponentialBackoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExponentialBackoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ExponentialBackoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.ExponentialBackoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.LinearBackoff" class="md-nav__link">
    <span class="md-ellipsis">
      LinearBackoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LinearBackoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.LinearBackoff.parameters" class="md-nav__link">
    <span class="md-ellipsis">
      parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.LinearBackoff.formula" class="md-nav__link">
    <span class="md-ellipsis">
      formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.backoff.settings2backoff" class="md-nav__link">
    <span class="md-ellipsis">
      settings2backoff
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker" class="md-nav__link">
    <span class="md-ellipsis">
      broker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="broker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker" class="md-nav__link">
    <span class="md-ellipsis">
      Broker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Broker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.ack" class="md-nav__link">
    <span class="md-ellipsis">
      ack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.fail" class="md-nav__link">
    <span class="md-ellipsis">
      fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.in_dlq" class="md-nav__link">
    <span class="md-ellipsis">
      in_dlq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.remove" class="md-nav__link">
    <span class="md-ellipsis">
      remove
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.retry" class="md-nav__link">
    <span class="md-ellipsis">
      retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.submit" class="md-nav__link">
    <span class="md-ellipsis">
      submit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.sync_from_backend" class="md-nav__link">
    <span class="md-ellipsis">
      sync_from_backend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.broker.Broker.sync_to_backend" class="md-nav__link">
    <span class="md-ellipsis">
      sync_to_backend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      concurrency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="concurrency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock" class="md-nav__link">
    <span class="md-ellipsis">
      Lock
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.full_name" class="md-nav__link">
    <span class="md-ellipsis">
      full_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.held" class="md-nav__link">
    <span class="md-ellipsis">
      held
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.holder" class="md-nav__link">
    <span class="md-ellipsis">
      holder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.acquire" class="md-nav__link">
    <span class="md-ellipsis">
      acquire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.Lock.release" class="md-nav__link">
    <span class="md-ellipsis">
      release
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.ProcessLock" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessLock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.concurrency.ThreadLock" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadLock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.consumer" class="md-nav__link">
    <span class="md-ellipsis">
      consumer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="consumer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.consumer.Consumer" class="md-nav__link">
    <span class="md-ellipsis">
      Consumer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Consumer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.consumer.Consumer.stream" class="md-nav__link">
    <span class="md-ellipsis">
      stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures" class="md-nav__link">
    <span class="md-ellipsis">
      futures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="futures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ProcessTaskFuture" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessTaskFuture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessTaskFuture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ProcessTaskFuture.complete" class="md-nav__link">
    <span class="md-ellipsis">
      complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ProcessTaskFuture.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture" class="md-nav__link">
    <span class="md-ellipsis">
      TaskFuture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TaskFuture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture.complete" class="md-nav__link">
    <span class="md-ellipsis">
      complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture.time_limit_exceeded" class="md-nav__link">
    <span class="md-ellipsis">
      time_limit_exceeded
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.TaskFuture.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ThreadTaskFuture" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadTaskFuture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ThreadTaskFuture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ThreadTaskFuture.complete" class="md-nav__link">
    <span class="md-ellipsis">
      complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.futures.ThreadTaskFuture.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message" class="md-nav__link">
    <span class="md-ellipsis">
      message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message" class="md-nav__link">
    <span class="md-ellipsis">
      Message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.descendant_uuids" class="md-nav__link">
    <span class="md-ellipsis">
      descendant_uuids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.exception_details" class="md-nav__link">
    <span class="md-ellipsis">
      exception_details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.ready" class="md-nav__link">
    <span class="md-ellipsis">
      ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.ready_at" class="md-nav__link">
    <span class="md-ellipsis">
      ready_at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.summary" class="md-nav__link">
    <span class="md-ellipsis">
      summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.ttr" class="md-nav__link">
    <span class="md-ellipsis">
      ttr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.add_to_ephemeral_state" class="md-nav__link">
    <span class="md-ellipsis">
      add_to_ephemeral_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.add_to_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      add_to_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.clone" class="md-nav__link">
    <span class="md-ellipsis">
      clone
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.duplicate" class="md-nav__link">
    <span class="md-ellipsis">
      duplicate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.get_backoff_duration" class="md-nav__link">
    <span class="md-ellipsis">
      get_backoff_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.increment_retries" class="md-nav__link">
    <span class="md-ellipsis">
      increment_retries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.link_lock" class="md-nav__link">
    <span class="md-ellipsis">
      link_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.release_lock" class="md-nav__link">
    <span class="md-ellipsis">
      release_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.message.Message.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
    <nav class="md-nav" aria-label="status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.abstract" class="md-nav__link">
    <span class="md-ellipsis">
      abstract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="abstract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.abstract.BaseStatusTracker" class="md-nav__link">
    <span class="md-ellipsis">
      BaseStatusTracker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="asyncio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.asyncio.AsyncStatusTracker" class="md-nav__link">
    <span class="md-ellipsis">
      AsyncStatusTracker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.integrity" class="md-nav__link">
    <span class="md-ellipsis">
      integrity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="integrity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.integrity.StatusTrackerIntegrityScanner" class="md-nav__link">
    <span class="md-ellipsis">
      StatusTrackerIntegrityScanner
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.standard" class="md-nav__link">
    <span class="md-ellipsis">
      standard
    </span>
  </a>
  
    <nav class="md-nav" aria-label="standard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.standard.StatusTracker" class="md-nav__link">
    <span class="md-ellipsis">
      StatusTracker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.types" class="md-nav__link">
    <span class="md-ellipsis">
      types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.types.StatusUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      StatusUpdate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.status.types.TaskStatus" class="md-nav__link">
    <span class="md-ellipsis">
      TaskStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task" class="md-nav__link">
    <span class="md-ellipsis">
      task
    </span>
  </a>
  
    <nav class="md-nav" aria-label="task">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.deferred" class="md-nav__link">
    <span class="md-ellipsis">
      deferred
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.cancel_defer" class="md-nav__link">
    <span class="md-ellipsis">
      cancel_defer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.defer" class="md-nav__link">
    <span class="md-ellipsis">
      defer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.do_callback" class="md-nav__link">
    <span class="md-ellipsis">
      do_callback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.do_retry" class="md-nav__link">
    <span class="md-ellipsis">
      do_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.is_revoked" class="md-nav__link">
    <span class="md-ellipsis">
      is_revoked
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_failure" class="md-nav__link">
    <span class="md-ellipsis">
      on_failure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_retry" class="md-nav__link">
    <span class="md-ellipsis">
      on_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_revocation" class="md-nav__link">
    <span class="md-ellipsis">
      on_revocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_submit" class="md-nav__link">
    <span class="md-ellipsis">
      on_submit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.on_success" class="md-nav__link">
    <span class="md-ellipsis">
      on_success
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.op" class="md-nav__link">
    <span class="md-ellipsis">
      op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.post_op" class="md-nav__link">
    <span class="md-ellipsis">
      post_op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.pre_op" class="md-nav__link">
    <span class="md-ellipsis">
      pre_op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.revoke" class="md-nav__link">
    <span class="md-ellipsis">
      revoke
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.Task.update_status" class="md-nav__link">
    <span class="md-ellipsis">
      update_status
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask" class="md-nav__link">
    <span class="md-ellipsis">
      TriggerTask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TriggerTask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.generated" class="md-nav__link">
    <span class="md-ellipsis">
      generated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.clear" class="md-nav__link">
    <span class="md-ellipsis">
      clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.pause" class="md-nav__link">
    <span class="md-ellipsis">
      pause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.resume" class="md-nav__link">
    <span class="md-ellipsis">
      resume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.TriggerTask.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.task.task" class="md-nav__link">
    <span class="md-ellipsis">
      task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker" class="md-nav__link">
    <span class="md-ellipsis">
      worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.process.ProcessWorkerPool" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessWorkerPool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread" class="md-nav__link">
    <span class="md-ellipsis">
      thread
    </span>
  </a>
  
    <nav class="md-nav" aria-label="thread">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread.ProcessGroup" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessGroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread.ThreadWorkerPool" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadWorkerPool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.core.worker.thread.ThreadsInProcessGroup" class="md-nav__link">
    <span class="md-ellipsis">
      ThreadsInProcessGroup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.defaults" class="md-nav__link">
    <span class="md-ellipsis">
      defaults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      exceptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="exceptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.AlsekError" class="md-nav__link">
    <span class="md-ellipsis">
      AlsekError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.MessageAlreadyExistsError" class="md-nav__link">
    <span class="md-ellipsis">
      MessageAlreadyExistsError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.MessageDoesNotExistsError" class="md-nav__link">
    <span class="md-ellipsis">
      MessageDoesNotExistsError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.MultipleBrokersError" class="md-nav__link">
    <span class="md-ellipsis">
      MultipleBrokersError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.NoTasksFoundError" class="md-nav__link">
    <span class="md-ellipsis">
      NoTasksFoundError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.RevokedError" class="md-nav__link">
    <span class="md-ellipsis">
      RevokedError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.SchedulingError" class="md-nav__link">
    <span class="md-ellipsis">
      SchedulingError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.TaskNameCollisionError" class="md-nav__link">
    <span class="md-ellipsis">
      TaskNameCollisionError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.TerminationError" class="md-nav__link">
    <span class="md-ellipsis">
      TerminationError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.exceptions.ValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      ValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage" class="md-nav__link">
    <span class="md-ellipsis">
      storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends" class="md-nav__link">
    <span class="md-ellipsis">
      backends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.abstract" class="md-nav__link">
    <span class="md-ellipsis">
      abstract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="abstract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.abstract.BaseBackend" class="md-nav__link">
    <span class="md-ellipsis">
      BaseBackend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.lazy" class="md-nav__link">
    <span class="md-ellipsis">
      lazy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lazy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.lazy.LazyClient" class="md-nav__link">
    <span class="md-ellipsis">
      LazyClient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.redis" class="md-nav__link">
    <span class="md-ellipsis">
      redis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="redis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.redis.asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.backends.redis.standard" class="md-nav__link">
    <span class="md-ellipsis">
      standard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore" class="md-nav__link">
    <span class="md-ellipsis">
      ResultStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResultStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.get_storage_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_storage_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.result.ResultStore.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization" class="md-nav__link">
    <span class="md-ellipsis">
      serialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="serialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.BinarySerializer" class="md-nav__link">
    <span class="md-ellipsis">
      BinarySerializer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BinarySerializer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.BinarySerializer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.BinarySerializer.reverse" class="md-nav__link">
    <span class="md-ellipsis">
      reverse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.JsonSerializer" class="md-nav__link">
    <span class="md-ellipsis">
      JsonSerializer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JsonSerializer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.JsonSerializer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.JsonSerializer.reverse" class="md-nav__link">
    <span class="md-ellipsis">
      reverse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.Serializer" class="md-nav__link">
    <span class="md-ellipsis">
      Serializer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Serializer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.Serializer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.storage.serialization.Serializer.reverse" class="md-nav__link">
    <span class="md-ellipsis">
      reverse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.tools" class="md-nav__link">
    <span class="md-ellipsis">
      tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration" class="md-nav__link">
    <span class="md-ellipsis">
      iteration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iteration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration.ResultPool" class="md-nav__link">
    <span class="md-ellipsis">
      ResultPool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResultPool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration.ResultPool.istream" class="md-nav__link">
    <span class="md-ellipsis">
      istream
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.tools.iteration.ResultPool.stream" class="md-nav__link">
    <span class="md-ellipsis">
      stream
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.types" class="md-nav__link">
    <span class="md-ellipsis">
      types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.types.Empty" class="md-nav__link">
    <span class="md-ellipsis">
      Empty
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      aggregation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aggregation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.aggregation.gather_init_params" class="md-nav__link">
    <span class="md-ellipsis">
      gather_init_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.checks" class="md-nav__link">
    <span class="md-ellipsis">
      checks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.checks.has_duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      has_duplicates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.decorators" class="md-nav__link">
    <span class="md-ellipsis">
      decorators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging" class="md-nav__link">
    <span class="md-ellipsis">
      logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging.magic_logger" class="md-nav__link">
    <span class="md-ellipsis">
      magic_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.logging.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing" class="md-nav__link">
    <span class="md-ellipsis">
      namespacing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="namespacing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_dlq_message_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_dlq_message_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_message_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_message_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_message_signature" class="md-nav__link">
    <span class="md-ellipsis">
      get_message_signature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_messages_namespace" class="md-nav__link">
    <span class="md-ellipsis">
      get_messages_namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_priority_namespace" class="md-nav__link">
    <span class="md-ellipsis">
      get_priority_namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_priority_namespace_from_message" class="md-nav__link">
    <span class="md-ellipsis">
      get_priority_namespace_from_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.namespacing.get_subnamespace" class="md-nav__link">
    <span class="md-ellipsis">
      get_subnamespace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing" class="md-nav__link">
    <span class="md-ellipsis">
      parsing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parsing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.ExceptionDetails" class="md-nav__link">
    <span class="md-ellipsis">
      ExceptionDetails
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExceptionDetails">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.ExceptionDetails.as_dict" class="md-nav__link">
    <span class="md-ellipsis">
      as_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.ExceptionDetails.as_exception" class="md-nav__link">
    <span class="md-ellipsis">
      as_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.get_exception_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_exception_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.parsing.parse_exception" class="md-nav__link">
    <span class="md-ellipsis">
      parse_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.printing" class="md-nav__link">
    <span class="md-ellipsis">
      printing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="printing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.printing.auto_repr" class="md-nav__link">
    <span class="md-ellipsis">
      auto_repr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.scanning" class="md-nav__link">
    <span class="md-ellipsis">
      scanning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scanning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.scanning.collect_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      collect_tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.sorting" class="md-nav__link">
    <span class="md-ellipsis">
      sorting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sorting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.sorting.dict_sort" class="md-nav__link">
    <span class="md-ellipsis">
      dict_sort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.string" class="md-nav__link">
    <span class="md-ellipsis">
      string
    </span>
  </a>
  
    <nav class="md-nav" aria-label="string">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.string.smart_join" class="md-nav__link">
    <span class="md-ellipsis">
      smart_join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system" class="md-nav__link">
    <span class="md-ellipsis">
      system
    </span>
  </a>
  
    <nav class="md-nav" aria-label="system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.StopSignalListener" class="md-nav__link">
    <span class="md-ellipsis">
      StopSignalListener
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StopSignalListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.StopSignalListener.received" class="md-nav__link">
    <span class="md-ellipsis">
      received
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.StopSignalListener.wait" class="md-nav__link">
    <span class="md-ellipsis">
      wait
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.smart_cpu_count" class="md-nav__link">
    <span class="md-ellipsis">
      smart_cpu_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.system.thread_raise" class="md-nav__link">
    <span class="md-ellipsis">
      thread_raise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal" class="md-nav__link">
    <span class="md-ellipsis">
      temporal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="temporal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal.from_timestamp_ms" class="md-nav__link">
    <span class="md-ellipsis">
      from_timestamp_ms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal.time_ms" class="md-nav__link">
    <span class="md-ellipsis">
      time_ms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.temporal.utcnow_timestamp_ms" class="md-nav__link">
    <span class="md-ellipsis">
      utcnow_timestamp_ms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alsek.utils.waiting" class="md-nav__link">
    <span class="md-ellipsis">
      waiting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="waiting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alsek.utils.waiting.waiter" class="md-nav__link">
    <span class="md-ellipsis">
      waiter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="reference">Reference 📚</h1>


<div class="doc doc-object doc-module">



<h2 id="alsek" class="doc doc-heading">
            <code>alsek</code>


</h2>

    <div class="doc doc-contents first">

        <p>Alsek</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="alsek.cli" class="doc doc-heading">
            <code>cli</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="alsek.cli.cli" class="doc doc-heading">
            <code>cli</code>


</h4>

    <div class="doc doc-contents ">

        <p>Command Line Interface</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.cli.cli.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Alsek CLI.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/cli/cli.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">version_option</span><span class="p">(</span><span class="n">__version__</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek CLI.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.cli.cli.process_pool" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_pool</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">queues</span><span class="p">,</span> <span class="n">task_specific_mode</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">,</span> <span class="n">prune_interval</span><span class="p">,</span> <span class="n">slot_wait_interval</span><span class="p">,</span> <span class="n">consumer_backoff_factor</span><span class="p">,</span> <span class="n">consumer_backoff_floor</span><span class="p">,</span> <span class="n">consumer_backoff_ceiling</span><span class="p">,</span> <span class="n">log_level</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Start a process-based worker pool.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/cli/cli.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@main</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;package&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--queues&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma-separated list of queues to consume from.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--task_specific_mode&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Monitor tasks specifically, not just queues.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--n_processes&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Max number of processes.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--prune_interval&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Milliseconds between prune scans.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--slot_wait_interval&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Milliseconds to wait when full.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--consumer_backoff_factor&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Backoff factor in response to passes over the backend &quot;</span>
    <span class="s2">&quot;which yield no messages (milliseconds)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--consumer_backoff_floor&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">1_000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum backoff in response to a pass over the backend&quot;</span>
    <span class="s2">&quot;which yields no message (milliseconds)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--consumer_backoff_ceiling&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">30_000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximum backoff in response to a pass over the backend&quot;</span>
    <span class="s2">&quot;which yields no message (milliseconds)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span><span class="n">LOG_LEVELS</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_pool</span><span class="p">(</span>
    <span class="n">package</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queues</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">task_specific_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">n_processes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">prune_interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">slot_wait_interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">consumer_backoff_factor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">consumer_backoff_floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">consumer_backoff_ceiling</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start a process-based worker pool.&quot;&quot;&quot;</span>
    <span class="n">_apply_logging_level</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">ProcessWorkerPool</span><span class="p">(</span>
        <span class="n">tasks</span><span class="o">=</span><span class="n">collect_tasks</span><span class="p">(</span><span class="n">package</span><span class="p">),</span>
        <span class="n">queues</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">queues</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">queues</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">task_specific_mode</span><span class="o">=</span><span class="n">task_specific_mode</span><span class="p">,</span>
        <span class="n">n_processes</span><span class="o">=</span><span class="n">n_processes</span><span class="p">,</span>
        <span class="n">prune_interval</span><span class="o">=</span><span class="n">prune_interval</span><span class="p">,</span>
        <span class="n">slot_wait_interval</span><span class="o">=</span><span class="n">slot_wait_interval</span><span class="p">,</span>
        <span class="n">backoff</span><span class="o">=</span><span class="n">LinearBackoff</span><span class="p">(</span>
            <span class="n">factor</span><span class="o">=</span><span class="n">consumer_backoff_factor</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="n">consumer_backoff_floor</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="n">consumer_backoff_ceiling</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.cli.cli.thread_pool" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">thread_pool</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">queues</span><span class="p">,</span> <span class="n">task_specific_mode</span><span class="p">,</span> <span class="n">n_threads</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">,</span> <span class="n">n_process_floor</span><span class="p">,</span> <span class="n">slot_wait_interval</span><span class="p">,</span> <span class="n">complete_only_on_thread_exit</span><span class="p">,</span> <span class="n">consumer_backoff_factor</span><span class="p">,</span> <span class="n">consumer_backoff_floor</span><span class="p">,</span> <span class="n">consumer_backoff_ceiling</span><span class="p">,</span> <span class="n">log_level</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Start a thread-based worker pool.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/cli/cli.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@main</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;package&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--queues&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma-separated list of queues to consume from.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--task_specific_mode&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Monitor tasks specifically, not just queues.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--n_threads&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Threads per group.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--n_processes&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Max process groups.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--n_process_floor&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum number of process groups to keep alive.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--slot_wait_interval&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Milliseconds to wait when full.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--complete_only_on_thread_exit&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Wait for thread exit to mark as complete.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--consumer_backoff_factor&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Backoff factor in response to passes over the backend &quot;</span>
    <span class="s2">&quot;which yield no messages (milliseconds)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--consumer_backoff_floor&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">1_000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum backoff in response to a pass over the backend&quot;</span>
    <span class="s2">&quot;which yields no message (milliseconds)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--consumer_backoff_ceiling&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">30_000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximum backoff in response to a pass over the backend&quot;</span>
    <span class="s2">&quot;which yields no message (milliseconds)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span><span class="n">LOG_LEVELS</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">thread_pool</span><span class="p">(</span>
    <span class="n">package</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queues</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">task_specific_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">n_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">n_processes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">n_process_floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">slot_wait_interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">complete_only_on_thread_exit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">consumer_backoff_factor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">consumer_backoff_floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">consumer_backoff_ceiling</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start a thread-based worker pool.&quot;&quot;&quot;</span>
    <span class="n">_apply_logging_level</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">ThreadWorkerPool</span><span class="p">(</span>
        <span class="n">tasks</span><span class="o">=</span><span class="n">collect_tasks</span><span class="p">(</span><span class="n">package</span><span class="p">),</span>
        <span class="n">queues</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">queues</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">queues</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">task_specific_mode</span><span class="o">=</span><span class="n">task_specific_mode</span><span class="p">,</span>
        <span class="n">n_threads</span><span class="o">=</span><span class="n">n_threads</span><span class="p">,</span>
        <span class="n">n_processes</span><span class="o">=</span><span class="n">n_processes</span><span class="p">,</span>
        <span class="n">n_process_floor</span><span class="o">=</span><span class="n">n_process_floor</span><span class="p">,</span>
        <span class="n">slot_wait_interval</span><span class="o">=</span><span class="n">slot_wait_interval</span><span class="p">,</span>
        <span class="n">complete_only_on_thread_exit</span><span class="o">=</span><span class="n">complete_only_on_thread_exit</span><span class="p">,</span>
        <span class="n">package_name</span><span class="o">=</span><span class="n">package</span><span class="p">,</span>
        <span class="n">backoff</span><span class="o">=</span><span class="n">LinearBackoff</span><span class="p">(</span>
            <span class="n">factor</span><span class="o">=</span><span class="n">consumer_backoff_factor</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="n">consumer_backoff_floor</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="n">consumer_backoff_ceiling</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.cli.helpers" class="doc doc-heading">
            <code>helpers</code>


</h4>

    <div class="doc doc-contents ">

        <p>Helpers</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.cli.helpers.package2path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">package2path</span><span class="p">(</span><span class="n">package</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Convert a Python package name into its corresponding filesystem path.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/cli/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">package2path</span><span class="p">(</span><span class="n">package</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a Python package name into its corresponding filesystem path.&quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">find_spec</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ModuleNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package &#39;</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="k">else</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.core" class="doc doc-heading">
            <code>core</code>


</h3>

    <div class="doc doc-contents ">

        <p>Core</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="alsek.core.backoff" class="doc doc-heading">
            <code>backoff</code>


</h4>

    <div class="doc doc-contents ">

        <p>Backoff Algorithms</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.backoff.Backoff" class="doc doc-heading">
            <code>Backoff</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base backoff class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>floor</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>minimum backoff in milliseconds</p>
              </div>
            </td>
            <td>
                  <code>60 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ceiling</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum backoff in milliseconds</p>
              </div>
            </td>
            <td>
                  <code>60 * 60 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zero_override</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>override backoff to zero if the number
of <code>incidents</code> is zero.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/backoff.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Backoff</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base backoff class.</span>

<span class="sd">    Args:</span>
<span class="sd">        floor (int, optional): minimum backoff in milliseconds</span>
<span class="sd">        ceiling (int, optional): maximum backoff in milliseconds</span>
<span class="sd">        zero_override (bool): override backoff to zero if the number</span>
<span class="sd">            of ``incidents`` is zero.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">floor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">ceiling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">zero_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floor</span> <span class="o">=</span> <span class="n">floor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span> <span class="o">=</span> <span class="n">ceiling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zero_override</span> <span class="o">=</span> <span class="n">zero_override</span>

        <span class="k">if</span> <span class="n">floor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ceiling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">floor</span> <span class="o">&gt;</span> <span class="n">ceiling</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;floor (</span><span class="si">{</span><span class="n">floor</span><span class="si">}</span><span class="s2"> greater than ceiling (</span><span class="si">{</span><span class="n">ceiling</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ceiling</span> <span class="o">&lt;</span> <span class="n">floor</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ceiling (</span><span class="si">{</span><span class="n">ceiling</span><span class="si">}</span><span class="s2">) less than floor (</span><span class="si">{</span><span class="n">floor</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters of the current instance which uniquely</span>
<span class="sd">        characterize it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            params (dict): backoff parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BackoffSettingsType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Settings the current algorithm.</span>

<span class="sd">        Returns:</span>
<span class="sd">            serialization (BackoffSettingsType): summary</span>
<span class="sd">                of the current algorithm and parameters with</span>
<span class="sd">                sufficient information to reconstruct it.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation of the formula for computing the backoff.</span>

<span class="sd">        Args:</span>
<span class="sd">            incidents (int): current number of incidents</span>

<span class="sd">        Returns:</span>
<span class="sd">            int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clipper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">floor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">amount</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">floor</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">amount</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the backoff.</span>

<span class="sd">        Args:</span>
<span class="sd">            incidents (int): current number of incidents</span>

<span class="sd">        Returns:</span>
<span class="sd">            backoff (int): backoff in milliseconds</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_override</span> <span class="ow">and</span> <span class="n">incidents</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clipper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">(</span><span class="n">incidents</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.backoff.Backoff.parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameters</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Parameters of the current instance which uniquely
characterize it.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff parameters</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.backoff.Backoff.settings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">settings</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Settings the current algorithm.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>serialization</code></td>            <td>
                  <code><span title="alsek.core.backoff.BackoffSettingsType">BackoffSettingsType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>summary
of the current algorithm and parameters with
sufficient information to reconstruct it.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.backoff.Backoff.formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">formula</span><span class="p">(</span><span class="n">incidents</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Implementation of the formula for computing the backoff.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>incidents</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current number of incidents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/backoff.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of the formula for computing the backoff.</span>

<span class="sd">    Args:</span>
<span class="sd">        incidents (int): current number of incidents</span>

<span class="sd">    Returns:</span>
<span class="sd">        int</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.backoff.Backoff.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">incidents</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the backoff.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>incidents</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current number of incidents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>backoff</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/backoff.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the backoff.</span>

<span class="sd">    Args:</span>
<span class="sd">        incidents (int): current number of incidents</span>

<span class="sd">    Returns:</span>
<span class="sd">        backoff (int): backoff in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_override</span> <span class="ow">and</span> <span class="n">incidents</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clipper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">(</span><span class="n">incidents</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.backoff.ConstantBackoff" class="doc doc-heading">
            <code>ConstantBackoff</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code></p>


        <p>Constant backoff.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>constant</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>amount of time (in milliseconds) to backoff.</p>
              </div>
            </td>
            <td>
                  <code>60 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to
<code>Backoff</code></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/backoff.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConstantBackoff</span><span class="p">(</span><span class="n">Backoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constant backoff.</span>

<span class="sd">    Args:</span>
<span class="sd">        constant (int): amount of time (in milliseconds) to backoff.</span>
<span class="sd">        **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">            ``Backoff``</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters of the current ``ConstantBackoff``</span>
<span class="sd">        instance which uniquely characterize it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            params (dict): backoff parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">constant</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_override</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constant backoff formula.</span>

<span class="sd">        Implements:</span>

<span class="sd">        $$c$$</span>

<span class="sd">        where $c$ is `constant`.</span>

<span class="sd">        Args:</span>
<span class="sd">            incidents (int): current number of incidents</span>

<span class="sd">        Returns:</span>
<span class="sd">            backoff (int): backoff in milliseconds</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.backoff.ConstantBackoff.parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameters</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Parameters of the current <code>ConstantBackoff</code>
instance which uniquely characterize it.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff parameters</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.backoff.ConstantBackoff.formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">formula</span><span class="p">(</span><span class="n">incidents</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Constant backoff formula.</p>
<p>Implements:</p>
<div class="arithmatex">\[c\]</div>
<p>where <span class="arithmatex">\(c\)</span> is <code>constant</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>incidents</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current number of incidents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>backoff</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/backoff.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constant backoff formula.</span>

<span class="sd">    Implements:</span>

<span class="sd">    $$c$$</span>

<span class="sd">    where $c$ is `constant`.</span>

<span class="sd">    Args:</span>
<span class="sd">        incidents (int): current number of incidents</span>

<span class="sd">    Returns:</span>
<span class="sd">        backoff (int): backoff in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.backoff.ExponentialBackoff" class="doc doc-heading">
            <code>ExponentialBackoff</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code></p>


        <p>Exponential backoff.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>base</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the base of the exponential (milliseconds)</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>factor</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>factor to multiply the result by</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to
<code>Backoff</code></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/backoff.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExponentialBackoff</span><span class="p">(</span><span class="n">Backoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential backoff.</span>

<span class="sd">    Args:</span>
<span class="sd">        base (int): the base of the exponential (milliseconds)</span>
<span class="sd">        factor (int): factor to multiply the result by</span>
<span class="sd">        **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">            ``Backoff``</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10_000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters of the current ``ExponentialBackoff``</span>
<span class="sd">        instance which uniquely characterize it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            params (dict): backoff parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
            <span class="n">factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_override</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exponential backoff formula.</span>

<span class="sd">        Implements:</span>

<span class="sd">        $$f * (b^{i})$$</span>

<span class="sd">        where $f$ is `factor`, $b$ is `base` and $i$ is the number of `incidents`.</span>

<span class="sd">        Args:</span>
<span class="sd">            incidents (int): current number of incidents</span>

<span class="sd">        Returns:</span>
<span class="sd">            backoff (int): backoff in milliseconds</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">**</span><span class="n">incidents</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.backoff.ExponentialBackoff.parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameters</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Parameters of the current <code>ExponentialBackoff</code>
instance which uniquely characterize it.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff parameters</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.backoff.ExponentialBackoff.formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">formula</span><span class="p">(</span><span class="n">incidents</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Exponential backoff formula.</p>
<p>Implements:</p>
<div class="arithmatex">\[f * (b^{i})\]</div>
<p>where <span class="arithmatex">\(f\)</span> is <code>factor</code>, <span class="arithmatex">\(b\)</span> is <code>base</code> and <span class="arithmatex">\(i\)</span> is the number of <code>incidents</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>incidents</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current number of incidents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>backoff</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/backoff.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential backoff formula.</span>

<span class="sd">    Implements:</span>

<span class="sd">    $$f * (b^{i})$$</span>

<span class="sd">    where $f$ is `factor`, $b$ is `base` and $i$ is the number of `incidents`.</span>

<span class="sd">    Args:</span>
<span class="sd">        incidents (int): current number of incidents</span>

<span class="sd">    Returns:</span>
<span class="sd">        backoff (int): backoff in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">**</span><span class="n">incidents</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.backoff.LinearBackoff" class="doc doc-heading">
            <code>LinearBackoff</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code></p>


        <p>Linear backoff.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>factor</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>amount of time (in milliseconds) to add to backoff
after each retry.</p>
              </div>
            </td>
            <td>
                  <code>30 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to
<code>Backoff</code></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/backoff.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LinearBackoff</span><span class="p">(</span><span class="n">Backoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear backoff.</span>

<span class="sd">    Args:</span>
<span class="sd">        factor (int): amount of time (in milliseconds) to add to backoff</span>
<span class="sd">            after each retry.</span>
<span class="sd">        **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">            ``Backoff``</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters of the current ``LinearBackoff``</span>
<span class="sd">        instance which uniquely characterize it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            params (dict): backoff parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ceiling</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_override</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Linear backoff formula.</span>

<span class="sd">        Implements:</span>

<span class="sd">        $$f * i$$</span>

<span class="sd">        where $f$ is `factor` and $i$ is the number of `incidents`.</span>

<span class="sd">        Args:</span>
<span class="sd">            incidents (int): current number of incidents</span>

<span class="sd">        Returns:</span>
<span class="sd">            backoff (int): backoff in milliseconds</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">incidents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.backoff.LinearBackoff.parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameters</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Parameters of the current <code>LinearBackoff</code>
instance which uniquely characterize it.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff parameters</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.backoff.LinearBackoff.formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">formula</span><span class="p">(</span><span class="n">incidents</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Linear backoff formula.</p>
<p>Implements:</p>
<div class="arithmatex">\[f * i\]</div>
<p>where <span class="arithmatex">\(f\)</span> is <code>factor</code> and <span class="arithmatex">\(i\)</span> is the number of <code>incidents</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>incidents</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current number of incidents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>backoff</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/backoff.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incidents</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear backoff formula.</span>

<span class="sd">    Implements:</span>

<span class="sd">    $$f * i$$</span>

<span class="sd">    where $f$ is `factor` and $i$ is the number of `incidents`.</span>

<span class="sd">    Args:</span>
<span class="sd">        incidents (int): current number of incidents</span>

<span class="sd">    Returns:</span>
<span class="sd">        backoff (int): backoff in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">incidents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="alsek.core.backoff.settings2backoff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">settings2backoff</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Convert backoff settings to a <code>Backoff</code> instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="alsek.core.backoff.BackoffSettingsType">BackoffSettingsType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff settings of
the form <code>{"algorithm": str, "parameters": dict}</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>backoff</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a backoff instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/backoff.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">settings2backoff</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="n">BackoffSettingsType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Backoff</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert backoff settings to a ``Backoff`` instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        settings (BackoffSettingsType): backoff settings of</span>
<span class="sd">            the form ``{&quot;algorithm&quot;: str, &quot;parameters&quot;: dict}``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        backoff (Backoff): a backoff instance</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">_get_algorithm</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">algorithm</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.broker" class="doc doc-heading">
            <code>broker</code>


</h4>

    <div class="doc doc-contents ">

        <p>Broker</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.broker.Broker" class="doc doc-heading">
            <code>Broker</code>


</h5>


    <div class="doc doc-contents ">


        <p>Alsek Broker.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
                  <code><span title="alsek.storage.backends.abstract.Backend">Backend</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backend for data storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dlq_ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live (in milliseconds) for
Dead Letter Queue (DLQ). If <code>None</code>, failed messages
will not be moved to the DLQ.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TTL">DEFAULT_TTL</span></code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/broker.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Broker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek Broker.</span>

<span class="sd">    Args:</span>
<span class="sd">        backend (Backend): backend for data storage</span>
<span class="sd">        dlq_ttl (int, optional): time to live (in milliseconds) for</span>
<span class="sd">            Dead Letter Queue (DLQ). If ``None``, failed messages</span>
<span class="sd">            will not be moved to the DLQ.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">,</span> <span class="n">dlq_ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TTL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlq_ttl</span> <span class="o">=</span> <span class="n">dlq_ttl</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">IS_ASYNC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Asynchronous backends are not yet supported&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">dlq_ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dlq_ttl</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">gather_init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">,))</span>
        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">settings</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Broker</span><span class="p">:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">backend_data</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">][</span><span class="s2">&quot;encoding&quot;</span><span class="p">])</span>
        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">][</span><span class="s2">&quot;cls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">from_settings</span><span class="p">(</span>
            <span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if the message exists in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            exists (bool): whether the message exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Submitting </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Submitted </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TTL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit a message for processing.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            ttl (int): time to live for the submitted message in milliseconds</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            MessageAlreadyExistsError: if the message already exists</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MessageAlreadyExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; found in backend&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">priority_add</span><span class="p">(</span>
            <span class="n">get_priority_namespace_from_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">unique_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrying </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retry a message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Warning:</span>
<span class="sd">            * This method will mutate ``message`` by incrementing it.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MessageDoesNotExistsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; not found in backend&quot;</span>
            <span class="p">)</span>

        <span class="c1"># We release the lock before setting the messate data</span>
        <span class="c1"># so that the `linked_lock` field on the message ie None.</span>
        <span class="n">message</span><span class="o">.</span><span class="n">release_lock</span><span class="p">(</span>
            <span class="n">not_linked_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">target_backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">message</span><span class="o">.</span><span class="n">increment_retries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Retrying </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2"> ms...&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
            <span class="nb">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_backoff_duration</span><span class="p">(),</span> <span class="s2">&quot;,&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a message from the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">priority_remove</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="n">get_priority_namespace_from_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">unique_id</span><span class="o">=</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">message</span><span class="o">.</span><span class="n">release_lock</span><span class="p">(</span>
            <span class="n">not_linked_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">target_backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Acking </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Acked </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Acknowledge a message by removing it from the data backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): a message to acknowledge</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Warning:</span>
<span class="sd">            * Messages will not be redelivered once acked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failing </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Acknowledge and fail a message by removing it from the backend.</span>
<span class="sd">        If ``dlq_ttl`` is not null, the messages will be persisted to</span>
<span class="sd">        the dead letter queue for the prescribed amount of time.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlq_ttl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
                <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dlq_ttl</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">%s</span><span class="s2"> to DLQ.&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failing </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">in_dlq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if a message is in the dead letter queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: whether the message is in the DLQ.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Syncing from backend </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Synced from backend </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sync_from_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronize a message&#39;s internal data with that in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            updated_message (Message): the updated message data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">Empty</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">Empty</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Syncing </span><span class="si">%s</span><span class="s2"> to backend...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Synced </span><span class="si">%s</span><span class="s2"> to backend.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sync_to_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronize the data persisted in the backend with the current state of</span>
<span class="sd">        ``message`` held in memory.</span>

<span class="sd">        This method is the logical inverse of ``sync_from_backend``; any changes</span>
<span class="sd">        made to the ``message`` instance are written back to the backend so that</span>
<span class="sd">        future reads reflect the most up-to-date information.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message whose current state should be</span>
<span class="sd">                persisted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Warning:</span>
<span class="sd">            * This method will mutate ``message`` by updating it</span>
<span class="sd">              regardless of whether a lock is linked to it.</span>
<span class="sd">              You are responsible for ensuring that any mutation</span>
<span class="sd">              of the message&#39;s underlying data is only performed</span>
<span class="sd">              by the lock owner.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine which key (regular queue or DLQ) should be updated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dlq</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MessageDoesNotExistsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; not found in backend&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Persist the updated message data. We intentionally omit a TTL value</span>
        <span class="c1"># to preserve the existing expiry associated with ``key`` (if any).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.ack" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ack</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Acknowledge a message by removing it from the data backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a message to acknowledge</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Messages will not be redelivered once acked.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Acking </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Acked </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acknowledge a message by removing it from the data backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): a message to acknowledge</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Messages will not be redelivered once acked.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Determine if the message exists in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>exists</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the message exists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if the message exists in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        exists (bool): whether the message exists.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.fail" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fail</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Acknowledge and fail a message by removing it from the backend.
If <code>dlq_ttl</code> is not null, the messages will be persisted to
the dead letter queue for the prescribed amount of time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failing </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acknowledge and fail a message by removing it from the backend.</span>
<span class="sd">    If ``dlq_ttl`` is not null, the messages will be persisted to</span>
<span class="sd">    the dead letter queue for the prescribed amount of time.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlq_ttl</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dlq_ttl</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">%s</span><span class="s2"> to DLQ.&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.in_dlq" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">in_dlq</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Determine if a message is in the dead letter queue.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the message is in the DLQ.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failing </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">in_dlq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a message is in the dead letter queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: whether the message is in the DLQ.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Remove a message from the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a message from the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">priority_remove</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="n">get_priority_namespace_from_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">unique_id</span><span class="o">=</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">release_lock</span><span class="p">(</span>
        <span class="n">not_linked_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">target_backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.retry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">retry</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Retry a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>This method will mutate <code>message</code> by incrementing it.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrying </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retry a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Warning:</span>
<span class="sd">        * This method will mutate ``message`` by incrementing it.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MessageDoesNotExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; not found in backend&quot;</span>
        <span class="p">)</span>

    <span class="c1"># We release the lock before setting the messate data</span>
    <span class="c1"># so that the `linked_lock` field on the message ie None.</span>
    <span class="n">message</span><span class="o">.</span><span class="n">release_lock</span><span class="p">(</span>
        <span class="n">not_linked_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">target_backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">increment_retries</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Retrying </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2"> ms...&quot;</span><span class="p">,</span>
        <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_backoff_duration</span><span class="p">(),</span> <span class="s2">&quot;,&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.submit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">DEFAULT_TTL</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Submit a message for processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live for the submitted message in milliseconds</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TTL">DEFAULT_TTL</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="MessageAlreadyExistsError (alsek.exceptions.MessageAlreadyExistsError)" href="#alsek.exceptions.MessageAlreadyExistsError">MessageAlreadyExistsError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the message already exists</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Submitting </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Submitted </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TTL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submit a message for processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        ttl (int): time to live for the submitted message in milliseconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        MessageAlreadyExistsError: if the message already exists</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MessageAlreadyExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; found in backend&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">priority_add</span><span class="p">(</span>
        <span class="n">get_priority_namespace_from_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">unique_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.sync_from_backend" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sync_from_backend</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Synchronize a message's internal data with that in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>updated_message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the updated message data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Syncing from backend </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Synced from backend </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sync_from_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Synchronize a message&#39;s internal data with that in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        updated_message (Message): the updated message data</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">Empty</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">Empty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.broker.Broker.sync_to_backend" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sync_to_backend</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Synchronize the data persisted in the backend with the current state of
<code>message</code> held in memory.</p>
<p>This method is the logical inverse of <code>sync_from_backend</code>; any changes
made to the <code>message</code> instance are written back to the backend so that
future reads reflect the most up-to-date information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message whose current state should be
persisted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>This method will mutate <code>message</code> by updating it
  regardless of whether a lock is linked to it.
  You are responsible for ensuring that any mutation
  of the message's underlying data is only performed
  by the lock owner.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/broker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Syncing </span><span class="si">%s</span><span class="s2"> to backend...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Synced </span><span class="si">%s</span><span class="s2"> to backend.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sync_to_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Synchronize the data persisted in the backend with the current state of</span>
<span class="sd">    ``message`` held in memory.</span>

<span class="sd">    This method is the logical inverse of ``sync_from_backend``; any changes</span>
<span class="sd">    made to the ``message`` instance are written back to the backend so that</span>
<span class="sd">    future reads reflect the most up-to-date information.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message whose current state should be</span>
<span class="sd">            persisted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Warning:</span>
<span class="sd">        * This method will mutate ``message`` by updating it</span>
<span class="sd">          regardless of whether a lock is linked to it.</span>
<span class="sd">          You are responsible for ensuring that any mutation</span>
<span class="sd">          of the message&#39;s underlying data is only performed</span>
<span class="sd">          by the lock owner.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determine which key (regular queue or DLQ) should be updated</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dlq</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MessageDoesNotExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; not found in backend&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Persist the updated message data. We intentionally omit a TTL value</span>
    <span class="c1"># to preserve the existing expiry associated with ``key`` (if any).</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.concurrency" class="doc doc-heading">
            <code>concurrency</code>


</h4>

    <div class="doc doc-contents ">

        <p>Concurrency</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.concurrency.Lock" class="doc doc-heading">
            <code>Lock</code>


</h5>


    <div class="doc doc-contents ">


        <p>Distributed mutual exclusion (MUTEX) lock for controlling
concurrency accross machines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the lock</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
                  <code><span title="alsek.storage.backends.abstract.Backend">Backend</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backend for data storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live in milliseconds.
If <code>None</code>, the lock will not expire automatically.</p>
              </div>
            </td>
            <td>
                  <code>60 * 60 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auto_release</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> automatically release
the lock on context exit.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>owner_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>unique identifier for the lock.
Do not change this value unless you know what you are doing.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.core.concurrency.CURRENT_HOST_OWNER_ID">CURRENT_HOST_OWNER_ID</span></code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Locks are global and do not consider queues, unless
  included in <code>name</code>.</li>
<li>When used as a context manager, the lock is <em>not</em> automatically
  acquired. Lock acquisition requires calling <code>acquire()</code>.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.storage.backends.redis.standard</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisBackend</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">backend</span> <span class="o">=</span> <span class="n">RedisBackend</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="s2">&quot;mutex&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span> <span class="k">as</span> <span class="n">lock</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">():</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Acquired lock.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Did not acquire lock.&quot;</span><span class="p">)</span>
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Lock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distributed mutual exclusion (MUTEX) lock for controlling</span>
<span class="sd">    concurrency accross machines.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the lock</span>
<span class="sd">        backend (Backend): backend for data storage</span>
<span class="sd">        ttl (int, optional): time to live in milliseconds.</span>
<span class="sd">            If ``None``, the lock will not expire automatically.</span>
<span class="sd">        auto_release (bool): if ``True`` automatically release</span>
<span class="sd">            the lock on context exit.</span>
<span class="sd">        owner_id (str): unique identifier for the lock.</span>
<span class="sd">            Do not change this value unless you know what you are doing.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Locks are global and do not consider queues, unless</span>
<span class="sd">          included in ``name``.</span>
<span class="sd">        * When used as a context manager, the lock is *not* automatically</span>
<span class="sd">          acquired. Lock acquisition requires calling ``acquire()``.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from alsek import Lock</span>
<span class="sd">        &gt;&gt;&gt; from alsek.storage.backends.redis.standard import RedisBackend</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; backend = RedisBackend()</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; with Lock(&quot;mutex&quot;, backend=backend) as lock:</span>
<span class="sd">        &gt;&gt;&gt;     if lock.acquire():</span>
<span class="sd">        &gt;&gt;&gt;         print(&quot;Acquired lock.&quot;)</span>
<span class="sd">        &gt;&gt;&gt;     else:</span>
<span class="sd">        &gt;&gt;&gt;         print(&quot;Did not acquire lock.&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">,</span>
        <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">auto_release</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_HOST_OWNER_ID</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="n">ttl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_release</span> <span class="o">=</span> <span class="n">auto_release</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span> <span class="o">=</span> <span class="n">owner_id</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">RedisBackend</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only RedisBackend is supported.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">Lock</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">,</span>
            <span class="n">expire</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">ttl</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="n">ttl</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`name` must be provided.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`owner_id` must be provided.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">owner_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ttl</span><span class="p">,</span>
            <span class="n">auto_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_release</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full name of the lock including its namespace prefix.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">holder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the owner that currently holds the lock, if any.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">get_owner_id</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">held</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If the lock is held by the current owner.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">holder</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">acquire</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wait</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">if_already_acquired</span><span class="p">:</span> <span class="n">IF_ALREADY_ACQUIRED_TYPE</span> <span class="o">=</span> <span class="s2">&quot;raise_error&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to acquire the lock.</span>

<span class="sd">        Args:</span>
<span class="sd">            wait (int, optional): the amount of time wait to acquire</span>
<span class="sd">                the lock (in seconds). If ``None`` do not block.</span>
<span class="sd">            if_already_acquired (str): if ``True`` do not raise if the lock</span>
<span class="sd">                is already held by the current owner.</span>

<span class="sd">        Returns:</span>
<span class="sd">            acquired (bool): ``True`` if the message is</span>
<span class="sd">                acquired or already acquired by the current owner.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">if_already_acquired</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">IF_ALREADY_ACQUIRED_TYPE</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid `on_already_acquired`, got  </span><span class="si">{</span><span class="n">if_already_acquired</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">blocking</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">wait</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">AlreadyAcquired</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">if_already_acquired</span> <span class="o">==</span> <span class="s2">&quot;return_true&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">if_already_acquired</span> <span class="o">==</span> <span class="s2">&quot;return_false&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_if_not_acquired</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Release the lock.</span>

<span class="sd">        Args:</span>
<span class="sd">            raise_if_not_acquired (bool): raise if the lock was not</span>
<span class="sd">                acquired for release.</span>

<span class="sd">        Returns:</span>
<span class="sd">            released (bool): whether the lock was</span>
<span class="sd">                found and released.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">NotAcquired</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_if_not_acquired</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lock</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter the context and try to acquire the lock.</span>

<span class="sd">        Returns:</span>
<span class="sd">            lock (Lock): underlying lock object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">exc_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">exc_tb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exit the context. If ``auto_release`` is enabled,</span>
<span class="sd">         the lock will be released.</span>

<span class="sd">        Args:</span>
<span class="sd">            exc_val (BaseException, optional): an exception from within the context</span>
<span class="sd">            exc_val (BaseException, optional): value of any exception from</span>
<span class="sd">                within the context</span>
<span class="sd">            exc_tb (TracebackType, optional): the traceback from the context</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_release</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.concurrency.Lock.full_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">full_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>The full name of the lock including its namespace prefix.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.concurrency.Lock.held" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">held</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>If the lock is held by the current owner.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.concurrency.Lock.holder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">holder</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Name of the owner that currently holds the lock, if any.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.concurrency.Lock.__enter__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__enter__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Enter the context and try to acquire the lock.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lock</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Lock (alsek.core.concurrency.Lock)" href="#alsek.core.concurrency.Lock">Lock</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>underlying lock object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enter the context and try to acquire the lock.</span>

<span class="sd">    Returns:</span>
<span class="sd">        lock (Lock): underlying lock object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.concurrency.Lock.__exit__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Exit the context. If <code>auto_release</code> is enabled,
 the lock will be released.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exc_val</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an exception from within the context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exc_val</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value of any exception from
within the context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exc_tb</code>
            </td>
            <td>
                  <code><span title="types.TracebackType">TracebackType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the traceback from the context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
    <span class="n">exc_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
    <span class="n">exc_tb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exit the context. If ``auto_release`` is enabled,</span>
<span class="sd">     the lock will be released.</span>

<span class="sd">    Args:</span>
<span class="sd">        exc_val (BaseException, optional): an exception from within the context</span>
<span class="sd">        exc_val (BaseException, optional): value of any exception from</span>
<span class="sd">            within the context</span>
<span class="sd">        exc_tb (TracebackType, optional): the traceback from the context</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_release</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.concurrency.Lock.acquire" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">acquire</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">if_already_acquired</span><span class="o">=</span><span class="s1">&#39;raise_error&#39;</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Try to acquire the lock.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the amount of time wait to acquire
the lock (in seconds). If <code>None</code> do not block.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>if_already_acquired</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> do not raise if the lock
is already held by the current owner.</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise_error&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>acquired</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>True</code> if the message is
acquired or already acquired by the current owner.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">acquire</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">if_already_acquired</span><span class="p">:</span> <span class="n">IF_ALREADY_ACQUIRED_TYPE</span> <span class="o">=</span> <span class="s2">&quot;raise_error&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to acquire the lock.</span>

<span class="sd">    Args:</span>
<span class="sd">        wait (int, optional): the amount of time wait to acquire</span>
<span class="sd">            the lock (in seconds). If ``None`` do not block.</span>
<span class="sd">        if_already_acquired (str): if ``True`` do not raise if the lock</span>
<span class="sd">            is already held by the current owner.</span>

<span class="sd">    Returns:</span>
<span class="sd">        acquired (bool): ``True`` if the message is</span>
<span class="sd">            acquired or already acquired by the current owner.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">if_already_acquired</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">IF_ALREADY_ACQUIRED_TYPE</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid `on_already_acquired`, got  </span><span class="si">{</span><span class="n">if_already_acquired</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">blocking</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">wait</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">AlreadyAcquired</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">if_already_acquired</span> <span class="o">==</span> <span class="s2">&quot;return_true&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">if_already_acquired</span> <span class="o">==</span> <span class="s2">&quot;return_false&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.concurrency.Lock.release" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">release</span><span class="p">(</span><span class="n">raise_if_not_acquired</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Release the lock.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raise_if_not_acquired</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>raise if the lock was not
acquired for release.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>released</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the lock was
found and released.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_if_not_acquired</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Release the lock.</span>

<span class="sd">    Args:</span>
<span class="sd">        raise_if_not_acquired (bool): raise if the lock was not</span>
<span class="sd">            acquired for release.</span>

<span class="sd">    Returns:</span>
<span class="sd">        released (bool): whether the lock was</span>
<span class="sd">            found and released.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">NotAcquired</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raise_if_not_acquired</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.concurrency.ProcessLock" class="doc doc-heading">
            <code>ProcessLock</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Lock (alsek.core.concurrency.Lock)" href="#alsek.core.concurrency.Lock">Lock</a></code></p>


        <p>Distributed mutual exclusion (MUTEX) lock for controlling
concurrency accross processes on the same host.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessLock</span><span class="p">(</span><span class="n">Lock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distributed mutual exclusion (MUTEX) lock for controlling</span>
<span class="sd">    concurrency accross processes on the same host.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">owner_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`name` must be provided.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">owner_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># We compute this &quot;fresh&quot; every time so that</span>
        <span class="c1"># It&#39;s always accurate even if the lock is moved</span>
        <span class="c1"># to a different process than it was created in.</span>
        <span class="k">return</span> <span class="n">_get_process_lock_owner_id</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.concurrency.ThreadLock" class="doc doc-heading">
            <code>ThreadLock</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Lock (alsek.core.concurrency.Lock)" href="#alsek.core.concurrency.Lock">Lock</a></code></p>


        <p>Distributed mutual exclusion (MUTEX) lock for controlling
concurrency accross processes and threads on the same host.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/core/concurrency.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ThreadLock</span><span class="p">(</span><span class="n">Lock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distributed mutual exclusion (MUTEX) lock for controlling</span>
<span class="sd">    concurrency accross processes and threads on the same host.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">owner_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`name` must be provided.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">owner_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># We compute this &quot;fresh&quot; every time so that</span>
        <span class="c1"># It&#39;s always accurate even if the lock is moved</span>
        <span class="c1"># to a different thread than it was created in.</span>
        <span class="k">return</span> <span class="n">_get_thread_lock_owner_id</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.consumer" class="doc doc-heading">
            <code>consumer</code>


</h4>

    <div class="doc doc-contents ">

        <p>Consumer</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.consumer.Consumer" class="doc doc-heading">
            <code>Consumer</code>


</h5>


    <div class="doc doc-contents ">


        <p>Tool for consuming messages generated by the broker.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>broker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Broker (alsek.core.broker.Broker)" href="#alsek.core.broker.Broker">Broker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek broker</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subset</code>
            </td>
            <td>
                  <code>(<span title="list">list</span>[<span title="str">str</span>], <span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="str">str</span>]])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>subset of messages to consume
Must be one of the following</p>
<div class="highlight"><pre><span></span><code>* ``None``: consume messages from all queues and tasks
* ``list``: a list of queues of the form ``[&quot;queue_a&quot;, &quot;queue_b&quot;, &quot;queue_c&quot;, ...]``
* ``dict``: a dictionary of queues and tasks of the form
    ``{&quot;queue_a&quot;: [&quot;task_name_a&quot;, &quot;task_name_b&quot;, &quot;task_name_c&quot;, ...], ...}``
</code></pre></div>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backoff</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff to use in response to passes over the backend
which did not yield any actionable messages.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="LinearBackoff (alsek.core.backoff.LinearBackoff)" href="#alsek.core.backoff.LinearBackoff">LinearBackoff</a>(1 * 1000, floor=1000, ceiling=30000, zero_override=False)</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If <code>subset</code> is a <code>list</code> or <code>dict</code>, queue priority is derived from the
  order of the items. Items which appear earlier are given higher priority.</li>
<li>If <code>subset</code> is a <code>dict</code>, task priority is derived from the order of
  task names in the value associated with each key (queue).</li>
</ul>
</details>

<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>If <code>subset</code> is of type <code>dict</code>, task names not included
  in any of the values will be ignored.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>alsek/core/consumer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Consumer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tool for consuming messages generated by the broker.</span>

<span class="sd">    Args:</span>
<span class="sd">        broker (Broker): an Alsek broker</span>
<span class="sd">        subset (list[str], dict[str, list[str]], optional): subset of messages to consume</span>
<span class="sd">            Must be one of the following</span>

<span class="sd">                * ``None``: consume messages from all queues and tasks</span>
<span class="sd">                * ``list``: a list of queues of the form ``[&quot;queue_a&quot;, &quot;queue_b&quot;, &quot;queue_c&quot;, ...]``</span>
<span class="sd">                * ``dict``: a dictionary of queues and tasks of the form</span>
<span class="sd">                    ``{&quot;queue_a&quot;: [&quot;task_name_a&quot;, &quot;task_name_b&quot;, &quot;task_name_c&quot;, ...], ...}``</span>

<span class="sd">        backoff (Backoff, optional): backoff to use in response to passes over the backend</span>
<span class="sd">            which did not yield any actionable messages.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * If ``subset`` is a ``list`` or ``dict``, queue priority is derived from the</span>
<span class="sd">          order of the items. Items which appear earlier are given higher priority.</span>
<span class="sd">        * If ``subset`` is a ``dict``, task priority is derived from the order of</span>
<span class="sd">          task names in the value associated with each key (queue).</span>

<span class="sd">    Warning:</span>
<span class="sd">        * If ``subset`` is of type ``dict``, task names not included</span>
<span class="sd">          in any of the values will be ignored.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">broker</span><span class="p">:</span> <span class="n">Broker</span><span class="p">,</span>
        <span class="n">subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Backoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearBackoff</span><span class="p">(</span>
            <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="mi">30_000</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span> <span class="o">=</span> <span class="n">broker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backoff</span> <span class="o">=</span> <span class="n">backoff</span> <span class="ow">or</span> <span class="n">ConstantBackoff</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ceiling</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_empty_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span> <span class="o">=</span> <span class="n">StopSignalListener</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_scan_subnamespaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset</span><span class="p">:</span>
            <span class="n">subnamespaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_subnamespace</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">subnamespaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_subnamespace</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subnamespaces</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">get_subnamespace</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">task_name</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subnamespaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_priority_namespace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">yield</span> <span class="n">i</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_poll</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
        <span class="c1"># NOTE: with this approach, we &#39;drain&#39; / exhaust queues in</span>
        <span class="c1">#       the order they&#39;re provided, and then drain the next.</span>
        <span class="c1">#       So if we had queues A,B,C we&#39;d drain A, then drain B</span>
        <span class="c1">#       and, finally, drain C.</span>
        <span class="c1"># ToDo: implement a &#39;flat&#39; option that moves to the next queue</span>
        <span class="c1">#       So, A then B then C, round and round.</span>
        <span class="n">output</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Message</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">main_loop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_subnamespaces</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">priority_iter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                    <span class="n">message_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">message_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Message data can be None if it has been deleted (by a TTL or</span>
                        <span class="c1"># another worker) between the `priority_iter()` and `get()` operations.</span>
                        <span class="k">continue</span>

                    <span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="o">**</span><span class="n">message_data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">ready</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">MessageMutex</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span> <span class="k">as</span> <span class="n">lock</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">if_already_acquired</span><span class="o">=</span><span class="s2">&quot;return_false&quot;</span><span class="p">):</span>
                                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">link_lock</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">main_loop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">redis</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_empty_passes</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">output</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_passes</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">_dedup_messages</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a stream of messages to process from</span>
<span class="sd">        the data backend.</span>

<span class="sd">        Returns:</span>
<span class="sd">            stream (Iterable[Message]): an iterable of messages to process</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poll</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_empty_passes</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.core.consumer.Consumer.stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stream</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Generate a stream of messages to process from
the data backend.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stream</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an iterable of messages to process</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a stream of messages to process from</span>
<span class="sd">    the data backend.</span>

<span class="sd">    Returns:</span>
<span class="sd">        stream (Iterable[Message]): an iterable of messages to process</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poll</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_empty_passes</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.futures" class="doc doc-heading">
            <code>futures</code>


</h4>

    <div class="doc doc-contents ">

        <p>Futures</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.futures.ProcessTaskFuture" class="doc doc-heading">
            <code>ProcessTaskFuture</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="TaskFuture (alsek.core.futures.TaskFuture)" href="#alsek.core.futures.TaskFuture">TaskFuture</a></code></p>


        <p>Future for task execution in a separate process.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>task</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a task to perform</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a message to run <code>task</code> against</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to wait (in milliseconds) after issuing
a SIGTERM signal to the process at shutdown. If the process
is still active after this time, a SIGKILL will be issued.</p>
              </div>
            </td>
            <td>
                  <code>1 * 1000</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/futures.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessTaskFuture</span><span class="p">(</span><span class="n">TaskFuture</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Future for task execution in a separate process.</span>

<span class="sd">    Args:</span>
<span class="sd">        task (Task): a task to perform</span>
<span class="sd">        message (Message): a message to run ``task`` against</span>
<span class="sd">        patience (int): time to wait (in milliseconds) after issuing</span>
<span class="sd">            a SIGTERM signal to the process at shutdown. If the process</span>
<span class="sd">            is still active after this time, a SIGKILL will be issued.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">=</span> <span class="n">patience</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit_queue</span><span class="p">:</span> <span class="n">Queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapper</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                <span class="n">_process_future_encoder</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">),</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit_queue</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Note: this must go here b/c the scan depends on</span>
        <span class="c1">#   `.complete`, which in turn depends on `_process`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_scan_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the task has finished.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_wrapper</span><span class="p">(</span>
        <span class="n">encoded_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">wrapper_exit_queue</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">set_alsek_worker_pool_env_var</span><span class="p">()</span>
        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
        <span class="n">task</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">_process_future_decoder</span><span class="p">(</span><span class="n">encoded_data</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="n">task</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">exception</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">pre_op</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">is_revoked</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Result for </span><span class="si">%s</span><span class="s2"> recovered after revocation. Discarding.&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">message</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exception_details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># clear any existing errors</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully processed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">exception</span> <span class="o">=</span> <span class="n">error</span>
            <span class="n">message</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exception_details</span><span class="o">=</span><span class="n">parse_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>

        <span class="c1"># Post op is called here so that exception_details can be set</span>
        <span class="n">task</span><span class="o">.</span><span class="n">post_op</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper_exit_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Process task future finished after termination.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_error_encountered_future_handler</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">,</span>
                <span class="n">update_exception_on_message</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_complete_future_handler</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="n">wrapper_exit_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the future.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">ident</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Process task future for </span><span class="si">%s</span><span class="s2"> did not start.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped process </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">_error_encountered_future_handler</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                    <span class="n">exception</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.futures.ProcessTaskFuture.complete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complete</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Whether the task has finished.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.futures.ProcessTaskFuture.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Stop the future.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/futures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop the future.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">ident</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Process task future for </span><span class="si">%s</span><span class="s2"> did not start.&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped process </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">_error_encountered_future_handler</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.futures.TaskFuture" class="doc doc-heading">
            <code>TaskFuture</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Future for background task execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>task</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a task to perform</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a message to run <code>task</code> against</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/futures.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskFuture</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Future for background task execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        task (Task): a task to perform</span>
<span class="sd">        message (Message): a message to run ``task`` against</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">utcnow_timestamp_ms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_stop_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_scan_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_revocation_scan</span><span class="p">,</span>
            <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the task has finished.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">time_limit_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether task has been running longer</span>
<span class="sd">        than the allowed time window.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">utcnow_timestamp_ms</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">timeout</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the future.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception (Type[BaseException]): exception type to raise.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@suppress_exception</span><span class="p">(</span>
        <span class="n">TerminationError</span><span class="p">,</span>
        <span class="n">on_suppress</span><span class="o">=</span><span class="k">lambda</span> <span class="n">error</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Termination Detected&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_revocation_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">is_revoked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Evicting &#39;</span><span class="si">%s</span><span class="s2">&#39; due to task revocation...&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">RevokedError</span><span class="p">)</span>
                <span class="n">_handle_failure</span><span class="p">(</span>
                    <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                    <span class="n">exception</span><span class="o">=</span><span class="n">RevokedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; was revoked.&quot;</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Evicted &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">check_interval</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_scan_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>  <span class="c1"># noqa</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Clean up error encountered for task </span><span class="si">%s</span><span class="s2"> with message </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.futures.TaskFuture.complete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complete</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Whether the task has finished.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.futures.TaskFuture.time_limit_exceeded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">time_limit_exceeded</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Whether task has been running longer
than the allowed time window.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.futures.TaskFuture.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Stop the future.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="BaseException">BaseException</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>exception type to raise.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/futures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop the future.</span>

<span class="sd">    Args:</span>
<span class="sd">        exception (Type[BaseException]): exception type to raise.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.futures.ThreadTaskFuture" class="doc doc-heading">
            <code>ThreadTaskFuture</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="TaskFuture (alsek.core.futures.TaskFuture)" href="#alsek.core.futures.TaskFuture">TaskFuture</a></code></p>


        <p>Future for task execution in a separate thread.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>task</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a task to perform</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a message to run <code>task</code> against</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>complete_only_on_thread_exit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, only mark the future
as complete when the thread formally exits (i.e., is not alive).
Pro: more rigorous — avoids marking the task complete until the thread fully terminates.
Useful when you need strict control over thread lifecycle (e.g., for resource management).
Con: may lead to hanging if the thread doesn't terminate quickly (e.g., when using
<code>thread_raise()</code> during revocation). This can also temporarily result in more than the
allotted number of threads running, because it entails treating a thread as
expired regardless of its actual status.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/futures.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ThreadTaskFuture</span><span class="p">(</span><span class="n">TaskFuture</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Future for task execution in a separate thread.</span>

<span class="sd">    Args:</span>
<span class="sd">        task (Task): a task to perform</span>
<span class="sd">        message (Message): a message to run ``task`` against</span>
<span class="sd">        complete_only_on_thread_exit (bool): if ``True``, only mark the future</span>
<span class="sd">            as complete when the thread formally exits (i.e., is not alive).</span>
<span class="sd">            Pro: more rigorous — avoids marking the task complete until the thread fully terminates.</span>
<span class="sd">            Useful when you need strict control over thread lifecycle (e.g., for resource management).</span>
<span class="sd">            Con: may lead to hanging if the thread doesn&#39;t terminate quickly (e.g., when using</span>
<span class="sd">            `thread_raise()` during revocation). This can also temporarily result in more than the</span>
<span class="sd">            allotted number of threads running, because it entails treating a thread as</span>
<span class="sd">            expired regardless of its actual status.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">complete_only_on_thread_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complete_only_on_thread_exit</span> <span class="o">=</span> <span class="n">complete_only_on_thread_exit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapper</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Note: this must go here b/c the scan depends on</span>
        <span class="c1">#   `.complete`, which in turn depends on `_thread`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_revocation_scan_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the task has finished.&quot;&quot;&quot;</span>
        <span class="n">thread_alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete_only_on_thread_exit</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">thread_alive</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If _wrapper_exit is True, consider the task complete even if the thread is still running</span>
            <span class="c1"># This ensures the future gets removed from the worker pool&#39;s _futures list</span>
            <span class="c1"># and new tasks can be polled even if a revoked task&#39;s thread is still running</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">thread_alive</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">exception</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">pre_op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">is_revoked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Result for </span><span class="si">%s</span><span class="s2"> recovered after revocation. Discarding.&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exception_details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># clear any existing errors</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully processed </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">exception</span> <span class="o">=</span> <span class="n">error</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exception_details</span><span class="o">=</span><span class="n">parse_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>

        <span class="c1"># Post op is called here so that exception_details can be set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">post_op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread task future finished after termination.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_error_encountered_future_handler</span><span class="p">(</span>
                <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_complete_future_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the future.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception (Type[BaseException]): exception type to raise.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Thread task future for </span><span class="si">%s</span><span class="s2"> did not start.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">python_implementation</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;CPython&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to raise exception </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2"> in thread </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Unsupported platform &#39;</span><span class="si">{</span><span class="n">python_implementation</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">thread_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_error_encountered_future_handler</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped thread </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.futures.ThreadTaskFuture.complete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complete</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Whether the task has finished.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.futures.ThreadTaskFuture.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Stop the future.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="BaseException">BaseException</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>exception type to raise.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/futures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop the future.</span>

<span class="sd">    Args:</span>
<span class="sd">        exception (Type[BaseException]): exception type to raise.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Thread task future for </span><span class="si">%s</span><span class="s2"> did not start.&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">python_implementation</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;CPython&quot;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unable to raise exception </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2"> in thread </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Unsupported platform &#39;</span><span class="si">{</span><span class="n">python_implementation</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">thread_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_exit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">_error_encountered_future_handler</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
            <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped thread </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.message" class="doc doc-heading">
            <code>message</code>


</h4>

    <div class="doc doc-contents ">

        <p>Message</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.message.Message" class="doc doc-heading">
            <code>Message</code>


</h5>


    <div class="doc doc-contents ">


        <p>Alsek Message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>task_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the task for which
the message is intended</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>queue</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the queue for which the message was intended.
If <code>None</code> the default queue will be set.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
                  <code>(<span title="list">list</span>, <span title="tuple">tuple</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>positional arguments to pass to
the task's function during the execution of <code>op()</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to
the task's function during the execution of <code>op()</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>priority</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>priority of the message within the task.
Messages with lower values will be executed before messages with higher values.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary of user-defined message metadata.
This can store any data types supported by the backend's serializer.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exception_details</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>information about any exception raised
while executing this message. See <code>ExceptionDetails()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live (in milliseconds) for the
result in the result store. If a result store is provided and
this parameter is <code>None</code>, the result will be persisted indefinitely.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>universal unique identifier for the message.
If <code>None</code>, one will be generated automatically.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progenitor_uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>universal unique identifier for the message
from which this message descended. (This field is only set in for tasks
with triggers and/or callbacks.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of retries</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum amount of time (in milliseconds)
a task is permitted to run against this message.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TASK_TIMEOUT">DEFAULT_TASK_TIMEOUT</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>created_at</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UTC timestamp (in milliseconds) for
when the message was created</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>updated_at</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UTC timestamp (in milliseconds) for
when the message was last updated</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delay</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>delay before the message becomes ready (in milliseconds).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_result</code>
            </td>
            <td>
                  <code><span title="any">any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the output of any
previously executed task. (This will only be non-null
in cases where callbacks are used.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_message_uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>universal unique identifier
for the message for the preceding message (This will only be
non-null in cases where callbacks are used.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callback_message_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>data to construct
a new message as part of a callback operation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backoff_settings</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameters to control
backoff. Expected to be of the form
<code>{"algorithm": str, "parameters": dict}</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mechanism</code>
            </td>
            <td>
                  <code><span title="alsek.types.SupportedMechanismType">SupportedMechanismType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mechanism for executing the task. Must
be either "process" or "thread".</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MECHANISM">DEFAULT_MECHANISM</span></code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>While <em>not</em> recommended, <code>timeout</code> can be disabled,
  in effect, by setting it to a very large integer.</li>
<li>Messages have <code>ephemeral_state</code>, which is a dictionary
  where items can be added and removed as needed. However,
  this state is NOT persisted to the backend, and only intended
  to be used within the lifetime of a single task execution,
  e.g., updating the state in <code>pre_op()</code> for use in <code>op()</code>.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>alsek/core/message.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek Message.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_name (str): the name of the task for which</span>
<span class="sd">            the message is intended</span>
<span class="sd">        queue (str, optional): the queue for which the message was intended.</span>
<span class="sd">            If ``None`` the default queue will be set.</span>
<span class="sd">        args (list, tuple, optional): positional arguments to pass to</span>
<span class="sd">            the task&#39;s function during the execution of ``op()``</span>
<span class="sd">        kwargs (dict, optional): keyword arguments to pass to</span>
<span class="sd">            the task&#39;s function during the execution of ``op()``</span>
<span class="sd">        priority (int): priority of the message within the task.</span>
<span class="sd">            Messages with lower values will be executed before messages with higher values.</span>
<span class="sd">        metadata (dict, optional): a dictionary of user-defined message metadata.</span>
<span class="sd">            This can store any data types supported by the backend&#39;s serializer.</span>
<span class="sd">        exception_details (dict, optional): information about any exception raised</span>
<span class="sd">            while executing this message. See ``ExceptionDetails()``.</span>
<span class="sd">        result_ttl (int, optional): time to live (in milliseconds) for the</span>
<span class="sd">            result in the result store. If a result store is provided and</span>
<span class="sd">            this parameter is ``None``, the result will be persisted indefinitely.</span>
<span class="sd">        uuid (str, optional): universal unique identifier for the message.</span>
<span class="sd">            If ``None``, one will be generated automatically.</span>
<span class="sd">        progenitor_uuid (str, optional): universal unique identifier for the message</span>
<span class="sd">            from which this message descended. (This field is only set in for tasks</span>
<span class="sd">            with triggers and/or callbacks.)</span>
<span class="sd">        retries (int): number of retries</span>
<span class="sd">        timeout (int): the maximum amount of time (in milliseconds)</span>
<span class="sd">            a task is permitted to run against this message.</span>
<span class="sd">        created_at (int): UTC timestamp (in milliseconds) for</span>
<span class="sd">            when the message was created</span>
<span class="sd">        updated_at (int): UTC timestamp (in milliseconds) for</span>
<span class="sd">            when the message was last updated</span>
<span class="sd">        delay (int): delay before the message becomes ready (in milliseconds).</span>
<span class="sd">        previous_result (any, optional): the output of any</span>
<span class="sd">            previously executed task. (This will only be non-null</span>
<span class="sd">            in cases where callbacks are used.)</span>
<span class="sd">        previous_message_uuid (str, optional): universal unique identifier</span>
<span class="sd">            for the message for the preceding message (This will only be</span>
<span class="sd">            non-null in cases where callbacks are used.)</span>
<span class="sd">        callback_message_data (dict, optional): data to construct</span>
<span class="sd">            a new message as part of a callback operation</span>
<span class="sd">        backoff_settings (dict, optional): parameters to control</span>
<span class="sd">            backoff. Expected to be of the form</span>
<span class="sd">            ``{&quot;algorithm&quot;: str, &quot;parameters&quot;: dict}``.</span>
<span class="sd">        mechanism (SupportedMechanismType): mechanism for executing the task. Must</span>
<span class="sd">            be either &quot;process&quot; or &quot;thread&quot;.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * While *not* recommended, ``timeout`` can be disabled,</span>
<span class="sd">          in effect, by setting it to a very large integer.</span>
<span class="sd">        * Messages have `ephemeral_state`, which is a dictionary</span>
<span class="sd">          where items can be added and removed as needed. However,</span>
<span class="sd">          this state is NOT persisted to the backend, and only intended</span>
<span class="sd">          to be used within the lifetime of a single task execution,</span>
<span class="sd">          e.g., updating the state in `pre_op()` for use in `op()`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exception_details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">ExceptionDetails</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">result_ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">progenitor_uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TASK_TIMEOUT</span><span class="p">,</span>
        <span class="n">created_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">updated_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delay</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">previous_result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">previous_message_uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">callback_message_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backoff_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mechanism</span><span class="p">:</span> <span class="n">SupportedMechanismType</span> <span class="o">=</span> <span class="n">DEFAULT_MECHANISM</span><span class="p">,</span>
        <span class="n">linked_lock</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LinkedLock</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span> <span class="o">=</span> <span class="n">task_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span> <span class="ow">or</span> <span class="n">DEFAULT_QUEUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">priority</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span> <span class="o">=</span> <span class="n">exception_details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_ttl</span> <span class="o">=</span> <span class="n">result_ttl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="n">retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid</span> <span class="ow">or</span> <span class="n">_make_uuid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progenitor_uuid</span> <span class="o">=</span> <span class="n">progenitor_uuid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_result</span> <span class="o">=</span> <span class="n">previous_result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_message_uuid</span> <span class="o">=</span> <span class="n">previous_message_uuid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_message_data</span> <span class="o">=</span> <span class="n">callback_message_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backoff_settings</span> <span class="o">=</span> <span class="n">backoff_settings</span> <span class="ow">or</span> <span class="n">ExponentialBackoff</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span> <span class="o">=</span> <span class="n">mechanism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="o">=</span> <span class="n">linked_lock</span>

        <span class="k">if</span> <span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">updated_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">utcnow_timestamp_ms</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">updated_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time data is corrupt&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">created_at</span><span class="p">,</span> <span class="n">updated_at</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ephemeral_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exception_details</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ExceptionDetails</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;information about any exception raised.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span><span class="p">,</span> <span class="n">ExceptionDetails</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ExceptionDetails</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `exception_details` type&quot;</span><span class="p">)</span>

    <span class="nd">@exception_details</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exception_details</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ExceptionDetails</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set information about any exception raised.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">ExceptionDetails</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exception_details</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`exception_details` is invalid&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Underlying message data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">task_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">exception_details</span><span class="o">=</span><span class="p">(</span>
                <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception_details</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception_details</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">result_ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result_ttl</span><span class="p">,</span>
            <span class="n">uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
            <span class="n">progenitor_uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="p">,</span>
            <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="n">updated_at</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span><span class="p">,</span>
            <span class="n">delay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span>
            <span class="n">previous_result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_result</span><span class="p">,</span>
            <span class="n">previous_message_uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_message_uuid</span><span class="p">,</span>
            <span class="n">callback_message_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_message_data</span><span class="p">,</span>
            <span class="n">backoff_settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff_settings</span><span class="p">,</span>
            <span class="n">mechanism</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span><span class="p">,</span>
            <span class="n">linked_lock</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span> <span class="s2">&quot;updated_at&quot;</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_timestamp_ms</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;High-level summary of the message object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">new_line_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
            <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_backoff_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the amount of time to backoff (wait)</span>
<span class="sd">        before the message is eligible for processing again,</span>
<span class="sd">        should it fail.</span>

<span class="sd">        Returns:</span>
<span class="sd">            duration (int): duration of the backoff in milliseconds</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">settings2backoff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff_settings</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ready_at</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Timestamp denoting when the message will be ready for processing.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_backoff_duration</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If the messages is currently ready for processing.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_at</span> <span class="o">&lt;=</span> <span class="n">utcnow_timestamp_ms</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ttr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time to ready in milliseconds.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ready_at</span> <span class="o">-</span> <span class="n">utcnow_timestamp_ms</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">descendant_uuids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A list of uuids which have or will decent from this message.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_message_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">_collect_callback_uuids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_message_data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">link_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">:</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Link a lock to the current message.</span>

<span class="sd">        Links are formed against the ``long_name`` of ``lock``.</span>

<span class="sd">        Args:</span>
<span class="sd">            lock (Lock): a concurrency lock</span>
<span class="sd">            override (bool): if ``True`` replace any existing lock</span>

<span class="sd">        Returns:</span>
<span class="sd">            message (Message): the updated message</span>

<span class="sd">        Warning:</span>
<span class="sd">            * Locks links are formed in memory and are</span>
<span class="sd">              never persisted to the data backend.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message already linked to a lock&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="o">=</span> <span class="n">LinkedLock</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">lock</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">owner_id</span><span class="o">=</span><span class="n">lock</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">release_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">not_linked_ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">target_backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Release the lock linked to the message.</span>

<span class="sd">        Args:</span>
<span class="sd">            not_linked_ok (bool): if ``True`` do not raise if no lock is found</span>
<span class="sd">            target_backend (Backend): a backend to release the lock from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            success (bool): if the lock was released successfully.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: if no lock is associated with the message</span>
<span class="sd">                and ``missing_ok`` is not ``True``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Releasing lock for </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">:</span>
            <span class="c1"># ToDo: the backend passed into might not be the same</span>
            <span class="c1">#   one that was used to create the lock. Without also</span>
            <span class="c1">#   saving the backend information along with &#39;name&#39; and</span>
            <span class="c1">#   &#39;owner_id&#39; we have no way of knowing that. Fix.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Lock</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">backend</span><span class="o">=</span><span class="n">target_backend</span><span class="p">,</span>
                    <span class="n">owner_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">[</span><span class="s2">&quot;owner_id&quot;</span><span class="p">],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">raise_if_not_acquired</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Released lock for </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">NotAcquired</span><span class="p">:</span>  <span class="c1"># noqa</span>
                <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to release lock for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">not_linked_ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;No lock linked to message&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an exact copy of the current message.</span>

<span class="sd">        Returns:</span>
<span class="sd">            clone (Message): the cloned message</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="o">**</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the ``data`` in the current message.</span>

<span class="sd">        Args:</span>
<span class="sd">            **data (Keyword Args): key value pairs of</span>
<span class="sd">                data to update</span>

<span class="sd">        Returns:</span>
<span class="sd">            updated_message (Message): the updated message</span>

<span class="sd">        Warning:</span>
<span class="sd">            * This method operates &#39;in place&#39;. To avoid changing the current</span>
<span class="sd">              message, first call ``.clone()``, e.g., ``message.clone().update(...)``.</span>
<span class="sd">            * Changes are *not* automatically persisted to the backend.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_to_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds metadata to the current instance by merging provided data into</span>
<span class="sd">        the existing metadata. The function performs a non-inplace merge operation,</span>
<span class="sd">        ensuring the original metadata is not directly altered unless returned and</span>
<span class="sd">        reassigned.</span>

<span class="sd">        Args:</span>
<span class="sd">            **data: Key-value pairs to merge into the existing metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: The updated instance with the merged metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data provided to add to metadata.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">dict_merge_update_into_origin</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">(),</span>
            <span class="n">update</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_to_ephemeral_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds ephemeral information to the current instance by merging provided data into</span>
<span class="sd">        the existing `ephemeral_state`. The function performs a non-inplace merge operation,</span>
<span class="sd">        ensuring the original metadata is not directly altered unless returned</span>
<span class="sd">        and reassigned.</span>

<span class="sd">        Args:</span>
<span class="sd">            **data: Key-value pairs to merge into the existing metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: The updated instance with the merged metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data provided to add to metadata.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ephemeral_state</span> <span class="o">=</span> <span class="n">dict_merge_update_into_origin</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ephemeral_state</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">(),</span>
            <span class="n">update</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a duplicate of the current message, changing only ``uuid``.</span>

<span class="sd">        Args:</span>
<span class="sd">            uuid (str, optional): universal unique identifier for the new message.</span>
<span class="sd">                If ``None``, one will be generated automatically.</span>

<span class="sd">        Returns:</span>
<span class="sd">            duplicate_message (Message): the duplicate message</span>

<span class="sd">        Warning:</span>
<span class="sd">            * Linked locks are not conserved</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span> <span class="ow">or</span> <span class="n">_make_uuid</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">increment_retries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a message by increasing the number</span>
<span class="sd">        of retries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            message (Message): the updated message</span>

<span class="sd">        Notes:</span>
<span class="sd">            * ``updated_at`` will be updated to the</span>
<span class="sd">               current time.</span>

<span class="sd">        Warning:</span>
<span class="sd">            * Changes are *not* automatically persisted to the backend.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">updated_at</span><span class="o">=</span><span class="n">utcnow_timestamp_ms</span><span class="p">(),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">data</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Underlying message data.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.descendant_uuids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">descendant_uuids</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>A list of uuids which have or will decent from this message.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.exception_details" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exception_details</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>information about any exception raised.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.ready" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ready</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>If the messages is currently ready for processing.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.ready_at" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ready_at</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Timestamp denoting when the message will be ready for processing.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>High-level summary of the message object.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.message.Message.ttr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ttr</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Time to ready in milliseconds.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.add_to_ephemeral_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_to_ephemeral_state</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Adds ephemeral information to the current instance by merging provided data into
the existing <code>ephemeral_state</code>. The function performs a non-inplace merge operation,
ensuring the original metadata is not directly altered unless returned
and reassigned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**data</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key-value pairs to merge into the existing metadata.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated instance with the merged metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_to_ephemeral_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds ephemeral information to the current instance by merging provided data into</span>
<span class="sd">    the existing `ephemeral_state`. The function performs a non-inplace merge operation,</span>
<span class="sd">    ensuring the original metadata is not directly altered unless returned</span>
<span class="sd">    and reassigned.</span>

<span class="sd">    Args:</span>
<span class="sd">        **data: Key-value pairs to merge into the existing metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: The updated instance with the merged metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data provided to add to metadata.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ephemeral_state</span> <span class="o">=</span> <span class="n">dict_merge_update_into_origin</span><span class="p">(</span>
        <span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ephemeral_state</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">(),</span>
        <span class="n">update</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.add_to_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_to_metadata</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Adds metadata to the current instance by merging provided data into
the existing metadata. The function performs a non-inplace merge operation,
ensuring the original metadata is not directly altered unless returned and
reassigned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**data</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key-value pairs to merge into the existing metadata.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated instance with the merged metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_to_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds metadata to the current instance by merging provided data into</span>
<span class="sd">    the existing metadata. The function performs a non-inplace merge operation,</span>
<span class="sd">    ensuring the original metadata is not directly altered unless returned and</span>
<span class="sd">    reassigned.</span>

<span class="sd">    Args:</span>
<span class="sd">        **data: Key-value pairs to merge into the existing metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: The updated instance with the merged metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data provided to add to metadata.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">dict_merge_update_into_origin</span><span class="p">(</span>
        <span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">(),</span>
        <span class="n">update</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.clone" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clone</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Create an exact copy of the current message.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>clone</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the cloned message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an exact copy of the current message.</span>

<span class="sd">    Returns:</span>
<span class="sd">        clone (Message): the cloned message</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="o">**</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.duplicate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">duplicate</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Create a duplicate of the current message, changing only <code>uuid</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>universal unique identifier for the new message.
If <code>None</code>, one will be generated automatically.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>duplicate_message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the duplicate message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Linked locks are not conserved</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a duplicate of the current message, changing only ``uuid``.</span>

<span class="sd">    Args:</span>
<span class="sd">        uuid (str, optional): universal unique identifier for the new message.</span>
<span class="sd">            If ``None``, one will be generated automatically.</span>

<span class="sd">    Returns:</span>
<span class="sd">        duplicate_message (Message): the duplicate message</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Linked locks are not conserved</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span> <span class="ow">or</span> <span class="n">_make_uuid</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.get_backoff_duration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_backoff_duration</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the amount of time to backoff (wait)
before the message is eligible for processing again,
should it fail.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>duration</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>duration of the backoff in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_backoff_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the amount of time to backoff (wait)</span>
<span class="sd">    before the message is eligible for processing again,</span>
<span class="sd">    should it fail.</span>

<span class="sd">    Returns:</span>
<span class="sd">        duration (int): duration of the backoff in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">settings2backoff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff_settings</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.increment_retries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">increment_retries</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Update a message by increasing the number
of retries.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the updated message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li><code>updated_at</code> will be updated to the
   current time.</li>
</ul>
</details>

<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Changes are <em>not</em> automatically persisted to the backend.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">increment_retries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a message by increasing the number</span>
<span class="sd">    of retries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        message (Message): the updated message</span>

<span class="sd">    Notes:</span>
<span class="sd">        * ``updated_at`` will be updated to the</span>
<span class="sd">           current time.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Changes are *not* automatically persisted to the backend.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">updated_at</span><span class="o">=</span><span class="n">utcnow_timestamp_ms</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.link_lock" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">link_lock</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Link a lock to the current message.</p>
<p>Links are formed against the <code>long_name</code> of <code>lock</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lock</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Lock (alsek.core.concurrency.Lock)" href="#alsek.core.concurrency.Lock">Lock</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a concurrency lock</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>override</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> replace any existing lock</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the updated message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Locks links are formed in memory and are
  never persisted to the data backend.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">link_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">:</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Link a lock to the current message.</span>

<span class="sd">    Links are formed against the ``long_name`` of ``lock``.</span>

<span class="sd">    Args:</span>
<span class="sd">        lock (Lock): a concurrency lock</span>
<span class="sd">        override (bool): if ``True`` replace any existing lock</span>

<span class="sd">    Returns:</span>
<span class="sd">        message (Message): the updated message</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Locks links are formed in memory and are</span>
<span class="sd">          never persisted to the data backend.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message already linked to a lock&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="o">=</span> <span class="n">LinkedLock</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">lock</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">owner_id</span><span class="o">=</span><span class="n">lock</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.release_lock" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">release_lock</span><span class="p">(</span><span class="n">not_linked_ok</span><span class="p">,</span> <span class="n">target_backend</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Release the lock linked to the message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>not_linked_ok</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> do not raise if no lock is found</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_backend</code>
            </td>
            <td>
                  <code><span title="alsek.storage.backends.abstract.Backend">Backend</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a backend to release the lock from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>success</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the lock was released successfully.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if no lock is associated with the message
and <code>missing_ok</code> is not <code>True</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">release_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">not_linked_ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">target_backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Release the lock linked to the message.</span>

<span class="sd">    Args:</span>
<span class="sd">        not_linked_ok (bool): if ``True`` do not raise if no lock is found</span>
<span class="sd">        target_backend (Backend): a backend to release the lock from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        success (bool): if the lock was released successfully.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AttributeError: if no lock is associated with the message</span>
<span class="sd">            and ``missing_ok`` is not ``True``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Releasing lock for </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">:</span>
        <span class="c1"># ToDo: the backend passed into might not be the same</span>
        <span class="c1">#   one that was used to create the lock. Without also</span>
        <span class="c1">#   saving the backend information along with &#39;name&#39; and</span>
        <span class="c1">#   &#39;owner_id&#39; we have no way of knowing that. Fix.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Lock</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">backend</span><span class="o">=</span><span class="n">target_backend</span><span class="p">,</span>
                <span class="n">owner_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span><span class="p">[</span><span class="s2">&quot;owner_id&quot;</span><span class="p">],</span>
            <span class="p">)</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">raise_if_not_acquired</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Released lock for </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linked_lock</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">redis_lock</span><span class="o">.</span><span class="n">NotAcquired</span><span class="p">:</span>  <span class="c1"># noqa</span>
            <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                <span class="s2">&quot;Failed to release lock for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">not_linked_ok</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;No lock linked to message&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.message.Message.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Update the <code>data</code> in the current message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**data</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>key value pairs of
data to update</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>updated_message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the updated message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>This method operates 'in place'. To avoid changing the current
  message, first call <code>.clone()</code>, e.g., <code>message.clone().update(...)</code>.</li>
<li>Changes are <em>not</em> automatically persisted to the backend.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/message.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the ``data`` in the current message.</span>

<span class="sd">    Args:</span>
<span class="sd">        **data (Keyword Args): key value pairs of</span>
<span class="sd">            data to update</span>

<span class="sd">    Returns:</span>
<span class="sd">        updated_message (Message): the updated message</span>

<span class="sd">    Warning:</span>
<span class="sd">        * This method operates &#39;in place&#39;. To avoid changing the current</span>
<span class="sd">          message, first call ``.clone()``, e.g., ``message.clone().update(...)``.</span>
<span class="sd">        * Changes are *not* automatically persisted to the backend.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.status" class="doc doc-heading">
            <code>status</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="alsek.core.status.abstract" class="doc doc-heading">
            <code>abstract</code>


</h5>

    <div class="doc doc-contents ">

        <p>Abstract Status</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.status.abstract.BaseStatusTracker" class="doc doc-heading">
            <code>BaseStatusTracker</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Alsek Status Tracker.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BaseBackend (alsek.storage.backends.abstract.BaseBackend)" href="#alsek.storage.backends.abstract.BaseBackend">BaseBackend</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backend to persists results to. (In almost all cases, this
should be the same backend used by the Broker).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live (in milliseconds) for the status</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TTL">DEFAULT_TTL</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_pubsub</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> automatically publish PUBSUB updates.
If <code>None</code> determine automatically given the capabilities of the backend
used by <code>broker</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseStatusTracker</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek Status Tracker.</span>

<span class="sd">    Args:</span>
<span class="sd">        backend (BaseBackend): backend to persists results to. (In almost all cases, this</span>
<span class="sd">            should be the same backend used by the Broker).</span>
<span class="sd">        ttl (int, optional): time to live (in milliseconds) for the status</span>
<span class="sd">        enable_pubsub (bool, optional): if ``True`` automatically publish PUBSUB updates.</span>
<span class="sd">            If ``None`` determine automatically given the capabilities of the backend</span>
<span class="sd">            used by ``broker``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">BaseBackend</span><span class="p">,</span>
        <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TTL</span><span class="p">,</span>
        <span class="n">enable_pubsub</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="n">ttl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">SUPPORTS_PUBSUB</span> <span class="k">if</span> <span class="n">enable_pubsub</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">enable_pubsub</span>  <span class="c1"># fmt: skip</span>

        <span class="k">if</span> <span class="n">enable_pubsub</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">backend</span><span class="o">.</span><span class="n">SUPPORTS_PUBSUB</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Backend does not support PUBSUB&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="s2">&quot;ttl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span><span class="p">,</span>
            <span class="s2">&quot;enable_pubsub&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BaseStatusTracker</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the key for the status information about the message</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            name (string): the key for the status information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">queue</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">task_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Required attributes not set for message&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;status:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">queue</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the channel for status updates about the message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            name (string): the channel for the status information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">queue</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">task_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Required attributes not set for message&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;channel:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">queue</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a status for ``message`` exists in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">publish_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">StatusUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish a PUBSUB update for a message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            update (StatusUpdate): a status to publish</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listen_to_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">auto_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]</span> <span class="o">|</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Listen to PUBSUB updates for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            auto_exit (bool): if ``True`` stop listening if a terminal status for the</span>
<span class="sd">                task is encountered (succeeded or failed).</span>

<span class="sd">        Returns:</span>
<span class="sd">            stream (Iterable[StatusUpdate] | AsyncIterable[StatusUpdate]): A stream of updates from the pubsub channel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">,</span>
        <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a ``status`` for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            status (TaskStatus): a status to set</span>
<span class="sd">            details (Any, optional): additional information about the status (e.g., progress percentage)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusUpdate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the status of ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            status (StatusUpdate): the status of ``message``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wait_for</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">],</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">raise_on_timeout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for a message to reach a desired status.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): the message to monitor</span>
<span class="sd">            status (TaskStatus, tuple[TaskStatus...], list[TaskStatus]): the target status</span>
<span class="sd">            timeout (float, optional): max time to wait (in seconds). None means wait forever.</span>
<span class="sd">            poll_interval (float): how often to check (in seconds)</span>
<span class="sd">           raise_on_timeout (bool): if ``True`` raise a ``TimeoutError`` if waiting times out</span>
<span class="sd">                otherwise return the current status</span>

<span class="sd">        Returns:</span>
<span class="sd">            status (TaskStatus): the status of ``message`` after waiting.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the status of ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            check (bool): check that it is safe to delete the status.</span>
<span class="sd">                This is done by ensuring that the current status of ``message``</span>
<span class="sd">                is terminal (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: if ``check`` is ``True`` and the status of</span>
<span class="sd">                ``message`` is not ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Delete the status of <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>check that it is safe to delete the status.
This is done by ensuring that the current status of <code>message</code>
is terminal (i.e., <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValidationError (alsek.exceptions.ValidationError)" href="#alsek.exceptions.ValidationError">ValidationError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>check</code> is <code>True</code> and the status of
<code>message</code> is not <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete the status of ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        check (bool): check that it is safe to delete the status.</span>
<span class="sd">            This is done by ensuring that the current status of ``message``</span>
<span class="sd">            is terminal (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: if ``check`` is ``True`` and the status of</span>
<span class="sd">            ``message`` is not ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Check if a status for <code>message</code> exists in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a status for ``message`` exists in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Get the status of <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the status of <code>message</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusUpdate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the status of ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        status (StatusUpdate): the status of ``message``</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.get_pubsub_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Get the channel for status updates about the message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>name</code></td>            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the channel for the status information</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the channel for status updates about the message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        name (string): the channel for the status information</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">queue</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">task_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Required attributes not set for message&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;channel:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">queue</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.get_storage_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Get the key for the status information about the message</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>name</code></td>            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the key for the status information</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the key for the status information about the message</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        name (string): the key for the status information</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">queue</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">task_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Required attributes not set for message&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;status:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">queue</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.listen_to_updates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">listen_to_updates</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">auto_exit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Listen to PUBSUB updates for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auto_exit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> stop listening if a terminal status for the
task is encountered (succeeded or failed).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stream</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a>] | <span title="typing.AsyncIterable">AsyncIterable</span>[<a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A stream of updates from the pubsub channel</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">listen_to_updates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">auto_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]</span> <span class="o">|</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Listen to PUBSUB updates for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        auto_exit (bool): if ``True`` stop listening if a terminal status for the</span>
<span class="sd">            task is encountered (succeeded or failed).</span>

<span class="sd">    Returns:</span>
<span class="sd">        stream (Iterable[StatusUpdate] | AsyncIterable[StatusUpdate]): A stream of updates from the pubsub channel</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.publish_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Publish a PUBSUB update for a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a status to publish</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">publish_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">StatusUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publish a PUBSUB update for a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        update (StatusUpdate): a status to publish</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Set a <code>status</code> for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a status to set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>details</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional information about the status (e.g., progress percentage)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">,</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a ``status`` for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        status (TaskStatus): a status to set</span>
<span class="sd">        details (Any, optional): additional information about the status (e.g., progress percentage)</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.abstract.BaseStatusTracker.wait_for" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wait_for</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Wait for a message to reach a desired status.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the message to monitor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code>TaskStatus, tuple[TaskStatus...], list[TaskStatus]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target status</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max time to wait (in seconds). None means wait forever.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>poll_interval</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how often to check (in seconds)</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>raise_on_timeout (bool): if <code>True</code> raise a <code>TimeoutError</code> if waiting times out
        otherwise return the current status</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the status of <code>message</code> after waiting.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">],</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">raise_on_timeout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wait for a message to reach a desired status.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): the message to monitor</span>
<span class="sd">        status (TaskStatus, tuple[TaskStatus...], list[TaskStatus]): the target status</span>
<span class="sd">        timeout (float, optional): max time to wait (in seconds). None means wait forever.</span>
<span class="sd">        poll_interval (float): how often to check (in seconds)</span>
<span class="sd">       raise_on_timeout (bool): if ``True`` raise a ``TimeoutError`` if waiting times out</span>
<span class="sd">            otherwise return the current status</span>

<span class="sd">    Returns:</span>
<span class="sd">        status (TaskStatus): the status of ``message`` after waiting.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.core.status.asyncio" class="doc doc-heading">
            <code>asyncio</code>


</h5>

    <div class="doc doc-contents ">

        <p>Async Status Tracker</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.status.asyncio.AsyncStatusTracker" class="doc doc-heading">
            <code>AsyncStatusTracker</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseStatusTracker (alsek.core.status.abstract.BaseStatusTracker)" href="#alsek.core.status.abstract.BaseStatusTracker">BaseStatusTracker</a></code></p>








              <details class="quote">
                <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AsyncStatusTracker</span><span class="p">(</span><span class="n">BaseStatusTracker</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Async </span><span class="si">{</span><span class="n">BaseStatusTracker</span><span class="o">.</span><span class="vm">__doc__</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="n">AsyncBackend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Redundant, but needed for the PyCharm&#39;s type</span>
        <span class="c1"># checker to understand that self.backend is `AsyncBackend`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">AsyncBackend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">IS_ASYNC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Backend is not async&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncStatusTracker</span><span class="p">:</span>
        <span class="n">backend_data</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">])</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">from_settings</span><span class="p">(</span><span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">AsyncStatusTracker</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ttl&quot;</span><span class="p">],</span>
            <span class="n">enable_pubsub</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;enable_pubsub&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a status for ``message`` exists in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">publish_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">StatusUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish a PUBSUB update for a message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            update (StatusUpdate): a status to publish</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">pub</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>  <span class="c1"># converting to dict makes this serializer-agnostic</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">listen_to_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">auto_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Listen to PUBSUB updates for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            auto_exit (bool): if ``True`` stop listening if a terminal status for the</span>
<span class="sd">                task is encountered (succeeded or failed).</span>

<span class="sd">        Returns:</span>
<span class="sd">            stream (AsyncIterable[StatusUpdate]): A stream of updates from the pubsub channel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PUBSUB not enabled&quot;</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span>
                <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span>
                    <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
                    <span class="n">details</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>  <span class="c1"># noqa</span>
                <span class="p">)</span>
                <span class="k">yield</span> <span class="n">update</span>
                <span class="k">if</span> <span class="n">auto_exit</span> <span class="ow">and</span> <span class="n">update</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
                    <span class="k">break</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">,</span>
        <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a ``status`` for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            status (TaskStatus): a status to set</span>
<span class="sd">            details (Any, optional): additional information about the status (e.g., progress percentage)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">details</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusUpdate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the status of ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            status (StatusUpdate): the status of ``message``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">:=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">StatusUpdate</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
                <span class="n">details</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No status found for message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wait_for</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">],</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">raise_on_timeout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for a message to reach a desired status.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): the message to monitor</span>
<span class="sd">            status (TaskStatus, tuple[TaskStatus...], list[TaskStatus]): the target status</span>
<span class="sd">            timeout (float, optional): max time to wait (in seconds). None means wait forever.</span>
<span class="sd">            poll_interval (float): how often to check (in seconds)</span>
<span class="sd">            raise_on_timeout (bool): if ``True`` raise a ``TimeoutError`` if waiting times out</span>
<span class="sd">                otherwise return the current status</span>

<span class="sd">        Returns:</span>
<span class="sd">            status (TaskStatus): the status of ``message`` after waiting</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_current_status_match</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">current_status</span> <span class="o">==</span> <span class="n">status</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">current_status</span> <span class="ow">in</span> <span class="n">status</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">deadline</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_status</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">))</span><span class="o">.</span><span class="n">status</span>
                <span class="k">if</span> <span class="n">is_current_status_match</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">current_status</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">deadline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">deadline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">raise_on_timeout</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout waiting for &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">UNKNOWN</span> <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">current_status</span>  <span class="c1"># fmt: skip</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_interval</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the status of ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            check (bool): check that it is safe to delete the status.</span>
<span class="sd">                This is done by ensuring that the current status of ``message``</span>
<span class="sd">                is terminal (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: if ``check`` is ``True`` and the status of</span>
<span class="sd">                ``message`` is not ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">))</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; in a non-terminal state&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Delete the status of <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>check that it is safe to delete the status.
This is done by ensuring that the current status of <code>message</code>
is terminal (i.e., <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValidationError (alsek.exceptions.ValidationError)" href="#alsek.exceptions.ValidationError">ValidationError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>check</code> is <code>True</code> and the status of
<code>message</code> is not <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete the status of ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        check (bool): check that it is safe to delete the status.</span>
<span class="sd">            This is done by ensuring that the current status of ``message``</span>
<span class="sd">            is terminal (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: if ``check`` is ``True`` and the status of</span>
<span class="sd">            ``message`` is not ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">))</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; in a non-terminal state&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Check if a status for <code>message</code> exists in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a status for ``message`` exists in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Get the status of <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the status of <code>message</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusUpdate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the status of ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        status (StatusUpdate): the status of ``message``</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">:=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">StatusUpdate</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
            <span class="n">details</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No status found for message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.listen_to_updates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">listen_to_updates</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">auto_exit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Listen to PUBSUB updates for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auto_exit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> stop listening if a terminal status for the
task is encountered (succeeded or failed).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stream</code></td>            <td>
                  <code><span title="typing.AsyncIterable">AsyncIterable</span>[<a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A stream of updates from the pubsub channel</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">listen_to_updates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">auto_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Listen to PUBSUB updates for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        auto_exit (bool): if ``True`` stop listening if a terminal status for the</span>
<span class="sd">            task is encountered (succeeded or failed).</span>

<span class="sd">    Returns:</span>
<span class="sd">        stream (AsyncIterable[StatusUpdate]): A stream of updates from the pubsub channel</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PUBSUB not enabled&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span>
            <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
                <span class="n">details</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
            <span class="k">yield</span> <span class="n">update</span>
            <span class="k">if</span> <span class="n">auto_exit</span> <span class="ow">and</span> <span class="n">update</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
                <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.publish_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Publish a PUBSUB update for a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a status to publish</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">publish_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">StatusUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publish a PUBSUB update for a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        update (StatusUpdate): a status to publish</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">pub</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>  <span class="c1"># converting to dict makes this serializer-agnostic</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Set a <code>status</code> for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a status to set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>details</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional information about the status (e.g., progress percentage)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">,</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a ``status`` for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        status (TaskStatus): a status to set</span>
<span class="sd">        details (Any, optional): additional information about the status (e.g., progress percentage)</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">details</span><span class="p">)</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
        <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.asyncio.AsyncStatusTracker.wait_for" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wait_for</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Wait for a message to reach a desired status.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the message to monitor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code>TaskStatus, tuple[TaskStatus...], list[TaskStatus]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target status</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max time to wait (in seconds). None means wait forever.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>poll_interval</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how often to check (in seconds)</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_timeout</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> raise a <code>TimeoutError</code> if waiting times out
otherwise return the current status</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the status of <code>message</code> after waiting</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wait_for</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">],</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">raise_on_timeout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wait for a message to reach a desired status.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): the message to monitor</span>
<span class="sd">        status (TaskStatus, tuple[TaskStatus...], list[TaskStatus]): the target status</span>
<span class="sd">        timeout (float, optional): max time to wait (in seconds). None means wait forever.</span>
<span class="sd">        poll_interval (float): how often to check (in seconds)</span>
<span class="sd">        raise_on_timeout (bool): if ``True`` raise a ``TimeoutError`` if waiting times out</span>
<span class="sd">            otherwise return the current status</span>

<span class="sd">    Returns:</span>
<span class="sd">        status (TaskStatus): the status of ``message`` after waiting</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_current_status_match</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">current_status</span> <span class="o">==</span> <span class="n">status</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">current_status</span> <span class="ow">in</span> <span class="n">status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">deadline</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">))</span><span class="o">.</span><span class="n">status</span>
            <span class="k">if</span> <span class="n">is_current_status_match</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">current_status</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">deadline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">deadline</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_on_timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout waiting for &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">UNKNOWN</span> <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">current_status</span>  <span class="c1"># fmt: skip</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_interval</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.core.status.integrity" class="doc doc-heading">
            <code>integrity</code>


</h5>

    <div class="doc doc-contents ">

        <p>Integrity</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.status.integrity.StatusTrackerIntegrityScanner" class="doc doc-heading">
            <code>StatusTrackerIntegrityScanner</code>


</h6>


    <div class="doc doc-contents ">


        <p>Tool to ensure the integrity of statuses scanning a <code>StatusTracker()</code>
with non-terminal statuses (i.e., <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>)
that no longer exist in the broker. Entries which meet this criteria will have
their status set to <code>TaskStatus.UNKNOWN</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>status_tracker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusTracker (alsek.StatusTracker)" href="#alsek.core.status.standard.StatusTracker">StatusTracker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>status tracker to scan for messages with non-terminal status</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trigger</code>
            </td>
            <td>
                  <code>(<span title="apscheduler.triggers.cron.CronTrigger">CronTrigger</span>, <span title="apscheduler.triggers.date.DateTrigger">DateTrigger</span>, <span title="apscheduler.triggers.interval.IntervalTrigger">IntervalTrigger</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trigger which determines how often to perform the scan.</p>
              </div>
            </td>
            <td>
                  <code><span title="apscheduler.triggers.interval.IntervalTrigger">IntervalTrigger</span>(hours=1)</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/status/integrity.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StatusTrackerIntegrityScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tool to ensure the integrity of statuses scanning a ``StatusTracker()``</span>
<span class="sd">    with non-terminal statuses (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``)</span>
<span class="sd">    that no longer exist in the broker. Entries which meet this criteria will have</span>
<span class="sd">    their status set to ``TaskStatus.UNKNOWN``.</span>

<span class="sd">    Args:</span>
<span class="sd">        status_tracker (StatusTracker): status tracker to scan for messages with non-terminal status</span>
<span class="sd">        trigger (CronTrigger, DateTrigger, IntervalTrigger, optional):</span>
<span class="sd">            trigger which determines how often to perform the scan.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">status_tracker</span><span class="p">:</span> <span class="n">StatusTracker</span><span class="p">,</span>
        <span class="n">broker</span><span class="p">:</span> <span class="n">Broker</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CronTrigger</span><span class="p">,</span> <span class="n">DateTrigger</span><span class="p">,</span> <span class="n">IntervalTrigger</span><span class="p">]</span> <span class="o">=</span> <span class="n">IntervalTrigger</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># fmt: skip</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span> <span class="o">=</span> <span class="n">status_tracker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span> <span class="o">=</span> <span class="n">broker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>

        <span class="k">if</span> <span class="n">status_tracker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">IS_ASYNC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Async backends not supported&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="p">:</span> <span class="n">BackgroundScheduler</span> <span class="o">=</span> <span class="n">BackgroundScheduler</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trigger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">,</span>
                <span class="n">trigger</span><span class="o">=</span><span class="n">trigger</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;integrity_scan&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the integrity scan.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;status*&quot;</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">_name2message</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.integrity.StatusTrackerIntegrityScanner.scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Run the integrity scan.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/integrity.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the integrity scan.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;status*&quot;</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">_name2message</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.core.status.standard" class="doc doc-heading">
            <code>standard</code>


</h5>

    <div class="doc doc-contents ">

        <p>Status Tracking</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.status.standard.StatusTracker" class="doc doc-heading">
            <code>StatusTracker</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseStatusTracker (alsek.core.status.abstract.BaseStatusTracker)" href="#alsek.core.status.abstract.BaseStatusTracker">BaseStatusTracker</a></code></p>








              <details class="quote">
                <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StatusTracker</span><span class="p">(</span><span class="n">BaseStatusTracker</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">BaseStatusTracker</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatusTracker</span><span class="p">:</span>
        <span class="n">backend_data</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">])</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">from_settings</span><span class="p">(</span><span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ttl&quot;</span><span class="p">],</span>
            <span class="n">enable_pubsub</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;enable_pubsub&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a status for ``message`` exists in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">StatusUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish a PUBSUB update for a message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            update (StatusUpdate): a status to publish</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">pub</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>  <span class="c1"># converting to dict makes this serializer-agnostic</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">listen_to_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">auto_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Listen to PUBSUB updates for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            auto_exit (bool): if ``True`` stop listening if a terminal status for the</span>
<span class="sd">                task is encountered (succeeded or failed).</span>

<span class="sd">        Returns:</span>
<span class="sd">            stream (Iterable[StatusUpdate]): A stream of updates from the pubsub channel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PUBSUB not enabled&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span>
                <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span>
                    <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
                    <span class="n">details</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>  <span class="c1"># noqa</span>
                <span class="p">)</span>
                <span class="k">yield</span> <span class="n">update</span>
                <span class="k">if</span> <span class="n">auto_exit</span> <span class="ow">and</span> <span class="n">update</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
                    <span class="k">break</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">,</span>
        <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a ``status`` for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            status (TaskStatus): a status to set</span>
<span class="sd">            details (Any, optional): additional information about the status (e.g., progress percentage)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">details</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusUpdate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the status of ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            status (StatusUpdate): the status of ``message``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">StatusUpdate</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
                <span class="n">details</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No status found for message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait_for</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">],</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">raise_on_timeout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for a message to reach a desired status.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): the message to monitor</span>
<span class="sd">            status (TaskStatus, tuple[TaskStatus...], list[TaskStatus]): the target status</span>
<span class="sd">            timeout (float, optional): max time to wait (in seconds). None means wait forever.</span>
<span class="sd">            poll_interval (float): how often to check (in seconds)</span>
<span class="sd">            raise_on_timeout (bool): if ``True`` raise a ``TimeoutError`` if waiting times out</span>
<span class="sd">                otherwise return the current status</span>

<span class="sd">        Returns:</span>
<span class="sd">            status (TaskStatus): the status of ``message`` after waiting</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_current_status_match</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">current_status</span> <span class="o">==</span> <span class="n">status</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">current_status</span> <span class="ow">in</span> <span class="n">status</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">deadline</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span>
                <span class="k">if</span> <span class="n">is_current_status_match</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">current_status</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">deadline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">deadline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">raise_on_timeout</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout waiting for &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">UNKNOWN</span> <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">current_status</span>  <span class="c1"># fmt: skip</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_interval</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the status of ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            check (bool): check that it is safe to delete the status.</span>
<span class="sd">                This is done by ensuring that the current status of ``message``</span>
<span class="sd">                is terminal (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: if ``check`` is ``True`` and the status of</span>
<span class="sd">                ``message`` is not ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; in a non-terminal state&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Delete the status of <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>check that it is safe to delete the status.
This is done by ensuring that the current status of <code>message</code>
is terminal (i.e., <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValidationError (alsek.exceptions.ValidationError)" href="#alsek.exceptions.ValidationError">ValidationError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>check</code> is <code>True</code> and the status of
<code>message</code> is not <code>TaskStatus.FAILED</code> or <code>TaskStatus.SUCCEEDED</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete the status of ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        check (bool): check that it is safe to delete the status.</span>
<span class="sd">            This is done by ensuring that the current status of ``message``</span>
<span class="sd">            is terminal (i.e., ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: if ``check`` is ``True`` and the status of</span>
<span class="sd">            ``message`` is not ``TaskStatus.FAILED`` or ``TaskStatus.SUCCEEDED``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; in a non-terminal state&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Check if a status for <code>message</code> exists in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a status for ``message`` exists in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Get the status of <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the status of <code>message</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusUpdate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the status of ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        status (StatusUpdate): the status of ``message``</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">StatusUpdate</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
            <span class="n">details</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No status found for message &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.listen_to_updates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">listen_to_updates</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">auto_exit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Listen to PUBSUB updates for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auto_exit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> stop listening if a terminal status for the
task is encountered (succeeded or failed).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stream</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A stream of updates from the pubsub channel</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">listen_to_updates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">auto_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">StatusUpdate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Listen to PUBSUB updates for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        auto_exit (bool): if ``True`` stop listening if a terminal status for the</span>
<span class="sd">            task is encountered (succeeded or failed).</span>

<span class="sd">    Returns:</span>
<span class="sd">        stream (Iterable[StatusUpdate]): A stream of updates from the pubsub channel</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PUBSUB not enabled&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span>
            <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]],</span>  <span class="c1"># noqa</span>
                <span class="n">details</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;details&quot;</span><span class="p">],</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
            <span class="k">yield</span> <span class="n">update</span>
            <span class="k">if</span> <span class="n">auto_exit</span> <span class="ow">and</span> <span class="n">update</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span><span class="p">:</span>
                <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.publish_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Publish a PUBSUB update for a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusUpdate (alsek.core.status.types.StatusUpdate)" href="#alsek.core.status.types.StatusUpdate">StatusUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a status to publish</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">StatusUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publish a PUBSUB update for a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        update (StatusUpdate): a status to publish</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">pub</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_pubsub_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>  <span class="c1"># converting to dict makes this serializer-agnostic</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Set a <code>status</code> for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a status to set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>details</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional information about the status (e.g., progress percentage)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">,</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a ``status`` for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        status (TaskStatus): a status to set</span>
<span class="sd">        details (Any, optional): additional information about the status (e.g., progress percentage)</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">update</span> <span class="o">=</span> <span class="n">StatusUpdate</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">details</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
        <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_pubsub</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publish_update</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.status.standard.StatusTracker.wait_for" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wait_for</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Wait for a message to reach a desired status.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the message to monitor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code>TaskStatus, tuple[TaskStatus...], list[TaskStatus]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target status</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max time to wait (in seconds). None means wait forever.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>poll_interval</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how often to check (in seconds)</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_timeout</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> raise a <code>TimeoutError</code> if waiting times out
otherwise return the current status</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the status of <code>message</code> after waiting</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/status/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wait_for</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">],</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">raise_on_timeout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wait for a message to reach a desired status.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): the message to monitor</span>
<span class="sd">        status (TaskStatus, tuple[TaskStatus...], list[TaskStatus]): the target status</span>
<span class="sd">        timeout (float, optional): max time to wait (in seconds). None means wait forever.</span>
<span class="sd">        poll_interval (float): how often to check (in seconds)</span>
<span class="sd">        raise_on_timeout (bool): if ``True`` raise a ``TimeoutError`` if waiting times out</span>
<span class="sd">            otherwise return the current status</span>

<span class="sd">    Returns:</span>
<span class="sd">        status (TaskStatus): the status of ``message`` after waiting</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_current_status_match</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">current_status</span> <span class="o">==</span> <span class="n">status</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">current_status</span> <span class="ow">in</span> <span class="n">status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid status type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">deadline</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_status</span><span class="p">:</span> <span class="n">TaskStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span>
            <span class="k">if</span> <span class="n">is_current_status_match</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">current_status</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">deadline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">deadline</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_on_timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout waiting for &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">UNKNOWN</span> <span class="k">if</span> <span class="n">current_status</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">current_status</span>  <span class="c1"># fmt: skip</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_interval</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.core.status.types" class="doc doc-heading">
            <code>types</code>


</h5>

    <div class="doc doc-contents ">

        <p>Types</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.status.types.StatusUpdate" class="doc doc-heading">
            <code>StatusUpdate</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


        <p>Status information.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/core/status/types.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StatusUpdate</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Status information.&quot;&quot;&quot;</span>

    <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">details</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="alsek.core.status.types.TaskStatus" class="doc doc-heading">
            <code>TaskStatus</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Alsek task statuses.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/core/status/types.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek task statuses.&quot;&quot;&quot;</span>

    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SUBMITTED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">RUNNING</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">RETRYING</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">SUCCEEDED</span> <span class="o">=</span> <span class="mi">5</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.task" class="doc doc-heading">
            <code>task</code>


</h4>

    <div class="doc doc-contents ">

        <p>Task</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.core.task.Task" class="doc doc-heading">
            <code>Task</code>


</h5>


    <div class="doc doc-contents ">


        <p>Alsek Task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>function</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function to use for the main operation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>broker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Broker (alsek.core.broker.Broker)" href="#alsek.core.broker.Broker">Broker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek broker</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the task. If <code>None</code>,
the class name will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>queue</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the queue to generate the task on.
If <code>None</code>, the default queue will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum amount of time (in milliseconds)
this task is permitted to run.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TASK_TIMEOUT">DEFAULT_TASK_TIMEOUT</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of allowed retries</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MAX_RETRIES">DEFAULT_MAX_RETRIES</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backoff</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff algorithm and parameters to use when computing
delay between retries</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExponentialBackoff (alsek.core.backoff.ExponentialBackoff)" href="#alsek.core.backoff.ExponentialBackoff">ExponentialBackoff</a>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_store</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ResultStore (alsek.storage.result.ResultStore)" href="#alsek.storage.result.ResultStore">ResultStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store for persisting task results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status_tracker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusTracker (alsek.core.status.standard.StatusTracker)" href="#alsek.core.status.standard.StatusTracker">StatusTracker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store for persisting task statuses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mechanism</code>
            </td>
            <td>
                  <code><span title="alsek.types.SupportedMechanismType">SupportedMechanismType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mechanism for executing the task. Must
be either "process" or "thread".</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MECHANISM">DEFAULT_MECHANISM</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>no_positional_args</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, the task will not accept positional arguments.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li><code>do_retry()</code> can be overridden in cases where <code>max_retries</code>
   is not sufficiently complex to determine if a retry should occur.</li>
</ul>
</details>

<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Timeouts are not supported for <code>mechanism='thread'</code> on Python
  implementations other than CPython.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>alsek/core/task.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek Task.</span>

<span class="sd">    Args:</span>
<span class="sd">        function (callable): function to use for the main operation</span>
<span class="sd">        broker (Broker): an Alsek broker</span>
<span class="sd">        name (str, optional): the name of the task. If ``None``,</span>
<span class="sd">            the class name will be used.</span>
<span class="sd">        queue (str, optional): the name of the queue to generate the task on.</span>
<span class="sd">            If ``None``, the default queue will be used.</span>
<span class="sd">        timeout (int): the maximum amount of time (in milliseconds)</span>
<span class="sd">            this task is permitted to run.</span>
<span class="sd">        max_retries (int, optional): maximum number of allowed retries</span>
<span class="sd">        backoff (Backoff, optional): backoff algorithm and parameters to use when computing</span>
<span class="sd">            delay between retries</span>
<span class="sd">        result_store (ResultStore, optional): store for persisting task results</span>
<span class="sd">        status_tracker (StatusTracker, optional): store for persisting task statuses</span>
<span class="sd">        mechanism (SupportedMechanismType): mechanism for executing the task. Must</span>
<span class="sd">            be either &quot;process&quot; or &quot;thread&quot;.</span>
<span class="sd">        no_positional_args (bool): if ``True``, the task will not accept positional arguments.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * ``do_retry()`` can be overridden in cases where ``max_retries``</span>
<span class="sd">           is not sufficiently complex to determine if a retry should occur.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Timeouts are not supported for ``mechanism=&#39;thread&#39;`` on Python</span>
<span class="sd">          implementations other than CPython.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">broker</span><span class="p">:</span> <span class="n">Broker</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TASK_TIMEOUT</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_RETRIES</span><span class="p">,</span>
        <span class="n">backoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Backoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentialBackoff</span><span class="p">(),</span>
        <span class="n">result_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResultStore</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">status_tracker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatusTracker</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mechanism</span><span class="p">:</span> <span class="n">SupportedMechanismType</span> <span class="o">=</span> <span class="n">DEFAULT_MECHANISM</span><span class="p">,</span>
        <span class="n">no_positional_args</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span> <span class="o">=</span> <span class="n">broker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span> <span class="ow">or</span> <span class="n">DEFAULT_QUEUE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backoff</span> <span class="o">=</span> <span class="n">backoff</span> <span class="ow">or</span> <span class="n">ConstantBackoff</span><span class="p">(</span>
            <span class="n">constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">floor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ceiling</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zero_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span> <span class="o">=</span> <span class="n">result_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span> <span class="o">=</span> <span class="n">status_tracker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span> <span class="o">=</span> <span class="n">mechanism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_positional_args</span> <span class="o">=</span> <span class="n">no_positional_args</span>

        <span class="k">if</span> <span class="n">mechanism</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_MECHANISMS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported mechanism &#39;</span><span class="si">{</span><span class="n">mechanism</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">status_tracker</span> <span class="ow">and</span> <span class="n">status_tracker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">IS_ASYNC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status tracker does not support async backends&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">gather_init_params</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ignore</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;broker&quot;</span><span class="p">,</span> <span class="s2">&quot;status_tracker&quot;</span><span class="p">,</span> <span class="s2">&quot;result_store&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Broker</span>
        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;broker_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;broker_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

        <span class="c1"># Status Tracker</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="p">:</span>
            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;status_tracker_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;status_tracker_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

        <span class="c1"># Result Store</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span><span class="p">:</span>
            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;result_store_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;result_store_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unwind_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Broker</span>
            <span class="n">broker_class</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;broker_class&quot;</span><span class="p">)</span>
            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;broker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">broker_class</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;broker_state&quot;</span><span class="p">))</span>

            <span class="c1"># Status Tracker</span>
            <span class="k">if</span> <span class="n">status_tracker_state</span> <span class="o">:=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;status_tracker_state&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">status_tracker_class</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;status_tracker_class&quot;</span><span class="p">)</span>
                <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;status_tracker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status_tracker_class</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">status_tracker_state</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>

            <span class="c1"># Result Store</span>
            <span class="k">if</span> <span class="n">result_store_state</span> <span class="o">:=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;result_store_state&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">result_store_class</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;result_store_class&quot;</span><span class="p">)</span>
                <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;result_store&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_store_class</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">result_store_state</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>

            <span class="k">return</span> <span class="n">settings</span>

        <span class="n">rebuilt_task</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">](</span><span class="o">**</span><span class="n">unwind_settings</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">Task</span><span class="p">,</span> <span class="n">rebuilt_task</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the task.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
            <span class="n">broker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span>
            <span class="n">backoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff</span><span class="p">,</span>
            <span class="n">mechanism</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span><span class="p">,</span>
            <span class="n">deferred_mode</span><span class="o">=</span><span class="s2">&quot;enabled&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the status of a message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message to update the status of.</span>
<span class="sd">            status (TaskStatus): status to update the message to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting status of &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; to </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deferred</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether deferred mode is currently enabled.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">defer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter &quot;deferred&quot; mode.</span>

<span class="sd">        Do not submit the next message created by ``generate()``</span>
<span class="sd">        to the broker.</span>

<span class="sd">        Returns:</span>
<span class="sd">            task (Task): the current task</span>

<span class="sd">        Warning:</span>
<span class="sd">            * Deferred mode is automatically cancelled by ``generate()``</span>
<span class="sd">              prior to it returning.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_defer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel &quot;deferred&quot; mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            task (Task): the current task</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles the action to be performed when a message is submitted.</span>
<span class="sd">        This method processes  the provided message and executes the required</span>
<span class="sd">        behavior upon submission.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): The message object submitted for processing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">result_ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delay</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">previous_result</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">submit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">options</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an instance of the task for processing.</span>

<span class="sd">        This method generates a new message for the task and</span>
<span class="sd">        submit it to the broker.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list, tuple, optional): positional arguments to pass to ``function``</span>
<span class="sd">            kwargs (dict, optional): keyword arguments to pass to ``function``</span>
<span class="sd">            priority (int): priority of the message within the task.</span>
<span class="sd">                Messages with lower values will be executed before messages with higher values.</span>
<span class="sd">            metadata (dict, optional): a dictionary of user-defined message metadata.</span>
<span class="sd">                This can store any data types supported by the backend&#39;s serializer.</span>
<span class="sd">            result_ttl (int, optional): time to live (in milliseconds) for the</span>
<span class="sd">                result in the result store. If a result store is provided and</span>
<span class="sd">            this parameter is ``None``, the result will be persisted indefinitely.</span>
<span class="sd">            uuid (str, optional): universal unique identifier for the message.</span>
<span class="sd">                If ``None``, one will be generated automatically.</span>
<span class="sd">            timeout_override (int, optional): override the default maximum runtime</span>
<span class="sd">                (in milliseconds) for instances of this task.</span>
<span class="sd">            set maximum amount of time (in milliseconds)</span>
<span class="sd">                this message is permitted to run. This will override the default</span>
<span class="sd">                for the task.</span>
<span class="sd">            delay (int, optional): delay before message is ready (in milliseconds)</span>
<span class="sd">            previous_result (Any): result of a previous task.</span>
<span class="sd">            callback (Message, tuple[Message, ...], optional): one or more messages</span>
<span class="sd">                to be submitted to the broker after the proceeding message has been</span>
<span class="sd">                successfully processed by a worker.</span>
<span class="sd">            queue (str, optional): queue to use for the task. If none, the default</span>
<span class="sd">                queue for this task will be used.</span>
<span class="sd">            submit (bool): if ``True`` submit the task to the broker</span>
<span class="sd">            options (Keyword Args): options to use when submitting</span>
<span class="sd">                the message via the broker. See ``Broker.submit()``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            message (Message): message generated for the task</span>

<span class="sd">        Warning:</span>
<span class="sd">            * ``submit`` is overridden to ``False`` if deferred mode is active</span>
<span class="sd">            * ``uuid`` is refreshed after the first event when using a trigger.</span>
<span class="sd">            * If manually overriding ``queue`` such that it differs from the default</span>
<span class="sd">              for this task, Worker Pools built using ``task_specific_mode=True`` will</span>
<span class="sd">              fail acknowledge its existence.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">result_ttl</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`result_ttl` invalid. No result store set.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_positional_args</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task does not accept positional arguments.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">priority</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`priority` must be an int greater than or equal to zero&quot;</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span>
            <span class="n">task_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">result_ttl</span><span class="o">=</span><span class="n">result_ttl</span><span class="p">,</span>
            <span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_override</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span>
            <span class="n">previous_result</span><span class="o">=</span><span class="n">previous_result</span><span class="p">,</span>
            <span class="n">callback_message_data</span><span class="o">=</span><span class="n">_parse_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">callback</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">backoff_settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span>
            <span class="n">mechanism</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_defer</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">submit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_submit</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pre_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Operation to perform before running ``op``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message ``op`` will be run against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass ``message`` data to ``function`` for processing.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message to perform the operation against</span>

<span class="sd">        Returns:</span>
<span class="sd">            result (Any): output of the function</span>

<span class="sd">        Notes:</span>
<span class="sd">            * If, and only if, the signature of ``function`` contains</span>
<span class="sd">              a ``message`` parameter, ``message`` itself will be passed</span>
<span class="sd">              along with any ``args`` and ``kwargs`` contained in the message.</span>

<span class="sd">        Warning:</span>
<span class="sd">            * ``message`` will not be passed in cases where a &quot;message&quot;</span>
<span class="sd">              exists in ``message.kwargs``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">kwargs</span> <span class="ow">and</span> <span class="n">_expects_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">message</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">message</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Operation to perform after running ``op``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message ``op()`` was run against</span>
<span class="sd">            result (Any): output of ``op()``</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_revocation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles the event when a message is revoked and logs the associated exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: The message instance that was revoked.</span>
<span class="sd">            exception: The exception instance that represents the reason for the</span>
<span class="sd">                revocation.</span>
<span class="sd">            result (Any): The result of the revoked operation. This is only provided</span>
<span class="sd">                if the task succeeds</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles the retry logic when a processing failure occurs.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: The message object that failed during processing and is</span>
<span class="sd">                subject to a retry attempt.</span>
<span class="sd">            exception: The exception instance that was raised during the</span>
<span class="sd">                failure of processing the message.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the actions to be performed when an operation fails.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: The message object containing the details of the failed</span>
<span class="sd">                operation.</span>
<span class="sd">            exception: The exception object associated with the failure, providing</span>
<span class="sd">                additional context or details about what caused the failure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles successful outcomes of an operation by processing the given message</span>
<span class="sd">        and corresponding result.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: An instance of the Message class that contains relevant information</span>
<span class="sd">                about the operation.</span>
<span class="sd">            result: The result of the completed operation, which can be of any type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the task against a message.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message to process</span>

<span class="sd">        Returns:</span>
<span class="sd">            result (Any): output of ``op()``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">do_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether a failed task should be retried.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message which failed</span>
<span class="sd">            exception (BaseException): the exception which was raised</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_revoked</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">message</span><span class="o">.</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">do_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether or to submit the callback provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message with the callback</span>
<span class="sd">            result (Any): output of ``op()``</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        Warning:</span>
<span class="sd">            * If the task message does not have a callback this</span>
<span class="sd">              method will *not* be invoked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_revoked_key_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;revoked:</span><span class="si">{</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@magic_logger</span><span class="p">(</span>
        <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Revoking </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Revoked </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">revoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">skip_if_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke the task.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): message to revoke</span>
<span class="sd">            skip_if_running (bool): if ``True``, skip revoking the task if it is currently RUNNING.</span>
<span class="sd">                Notes: requires ``status_tracker`` to be set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Revoking </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span>
        <span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Message is already terminal: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">skip_if_running</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;`skip_if_running` requires `status_tracker` to be set&quot;</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>
        <span class="k">elif</span> <span class="n">skip_if_running</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">status_update</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
            <span class="ow">and</span> <span class="n">status_update</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">RUNNING</span>
        <span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Message is currently running: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_make_revoked_key_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="n">DEFAULT_TTL</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">message</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">exception_details</span><span class="o">=</span><span class="n">ExceptionDetails</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">get_exception_name</span><span class="p">(</span><span class="n">RevokedError</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Task Revoked&quot;</span><span class="p">,</span>
                <span class="n">traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a message is revoked.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_revoked_key_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.task.Task.deferred" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deferred</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Whether deferred mode is currently enabled.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.task.Task.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Name of the task.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.cancel_defer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cancel_defer</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Cancel "deferred" mode.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>task</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the current task</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cancel_defer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cancel &quot;deferred&quot; mode.</span>

<span class="sd">    Returns:</span>
<span class="sd">        task (Task): the current task</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.defer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">defer</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Enter "deferred" mode.</p>
<p>Do not submit the next message created by <code>generate()</code>
to the broker.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>task</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the current task</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Deferred mode is automatically cancelled by <code>generate()</code>
  prior to it returning.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">defer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enter &quot;deferred&quot; mode.</span>

<span class="sd">    Do not submit the next message created by ``generate()``</span>
<span class="sd">    to the broker.</span>

<span class="sd">    Returns:</span>
<span class="sd">        task (Task): the current task</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Deferred mode is automatically cancelled by ``generate()``</span>
<span class="sd">          prior to it returning.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.do_callback" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_callback</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Whether or to submit the callback provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message with the callback</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output of <code>op()</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>If the task message does not have a callback this
  method will <em>not</em> be invoked.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">do_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether or to submit the callback provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message with the callback</span>
<span class="sd">        result (Any): output of ``op()``</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    Warning:</span>
<span class="sd">        * If the task message does not have a callback this</span>
<span class="sd">          method will *not* be invoked.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.do_retry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_retry</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Whether a failed task should be retried.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message which failed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the exception which was raised</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">do_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether a failed task should be retried.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message which failed</span>
<span class="sd">        exception (BaseException): the exception which was raised</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_revoked</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">message</span><span class="o">.</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Execute the task against a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output of <code>op()</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the task against a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message to process</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (Any): output of ``op()``</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.generate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result_ttl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout_override</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">submit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Generate an instance of the task for processing.</p>
<p>This method generates a new message for the task and
submit it to the broker.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
                  <code>(<span title="list">list</span>, <span title="tuple">tuple</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>positional arguments to pass to <code>function</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to <code>function</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>priority</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>priority of the message within the task.
Messages with lower values will be executed before messages with higher values.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary of user-defined message metadata.
This can store any data types supported by the backend's serializer.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live (in milliseconds) for the
result in the result store. If a result store is provided and</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>universal unique identifier for the message.
If <code>None</code>, one will be generated automatically.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout_override</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>override the default maximum runtime
(in milliseconds) for instances of this task.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delay</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>delay before message is ready (in milliseconds)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_result</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>result of a previous task.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callback</code>
            </td>
            <td>
                  <code>(<a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a>, <span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a>, ...])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one or more messages
to be submitted to the broker after the proceeding message has been
successfully processed by a worker.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>queue</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>queue to use for the task. If none, the default
queue for this task will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>submit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> submit the task to the broker</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>options to use when submitting
the message via the broker. See <code>Broker.submit()</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>message</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message generated for the task</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li><code>submit</code> is overridden to <code>False</code> if deferred mode is active</li>
<li><code>uuid</code> is refreshed after the first event when using a trigger.</li>
<li>If manually overriding <code>queue</code> such that it differs from the default
  for this task, Worker Pools built using <code>task_specific_mode=True</code> will
  fail acknowledge its existence.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">result_ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">uuid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delay</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">previous_result</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">submit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">options</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an instance of the task for processing.</span>

<span class="sd">    This method generates a new message for the task and</span>
<span class="sd">    submit it to the broker.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (list, tuple, optional): positional arguments to pass to ``function``</span>
<span class="sd">        kwargs (dict, optional): keyword arguments to pass to ``function``</span>
<span class="sd">        priority (int): priority of the message within the task.</span>
<span class="sd">            Messages with lower values will be executed before messages with higher values.</span>
<span class="sd">        metadata (dict, optional): a dictionary of user-defined message metadata.</span>
<span class="sd">            This can store any data types supported by the backend&#39;s serializer.</span>
<span class="sd">        result_ttl (int, optional): time to live (in milliseconds) for the</span>
<span class="sd">            result in the result store. If a result store is provided and</span>
<span class="sd">        this parameter is ``None``, the result will be persisted indefinitely.</span>
<span class="sd">        uuid (str, optional): universal unique identifier for the message.</span>
<span class="sd">            If ``None``, one will be generated automatically.</span>
<span class="sd">        timeout_override (int, optional): override the default maximum runtime</span>
<span class="sd">            (in milliseconds) for instances of this task.</span>
<span class="sd">        set maximum amount of time (in milliseconds)</span>
<span class="sd">            this message is permitted to run. This will override the default</span>
<span class="sd">            for the task.</span>
<span class="sd">        delay (int, optional): delay before message is ready (in milliseconds)</span>
<span class="sd">        previous_result (Any): result of a previous task.</span>
<span class="sd">        callback (Message, tuple[Message, ...], optional): one or more messages</span>
<span class="sd">            to be submitted to the broker after the proceeding message has been</span>
<span class="sd">            successfully processed by a worker.</span>
<span class="sd">        queue (str, optional): queue to use for the task. If none, the default</span>
<span class="sd">            queue for this task will be used.</span>
<span class="sd">        submit (bool): if ``True`` submit the task to the broker</span>
<span class="sd">        options (Keyword Args): options to use when submitting</span>
<span class="sd">            the message via the broker. See ``Broker.submit()``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        message (Message): message generated for the task</span>

<span class="sd">    Warning:</span>
<span class="sd">        * ``submit`` is overridden to ``False`` if deferred mode is active</span>
<span class="sd">        * ``uuid`` is refreshed after the first event when using a trigger.</span>
<span class="sd">        * If manually overriding ``queue`` such that it differs from the default</span>
<span class="sd">          for this task, Worker Pools built using ``task_specific_mode=True`` will</span>
<span class="sd">          fail acknowledge its existence.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">result_ttl</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`result_ttl` invalid. No result store set.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_positional_args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task does not accept positional arguments.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">priority</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`priority` must be an int greater than or equal to zero&quot;</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">queue</span><span class="o">=</span><span class="n">queue</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">result_ttl</span><span class="o">=</span><span class="n">result_ttl</span><span class="p">,</span>
        <span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_override</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
        <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span>
        <span class="n">previous_result</span><span class="o">=</span><span class="n">previous_result</span><span class="p">,</span>
        <span class="n">callback_message_data</span><span class="o">=</span><span class="n">_parse_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">callback</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backoff_settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backoff</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span>
        <span class="n">mechanism</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mechanism</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferred</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_defer</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">submit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_submit</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.is_revoked" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_revoked</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if a message is revoked.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a message is revoked.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_revoked_key_name</span><span class="p">(</span><span class="n">message</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.on_failure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_failure</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Handles the actions to be performed when an operation fails.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message object containing the details of the failed
operation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception object associated with the failure, providing
additional context or details about what caused the failure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the actions to be performed when an operation fails.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: The message object containing the details of the failed</span>
<span class="sd">            operation.</span>
<span class="sd">        exception: The exception object associated with the failure, providing</span>
<span class="sd">            additional context or details about what caused the failure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.on_retry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_retry</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Handles the retry logic when a processing failure occurs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message object that failed during processing and is
subject to a retry attempt.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception instance that was raised during the
failure of processing the message.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the retry logic when a processing failure occurs.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: The message object that failed during processing and is</span>
<span class="sd">            subject to a retry attempt.</span>
<span class="sd">        exception: The exception instance that was raised during the</span>
<span class="sd">            failure of processing the message.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.on_revocation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_revocation</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Handles the event when a message is revoked and logs the associated exception.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message instance that was revoked.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="BaseException">BaseException</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception instance that represents the reason for the
revocation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the revoked operation. This is only provided
if the task succeeds</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_revocation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the event when a message is revoked and logs the associated exception.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: The message instance that was revoked.</span>
<span class="sd">        exception: The exception instance that represents the reason for the</span>
<span class="sd">            revocation.</span>
<span class="sd">        result (Any): The result of the revoked operation. This is only provided</span>
<span class="sd">            if the task succeeds</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.on_submit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_submit</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Handles the action to be performed when a message is submitted.
This method processes  the provided message and executes the required
behavior upon submission.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message object submitted for processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the action to be performed when a message is submitted.</span>
<span class="sd">    This method processes  the provided message and executes the required</span>
<span class="sd">    behavior upon submission.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): The message object submitted for processing.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.on_success" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_success</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Handles successful outcomes of an operation by processing the given message
and corresponding result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the Message class that contains relevant information
about the operation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the completed operation, which can be of any type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles successful outcomes of an operation by processing the given message</span>
<span class="sd">    and corresponding result.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: An instance of the Message class that contains relevant information</span>
<span class="sd">            about the operation.</span>
<span class="sd">        result: The result of the completed operation, which can be of any type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.op" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">op</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Pass <code>message</code> data to <code>function</code> for processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message to perform the operation against</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output of the function</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If, and only if, the signature of <code>function</code> contains
  a <code>message</code> parameter, <code>message</code> itself will be passed
  along with any <code>args</code> and <code>kwargs</code> contained in the message.</li>
</ul>
</details>

<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li><code>message</code> will not be passed in cases where a "message"
  exists in <code>message.kwargs</code>.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass ``message`` data to ``function`` for processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message to perform the operation against</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (Any): output of the function</span>

<span class="sd">    Notes:</span>
<span class="sd">        * If, and only if, the signature of ``function`` contains</span>
<span class="sd">          a ``message`` parameter, ``message`` itself will be passed</span>
<span class="sd">          along with any ``args`` and ``kwargs`` contained in the message.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * ``message`` will not be passed in cases where a &quot;message&quot;</span>
<span class="sd">          exists in ``message.kwargs``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">kwargs</span> <span class="ow">and</span> <span class="n">_expects_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">message</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">message</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.post_op" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">post_op</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Operation to perform after running <code>op</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message <code>op()</code> was run against</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output of <code>op()</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">post_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Operation to perform after running ``op``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message ``op()`` was run against</span>
<span class="sd">        result (Any): output of ``op()``</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.pre_op" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_op</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Operation to perform before running <code>op</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message <code>op</code> will be run against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pre_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Operation to perform before running ``op``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message ``op`` will be run against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.revoke" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">revoke</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">skip_if_running</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Revoke the task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message to revoke</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_if_running</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, skip revoking the task if it is currently RUNNING.
Notes: requires <code>status_tracker</code> to be set.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Revoking </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Revoked </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">input_</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">revoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">skip_if_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Revoke the task.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message to revoke</span>
<span class="sd">        skip_if_running (bool): if ``True``, skip revoking the task if it is currently RUNNING.</span>
<span class="sd">            Notes: requires ``status_tracker`` to be set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Revoking </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_TASK_STATUSES</span>
    <span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Message is already terminal: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="n">skip_if_running</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;`skip_if_running` requires `status_tracker` to be set&quot;</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>
    <span class="k">elif</span> <span class="n">skip_if_running</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">status_update</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
        <span class="ow">and</span> <span class="n">status_update</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">RUNNING</span>
    <span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Message is currently running: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_revoked_key_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ttl</span><span class="o">=</span><span class="n">DEFAULT_TTL</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">exception_details</span><span class="o">=</span><span class="n">ExceptionDetails</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">get_exception_name</span><span class="p">(</span><span class="n">RevokedError</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Task Revoked&quot;</span><span class="p">,</span>
            <span class="n">traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.Task.update_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Update the status of a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message to update the status of.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TaskStatus (alsek.core.status.types.TaskStatus)" href="#alsek.core.status.types.TaskStatus">TaskStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>status to update the message to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">TaskStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the status of a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): message to update the status of.</span>
<span class="sd">        status (TaskStatus): status to update the message to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting status of &#39;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; to </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_tracker</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.core.task.TriggerTask" class="doc doc-heading">
            <code>TriggerTask</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a></code></p>


        <p>Triggered Task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>function</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function to use for the main operation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trigger</code>
            </td>
            <td>
                  <code>(<span title="apscheduler.triggers.cron.CronTrigger">CronTrigger</span>, <span title="apscheduler.triggers.date.DateTrigger">DateTrigger</span>, <span title="apscheduler.triggers.interval.IntervalTrigger">IntervalTrigger</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trigger
for task execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>broker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Broker (alsek.core.broker.Broker)" href="#alsek.core.broker.Broker">Broker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek broker</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the task. If <code>None</code>,
the class name will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>queue</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the queue to generate the task on.
If <code>None</code>, the default queue will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum amount of time (in milliseconds)
this task is permitted to run.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TASK_TIMEOUT">DEFAULT_TASK_TIMEOUT</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of allowed retries</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MAX_RETRIES">DEFAULT_MAX_RETRIES</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backoff</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff algorithm and parameters to use when computing
delay between retries</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExponentialBackoff (alsek.core.backoff.ExponentialBackoff)" href="#alsek.core.backoff.ExponentialBackoff">ExponentialBackoff</a>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_store</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ResultStore (alsek.storage.result.ResultStore)" href="#alsek.storage.result.ResultStore">ResultStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store for persisting task results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status_tracker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusTracker (alsek.core.status.standard.StatusTracker)" href="#alsek.core.status.standard.StatusTracker">StatusTracker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store for persisting task statuses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mechanism</code>
            </td>
            <td>
                  <code><span title="alsek.types.SupportedMechanismType">SupportedMechanismType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mechanism for executing the task. Must
be either "process" or "thread".</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MECHANISM">DEFAULT_MECHANISM</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>no_positional_args</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, the task will not accept positional arguments.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>* ``SchedulingError``</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the signature of <code>function</code> includes
parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/task.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TriggerTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triggered Task.</span>

<span class="sd">    Args:</span>
<span class="sd">        function (callable): function to use for the main operation</span>
<span class="sd">        trigger (CronTrigger, DateTrigger, IntervalTrigger): trigger</span>
<span class="sd">            for task execution.</span>
<span class="sd">        broker (Broker): an Alsek broker</span>
<span class="sd">        name (str, optional): the name of the task. If ``None``,</span>
<span class="sd">            the class name will be used.</span>
<span class="sd">        queue (str, optional): the name of the queue to generate the task on.</span>
<span class="sd">            If ``None``, the default queue will be used.</span>
<span class="sd">        timeout (int): the maximum amount of time (in milliseconds)</span>
<span class="sd">            this task is permitted to run.</span>
<span class="sd">        max_retries (int, optional): maximum number of allowed retries</span>
<span class="sd">        backoff (Backoff, optional): backoff algorithm and parameters to use when computing</span>
<span class="sd">            delay between retries</span>
<span class="sd">        result_store (ResultStore, optional): store for persisting task results</span>
<span class="sd">        status_tracker (StatusTracker, optional): store for persisting task statuses</span>
<span class="sd">        mechanism (SupportedMechanismType): mechanism for executing the task. Must</span>
<span class="sd">            be either &quot;process&quot; or &quot;thread&quot;.</span>
<span class="sd">        no_positional_args (bool): if ``True``, the task will not accept positional arguments.</span>

<span class="sd">    Warnings:</span>
<span class="sd">        * The signature of ``function`` cannot contain parameters</span>

<span class="sd">    Raises:</span>
<span class="sd">        * ``SchedulingError``: if the signature of ``function`` includes</span>
<span class="sd">            parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CronTrigger</span><span class="p">,</span> <span class="n">DateTrigger</span><span class="p">,</span> <span class="n">IntervalTrigger</span><span class="p">],</span>
        <span class="n">broker</span><span class="p">:</span> <span class="n">Broker</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TASK_TIMEOUT</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_RETRIES</span><span class="p">,</span>
        <span class="n">backoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Backoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentialBackoff</span><span class="p">(),</span>
        <span class="n">result_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResultStore</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">status_tracker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatusTracker</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mechanism</span><span class="p">:</span> <span class="n">SupportedMechanismType</span> <span class="o">=</span> <span class="n">DEFAULT_MECHANISM</span><span class="p">,</span>
        <span class="n">no_positional_args</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">function</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SchedulingError</span><span class="p">(</span><span class="s2">&quot;Function signature cannot includes parameters&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
            <span class="n">broker</span><span class="o">=</span><span class="n">broker</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
            <span class="n">backoff</span><span class="o">=</span><span class="n">backoff</span><span class="p">,</span>
            <span class="n">result_store</span><span class="o">=</span><span class="n">result_store</span><span class="p">,</span>
            <span class="n">status_tracker</span><span class="o">=</span><span class="n">status_tracker</span><span class="p">,</span>
            <span class="n">mechanism</span><span class="o">=</span><span class="n">mechanism</span><span class="p">,</span>
            <span class="n">no_positional_args</span><span class="o">=</span><span class="n">no_positional_args</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">trigger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">BackgroundScheduler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">serialized_task</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
        <span class="n">serialized_task</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span>
        <span class="k">return</span> <span class="n">serialized_task</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_job</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Job</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SchedulingError</span><span class="p">(</span><span class="s2">&quot;Task already scheduled&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span>
            <span class="n">_MultiSubmit</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                <span class="n">broker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="p">,</span>
                <span class="n">on_submit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_submit</span><span class="p">,</span>
                <span class="n">callback_op</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUBMITTED</span><span class="p">),</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">trigger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If the task has been generated.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the currently scheduled task.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises</span>
<span class="sd">            * AttributeError: if a task has not yet</span>
<span class="sd">                been generated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">remove_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">JobLookupError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Task not generated&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pause the underlying scheduler.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resume the underlying scheduler.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown the underlying scheduler.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.core.task.TriggerTask.generated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generated</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>If the task has been generated.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.TriggerTask.clear" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Clear the currently scheduled task.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Raises
    * AttributeError: if a task has not yet
        been generated</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear the currently scheduled task.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises</span>
<span class="sd">        * AttributeError: if a task has not yet</span>
<span class="sd">            been generated</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">remove_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">JobLookupError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Task not generated&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.TriggerTask.pause" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pause</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Pause the underlying scheduler.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pause the underlying scheduler.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.TriggerTask.resume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resume</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Resume the underlying scheduler.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resume the underlying scheduler.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.core.task.TriggerTask.shutdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shutdown</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Shutdown the underlying scheduler.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shutdown the underlying scheduler.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="alsek.core.task.task" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">task</span><span class="p">(</span><span class="n">broker</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">DEFAULT_TASK_TIMEOUT</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="n">DEFAULT_MAX_RETRIES</span><span class="p">,</span> <span class="n">backoff</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(),</span> <span class="n">trigger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result_store</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status_tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mechanism</span><span class="o">=</span><span class="n">DEFAULT_MECHANISM</span><span class="p">,</span> <span class="n">no_positional_args</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">base_task</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Wrapper for task construction.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>broker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Broker (alsek.core.broker.Broker)" href="#alsek.core.broker.Broker">Broker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek broker</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the task. If <code>None</code>,
the class name will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>queue</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the queue to generate the task on.
If <code>None</code>, the default queue will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum amount of time (in milliseconds)
this task is permitted to run.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_TASK_TIMEOUT">DEFAULT_TASK_TIMEOUT</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of allowed retries</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MAX_RETRIES">DEFAULT_MAX_RETRIES</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backoff</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Backoff (alsek.core.backoff.Backoff)" href="#alsek.core.backoff.Backoff">Backoff</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backoff algorithm and parameters to use when computing
delay between retries</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExponentialBackoff (alsek.core.backoff.ExponentialBackoff)" href="#alsek.core.backoff.ExponentialBackoff">ExponentialBackoff</a>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trigger</code>
            </td>
            <td>
                  <code>(<span title="apscheduler.triggers.cron.CronTrigger">CronTrigger</span>, <span title="apscheduler.triggers.date.DateTrigger">DateTrigger</span>, <span title="apscheduler.triggers.interval.IntervalTrigger">IntervalTrigger</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trigger
for task execution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_store</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ResultStore (alsek.storage.result.ResultStore)" href="#alsek.storage.result.ResultStore">ResultStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store for persisting task results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status_tracker</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="StatusTracker (alsek.core.status.standard.StatusTracker)" href="#alsek.core.status.standard.StatusTracker">StatusTracker</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store for persisting task statuses</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mechanism</code>
            </td>
            <td>
                  <code><span title="alsek.types.SupportedMechanismType">SupportedMechanismType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mechanism for executing the task. Must
be either "process" or "thread".</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_MECHANISM">DEFAULT_MECHANISM</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>no_positional_args</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, the task will not accept positional arguments.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_task</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>base to use for task constuction.
If <code>None</code>, a base task will be selected automatically.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>wrapper</code></td>            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>task-wrapped function</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>* ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if a <code>trigger</code> and not supported by <code>base_task</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek</span><span class="w"> </span><span class="kn">import</span> <span class="n">Broker</span><span class="p">,</span> <span class="n">task</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.storage.backends.redis.standard</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisBackend</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">backend</span> <span class="o">=</span> <span class="n">RedisBackend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">broker</span> <span class="o">=</span> <span class="n">Broker</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nd">@task</span><span class="p">(</span><span class="n">broker</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>alsek/core/task.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">task</span><span class="p">(</span>
    <span class="n">broker</span><span class="p">:</span> <span class="n">Broker</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TASK_TIMEOUT</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_RETRIES</span><span class="p">,</span>
    <span class="n">backoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Backoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentialBackoff</span><span class="p">(),</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">CronTrigger</span><span class="p">,</span> <span class="n">DateTrigger</span><span class="p">,</span> <span class="n">IntervalTrigger</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">result_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResultStore</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status_tracker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatusTracker</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mechanism</span><span class="p">:</span> <span class="n">SupportedMechanismType</span> <span class="o">=</span> <span class="n">DEFAULT_MECHANISM</span><span class="p">,</span>
    <span class="n">no_positional_args</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">base_task</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Task</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Task</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for task construction.</span>

<span class="sd">    Args:</span>
<span class="sd">        broker (Broker): an Alsek broker</span>
<span class="sd">        name (str, optional): the name of the task. If ``None``,</span>
<span class="sd">            the class name will be used.</span>
<span class="sd">        queue (str, optional): the name of the queue to generate the task on.</span>
<span class="sd">            If ``None``, the default queue will be used.</span>
<span class="sd">        timeout (int): the maximum amount of time (in milliseconds)</span>
<span class="sd">            this task is permitted to run.</span>
<span class="sd">        max_retries (int, optional): maximum number of allowed retries</span>
<span class="sd">        backoff (Backoff, optional): backoff algorithm and parameters to use when computing</span>
<span class="sd">            delay between retries</span>
<span class="sd">        trigger (CronTrigger, DateTrigger, IntervalTrigger, optional): trigger</span>
<span class="sd">            for task execution.</span>
<span class="sd">        result_store (ResultStore, optional): store for persisting task results</span>
<span class="sd">        status_tracker (StatusTracker, optional): store for persisting task statuses</span>
<span class="sd">        mechanism (SupportedMechanismType): mechanism for executing the task. Must</span>
<span class="sd">            be either &quot;process&quot; or &quot;thread&quot;.</span>
<span class="sd">        no_positional_args (bool): if ``True``, the task will not accept positional arguments.</span>
<span class="sd">        base_task (Type[Task]): base to use for task constuction.</span>
<span class="sd">            If ``None``, a base task will be selected automatically.</span>

<span class="sd">    Returns:</span>
<span class="sd">        wrapper (callable): task-wrapped function</span>

<span class="sd">    Raises:</span>
<span class="sd">        * ValueError: if a ``trigger`` and not supported by ``base_task``</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from alsek import Broker, task</span>
<span class="sd">        &gt;&gt;&gt; from alsek.storage.backends.redis.standard import RedisBackend</span>

<span class="sd">        &gt;&gt;&gt; backend = RedisBackend()</span>
<span class="sd">        &gt;&gt;&gt; broker = Broker(backend)</span>

<span class="sd">        &gt;&gt;&gt; @task(broker)</span>
<span class="sd">        ... def add(a: int, b: int) -&gt; int:</span>
<span class="sd">        ...     return a + b</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parsed_base_task</span> <span class="o">=</span> <span class="n">_parse_base_task</span><span class="p">(</span><span class="n">base_task</span><span class="p">,</span> <span class="n">trigger</span><span class="o">=</span><span class="n">trigger</span><span class="p">)</span>
    <span class="n">base_task_signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">parsed_base_task</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">trigger</span> <span class="ow">and</span> <span class="s2">&quot;trigger&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_task_signature</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trigger not supported by </span><span class="si">{</span><span class="n">parsed_base_task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parsed_base_task</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">function</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">broker</span><span class="o">=</span><span class="n">broker</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
            <span class="n">backoff</span><span class="o">=</span><span class="n">backoff</span><span class="p">,</span>
            <span class="n">mechanism</span><span class="o">=</span><span class="n">mechanism</span><span class="p">,</span>
            <span class="n">no_positional_args</span><span class="o">=</span><span class="n">no_positional_args</span><span class="p">,</span>
            <span class="n">result_store</span><span class="o">=</span><span class="n">result_store</span><span class="p">,</span>
            <span class="n">status_tracker</span><span class="o">=</span><span class="n">status_tracker</span><span class="p">,</span>
            <span class="o">**</span><span class="p">(</span>  <span class="c1"># noqa (handled above)</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="n">trigger</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;trigger&quot;</span> <span class="ow">in</span> <span class="n">base_task_signature</span><span class="o">.</span><span class="n">parameters</span>
                <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.core.worker" class="doc doc-heading">
            <code>worker</code>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="alsek.core.worker.process" class="doc doc-heading">
            <code>process</code>


</h5>

    <div class="doc doc-contents ">

        <p>Process Worker Pool</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.worker.process.ProcessWorkerPool" class="doc doc-heading">
            <code>ProcessWorkerPool</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="alsek.core.worker._base.BaseWorkerPool">BaseWorkerPool</span></code></p>


        <p>Fixed-size pool that runs each task in its <em>own</em> forked process
(via <code>ProcessTaskFuture</code>).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_processes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of live <code>ProcessTaskFuture</code>s.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of milliseconds between background
runs of a scan to prune spent futures.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/core/worker/process.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessWorkerPool</span><span class="p">(</span><span class="n">BaseWorkerPool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixed-size pool that runs each task in its *own* forked process</span>
<span class="sd">    (via `ProcessTaskFuture`).</span>

<span class="sd">    Args:</span>
<span class="sd">        n_processes (int): Maximum number of live `ProcessTaskFuture`s.</span>
<span class="sd">        prune_interval (int): Number of milliseconds between background</span>
<span class="sd">            runs of a scan to prune spent futures.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_processes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mechanism</span><span class="o">=</span><span class="s2">&quot;process&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span> <span class="o">=</span> <span class="n">n_processes</span> <span class="ow">or</span> <span class="n">smart_cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_interval</span> <span class="o">=</span> <span class="n">prune_interval</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ProcessTaskFuture</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

        <span class="c1"># Use a simple daemon thread instead of APScheduler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prune_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prune_loop</span><span class="p">,</span>
            <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ProcessPool-Pruner&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prune_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prune_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Background thread that periodically prunes futures.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during future pruning: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

            <span class="c1"># Sleep until next interval or shutdown</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_interval</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_boot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Starting process-based worker pool with up to </span><span class="si">%s</span><span class="s2"> workers (</span><span class="si">%s</span><span class="s2"> max process</span><span class="si">%s</span><span class="s2">)...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;es&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_boot</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_slot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prune spent futures.&quot;&quot;&quot;</span>
        <span class="n">kept</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ProcessTaskFuture</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">time_limit_exceeded</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="ne">TimeoutError</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
                <span class="n">kept</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span> <span class="o">=</span> <span class="n">kept</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminate everything that is still alive.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">TerminationError</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit a single message&quot;&quot;&quot;</span>
        <span class="n">submitted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_slot</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ProcessTaskFuture</span><span class="p">(</span>
                    <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_map</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">],</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">submitted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">submitted</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.process.ProcessWorkerPool.on_shutdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_shutdown</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Terminate everything that is still alive.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Terminate everything that is still alive.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">TerminationError</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.process.ProcessWorkerPool.prune" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prune</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Prune spent futures.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prune spent futures.&quot;&quot;&quot;</span>
    <span class="n">kept</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ProcessTaskFuture</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">time_limit_exceeded</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="ne">TimeoutError</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
            <span class="n">kept</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span> <span class="o">=</span> <span class="n">kept</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.process.ProcessWorkerPool.submit_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Submit a single message</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">submit_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submit a single message&quot;&quot;&quot;</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_slot</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ProcessTaskFuture</span><span class="p">(</span>
                <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_map</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">],</span>
                <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">submitted</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">submitted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.core.worker.thread" class="doc doc-heading">
            <code>thread</code>


</h5>

    <div class="doc doc-contents ">

        <p>Thread Worker Pool</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.core.worker.thread.ProcessGroup" class="doc doc-heading">
            <code>ProcessGroup</code>


</h6>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessGroup</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">complete_only_on_thread_exit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">slot_wait_interval_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">package_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_threads</span> <span class="o">=</span> <span class="n">n_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complete_only_on_thread_exit</span> <span class="o">=</span> <span class="n">complete_only_on_thread_exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slot_wait_interval_seconds</span> <span class="o">=</span> <span class="n">slot_wait_interval_seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span> <span class="n">Queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">n_threads</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="p">:</span> <span class="n">Event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">_start_thread_worker</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="p">,</span>
                <span class="n">n_threads</span><span class="p">,</span>
                <span class="n">slot_wait_interval_seconds</span><span class="p">,</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
                <span class="n">package_name</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_slot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">full</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">task</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>
            <span class="n">message</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">complete_only_on_thread_exit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">dill</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Full</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the group of threads in this process group.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeout (int, float): the time to wait in seconds</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="c1"># 2. Wait a bit for graceful exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="c1"># 3. Hard kill if still alive</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.thread.ProcessGroup.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Stop the group of threads in this process group.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>(<span title="int">int</span>, <span title="float">float</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the time to wait in seconds</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop the group of threads in this process group.</span>

<span class="sd">    Args:</span>
<span class="sd">        timeout (int, float): the time to wait in seconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. Signal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="c1"># 2. Wait a bit for graceful exit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="c1"># 3. Hard kill if still alive</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="alsek.core.worker.thread.ThreadWorkerPool" class="doc doc-heading">
            <code>ThreadWorkerPool</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="alsek.core.worker._base.BaseWorkerPool">BaseWorkerPool</span></code></p>


        <p>Elastic thread-based pool.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_threads</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of threads to use per group.</p>
              </div>
            </td>
            <td>
                  <code>8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_processes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of process groups to use</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_process_floor</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the minimum number of processes to have active
at any given time, regardless of load.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>complete_only_on_thread_exit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, only mark the future
as complete when the thread formally exits (i.e., is not alive).
Pro: more rigorous — avoids marking the task complete until the thread fully terminates.
Useful when you need strict control over thread lifecycle (e.g., for resource management).
Con: may lead to hanging if the thread doesn't terminate quickly (e.g., when using
<code>thread_raise()</code> during revocation). This can also temporarily result in more than the
allotted number of threads running, because it entails treating a thread as
expired regardless of its actual status.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>package_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the package to import in worker processes
to trigger any initialization code in its <code>__init__.py</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to <code>BaseWorkerPool()</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Spawns a new <strong>process</strong> (ThreadProcessGroup) only when all existing
  groups are saturated and the hard ceiling <code>n_processes</code> hasn't been hit.</li>
<li>Each group runs up to <code>n_threads</code> true ThreadTaskFutures concurrently.</li>
<li>Total worker capacity is <code>n_threads * n_processes</code>.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ThreadWorkerPool</span><span class="p">(</span><span class="n">BaseWorkerPool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Elastic thread-based pool.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_threads (int): the number of threads to use per group.</span>
<span class="sd">        n_processes (int, optional): the number of process groups to use</span>
<span class="sd">        n_process_floor (int): the minimum number of processes to have active</span>
<span class="sd">            at any given time, regardless of load.</span>
<span class="sd">        complete_only_on_thread_exit (bool): if ``True``, only mark the future</span>
<span class="sd">            as complete when the thread formally exits (i.e., is not alive).</span>
<span class="sd">            Pro: more rigorous — avoids marking the task complete until the thread fully terminates.</span>
<span class="sd">            Useful when you need strict control over thread lifecycle (e.g., for resource management).</span>
<span class="sd">            Con: may lead to hanging if the thread doesn&#39;t terminate quickly (e.g., when using</span>
<span class="sd">            `thread_raise()` during revocation). This can also temporarily result in more than the</span>
<span class="sd">            allotted number of threads running, because it entails treating a thread as</span>
<span class="sd">            expired regardless of its actual status.</span>
<span class="sd">        package_name (str, optional): the name of the package to import in worker processes</span>
<span class="sd">            to trigger any initialization code in its `__init__.py`.</span>
<span class="sd">        **kwargs (Keyword Args): Keyword arguments to pass to ``BaseWorkerPool()``.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * Spawns a new **process** (ThreadProcessGroup) only when all existing</span>
<span class="sd">          groups are saturated and the hard ceiling `n_processes` hasn&#39;t been hit.</span>
<span class="sd">        * Each group runs up to `n_threads` true ThreadTaskFutures concurrently.</span>
<span class="sd">        * Total worker capacity is ``n_threads * n_processes``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">n_processes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_process_floor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">complete_only_on_thread_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">package_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mechanism</span><span class="o">=</span><span class="s2">&quot;thread&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span> <span class="o">=</span> <span class="n">n_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span> <span class="o">=</span> <span class="n">n_processes</span> <span class="ow">or</span> <span class="n">smart_cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span> <span class="o">=</span> <span class="n">n_process_floor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complete_only_on_thread_exit</span> <span class="o">=</span> <span class="n">complete_only_on_thread_exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_threads must be &gt; 0&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_processes must be &gt; 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_process_floor must be &lt;= n_processes.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ProcessGroup</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_new_process_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessGroup</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Starting new process group...&quot;</span><span class="p">)</span>
        <span class="n">new_process_group</span> <span class="o">=</span> <span class="n">ProcessGroup</span><span class="p">(</span>
            <span class="n">n_threads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span><span class="p">,</span>
            <span class="n">complete_only_on_thread_exit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">complete_only_on_thread_exit</span><span class="p">,</span>
            <span class="n">slot_wait_interval_seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_slot_wait_interval_seconds</span><span class="p">,</span>
            <span class="n">package_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_process_group</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_process_group</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_boot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Starting thread-based worker pool with up to </span><span class="si">%s</span><span class="s2"> workers (</span><span class="si">%s</span><span class="s2"> max thread</span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> max process</span><span class="si">%s</span><span class="s2">)...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;es&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Provisioning initial collection of </span><span class="si">%s</span><span class="s2"> processes...&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_make_new_process_group</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_boot</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop all futures in the pool.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prune exited process groups, but only enforce floor if NOT shutting down.&quot;&quot;&quot;</span>
        <span class="c1"># 1. Filter out any groups whose processes have exited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># 2. Otherwise, ensure at least n_process_floor</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_make_new_process_group</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_acquire_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessGroup</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">has_slot</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">g</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_processes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_new_process_group</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit a single message&quot;&quot;&quot;</span>
        <span class="n">submitted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_group</span><span class="p">():</span>  <span class="c1"># we have a slot → run it</span>
            <span class="n">submitted</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_map</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">],</span>
                <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">submitted</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.thread.ThreadWorkerPool.on_shutdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_shutdown</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Stop all futures in the pool.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop all futures in the pool.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.thread.ThreadWorkerPool.prune" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prune</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Prune exited process groups, but only enforce floor if NOT shutting down.</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prune exited process groups, but only enforce floor if NOT shutting down.&quot;&quot;&quot;</span>
    <span class="c1"># 1. Filter out any groups whose processes have exited</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">g</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="c1"># 2. Otherwise, ensure at least n_process_floor</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_process_floor</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_progress_groups</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_new_process_group</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.core.worker.thread.ThreadWorkerPool.submit_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Submit a single message</p>


            <details class="quote">
              <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">submit_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submit a single message&quot;&quot;&quot;</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">group</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_group</span><span class="p">():</span>  <span class="c1"># we have a slot → run it</span>
        <span class="n">submitted</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
            <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_map</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">],</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">submitted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="alsek.core.worker.thread.ThreadsInProcessGroup" class="doc doc-heading">
            <code>ThreadsInProcessGroup</code>


</h6>


    <div class="doc doc-contents ">


        <p>• Runs inside a forked process
• Accepts work items via <code>Queue</code>
• Spawns at most <code>n_threads</code> ThreadTaskFutures concurrently</p>







              <details class="quote">
                <summary>Source code in <code>alsek/core/worker/thread.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ThreadsInProcessGroup</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    • Runs inside a forked process</span>
<span class="sd">    • Accepts work items via `Queue`</span>
<span class="sd">    • Spawns at most `n_threads` ThreadTaskFutures concurrently</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
        <span class="n">shutdown_event</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span>
        <span class="n">n_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">slot_wait_interval_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span> <span class="o">=</span> <span class="n">shutdown_event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span> <span class="o">=</span> <span class="n">n_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slot_wait_interval_seconds</span> <span class="o">=</span> <span class="n">slot_wait_interval_seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">log_level</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_live</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ThreadTaskFuture</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kept</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ThreadTaskFuture</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">time_limit_exceeded</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="ne">TimeoutError</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
                <span class="n">kept</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live</span> <span class="o">=</span> <span class="n">kept</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_has_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_threads</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_spawn_future</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">task_dict</span><span class="p">,</span> <span class="n">msg_dict</span><span class="p">,</span> <span class="n">exit_flag</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ThreadTaskFuture</span><span class="p">(</span>
                <span class="n">task</span><span class="o">=</span><span class="n">Task</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">task_dict</span><span class="p">),</span>
                <span class="n">message</span><span class="o">=</span><span class="n">Message</span><span class="p">(</span><span class="o">**</span><span class="n">msg_dict</span><span class="p">),</span>
                <span class="n">complete_only_on_thread_exit</span><span class="o">=</span><span class="n">exit_flag</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_stop_all_live_futures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">TerminationError</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@suppress_exception</span><span class="p">(</span>
        <span class="ne">KeyboardInterrupt</span><span class="p">,</span>
        <span class="n">on_suppress</span><span class="o">=</span><span class="k">lambda</span> <span class="n">error</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Keyboard Interrupt Detected&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="c1"># 1. reap finished / timed-out futures</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span><span class="p">()</span>

                <span class="c1"># 2. Throttle if thread slots are full</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_capacity</span><span class="p">():</span>
                    <span class="c1"># Wait *either* for a slot OR the shutdown flag</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_wait_interval_seconds</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># 3. Try to pull one unit of work</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_wait_interval_seconds</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># 4. Launch a new ThreadTaskFuture</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_spawn_future</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_all_live_futures</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.defaults" class="doc doc-heading">
            <code>defaults</code>


</h3>

    <div class="doc doc-contents ">

        <p>Defaults</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.exceptions" class="doc doc-heading">
            <code>exceptions</code>


</h3>

    <div class="doc doc-contents ">

        <p>Exceptions</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.AlsekError" class="doc doc-heading">
            <code>AlsekError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Base Alsek error.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AlsekError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base Alsek error.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.MessageAlreadyExistsError" class="doc doc-heading">
            <code>MessageAlreadyExistsError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Message already exists in backend.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessageAlreadyExistsError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Message already exists in backend.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.MessageDoesNotExistsError" class="doc doc-heading">
            <code>MessageDoesNotExistsError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Message does not exist in backend.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessageDoesNotExistsError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Message does not exist in backend.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.MultipleBrokersError" class="doc doc-heading">
            <code>MultipleBrokersError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Multiple brokers in use.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MultipleBrokersError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiple brokers in use.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.NoTasksFoundError" class="doc doc-heading">
            <code>NoTasksFoundError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>No tasks found.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NoTasksFoundError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;No tasks found.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.RevokedError" class="doc doc-heading">
            <code>RevokedError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Alsek task revoked error.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RevokedError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek task revoked error.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.SchedulingError" class="doc doc-heading">
            <code>SchedulingError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Error scheduling work.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SchedulingError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error scheduling work.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.TaskNameCollisionError" class="doc doc-heading">
            <code>TaskNameCollisionError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Duplicate task detected.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskNameCollisionError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Duplicate task detected.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.TerminationError" class="doc doc-heading">
            <code>TerminationError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Alsek termination error.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TerminationError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek termination error.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="alsek.exceptions.ValidationError" class="doc doc-heading">
            <code>ValidationError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AlsekError (alsek.exceptions.AlsekError)" href="#alsek.exceptions.AlsekError">AlsekError</a></code></p>


        <p>Data validation failed.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ValidationError</span><span class="p">(</span><span class="n">AlsekError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data validation failed.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.storage" class="doc doc-heading">
            <code>storage</code>


</h3>

    <div class="doc doc-contents ">

        <p>Storage</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="alsek.storage.backends" class="doc doc-heading">
            <code>backends</code>


</h4>

    <div class="doc doc-contents ">

        <p>Backend</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="alsek.storage.backends.abstract" class="doc doc-heading">
            <code>abstract</code>


</h5>

    <div class="doc doc-contents ">

        <p>Abstract</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.storage.backends.abstract.BaseBackend" class="doc doc-heading">
            <code>BaseBackend</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Backend base class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>namespace</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prefix to use when inserting
names in the backend</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_NAMESPACE">DEFAULT_NAMESPACE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>serializer</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Serializer (alsek.storage.serialization.Serializer)" href="#alsek.storage.serialization.Serializer">Serializer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tool for encoding and decoding
values written into the backend.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="JsonSerializer (alsek.storage.serialization.JsonSerializer)" href="#alsek.storage.serialization.JsonSerializer">JsonSerializer</a>()</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseBackend</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Backend base class.</span>

<span class="sd">    Args:</span>
<span class="sd">        namespace (str): prefix to use when inserting</span>
<span class="sd">            names in the backend</span>
<span class="sd">        serializer (Serializer): tool for encoding and decoding</span>
<span class="sd">            values written into the backend.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">IS_ASYNC</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">SUPPORTS_PUBSUB</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_NAMESPACE</span><span class="p">,</span>
        <span class="n">serializer</span><span class="p">:</span> <span class="n">Serializer</span> <span class="o">=</span> <span class="n">JsonSerializer</span><span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serializer</span> <span class="o">=</span> <span class="n">serializer</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span>
            <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="c1"># ToDo: drop `backend` and just dump settings.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">gather_init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">dill</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_settings</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BaseBackend</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">in_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if ``name`` belong to the current namespace.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): a name (key)</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        Warning:</span>
<span class="sd">            * ``name`` should be a complete (i.e., _full_) name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an item&#39;s complete name, including the namespace</span>
<span class="sd">        in which it exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of an item</span>

<span class="sd">        Returns:</span>
<span class="sd">            full_name (str): a name of the form ``&quot;{NAMESPACE}:{name}&quot;``</span>

<span class="sd">        Notes:</span>
<span class="sd">            * If ``name`` is already the full name, this method</span>
<span class="sd">              will collapse to a no-op.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an item&#39;s short name, without the namespace</span>
<span class="sd">        in which it exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the full name of an item</span>

<span class="sd">        Returns:</span>
<span class="sd">            short_name (str): ``name`` without the namespace prefix</span>

<span class="sd">        Notes:</span>
<span class="sd">            * If ``name`` is already the short name, this method</span>
<span class="sd">              will collapse to a no-op.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if ``name`` exists in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set ``name`` to ``value`` in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>
<span class="sd">            value (Any): value to set for ``name``</span>
<span class="sd">            nx (bool): if ``True`` the item must not exist prior to being set</span>
<span class="sd">            ttl (int, optional): time to live for the entry in milliseconds</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if ``nx`` is ``True`` and ``name`` already exists</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Empty</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ``name`` from the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>
<span class="sd">            default (Any, Type[Empty], optional): default value for ``name``</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a ``name`` from the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>
<span class="sd">            missing_ok (bool): if ``True``, do not raise for missing</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if ``missing_ok`` is ``False`` and ``name`` is not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">priority_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an item to a priority-sorted set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>
<span class="sd">            unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>
<span class="sd">            priority (float): The numeric priority score (decide if lower or higher means higher priority).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">priority_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get (peek) the highest-priority item without removing it.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            item (str, optional): The member with the highest priority, or None if empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">priority_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over the items in a priority-sorted set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            priority (Iterable[str]): An iterable of members in the sorted set, sorted by priority.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">priority_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an item from a priority-sorted set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>
<span class="sd">            unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish to a channel.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel (str): channel name</span>
<span class="sd">            value (Any): value to publish</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subscribe to a channel.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel (str): channel name</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterable[str | dict[str, Any]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scan the backend for matching names.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern (str, optional): pattern to limit search to</span>

<span class="sd">        Returns:</span>
<span class="sd">            matches_stream (Iterable[str]): a stream of matching name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count the number of items in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern (str, optional): pattern to limit count to</span>

<span class="sd">        Returns:</span>
<span class="sd">            count (int): number of matching names</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all items in backend under the current namespace.</span>

<span class="sd">        Args:</span>
<span class="sd">             raise_on_error (bool): raise if a delete operation fails</span>

<span class="sd">        Returns:</span>
<span class="sd">            count (int): number of items cleared</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if ``raise_on_error`` and a delete operation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.clear_namespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_namespace</span><span class="p">(</span><span class="n">raise_on_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Clear all items in backend under the current namespace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_error</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>raise if a delete operation fails</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>count</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of items cleared</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>raise_on_error</code> and a delete operation fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all items in backend under the current namespace.</span>

<span class="sd">    Args:</span>
<span class="sd">         raise_on_error (bool): raise if a delete operation fails</span>

<span class="sd">    Returns:</span>
<span class="sd">        count (int): number of items cleared</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: if ``raise_on_error`` and a delete operation fails</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Count the number of items in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pattern to limit count to</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>count</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of matching names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of items in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern (str, optional): pattern to limit count to</span>

<span class="sd">    Returns:</span>
<span class="sd">        count (int): number of matching names</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Delete a <code>name</code> from the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>missing_ok</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, do not raise for missing</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>missing_ok</code> is <code>False</code> and <code>name</code> is not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a ``name`` from the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>
<span class="sd">        missing_ok (bool): if ``True``, do not raise for missing</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: if ``missing_ok`` is ``False`` and ``name`` is not found.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Check if <code>name</code> exists in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if ``name`` exists in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.full_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Get an item's complete name, including the namespace
in which it exists.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of an item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>full_name</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a name of the form <code>"{NAMESPACE}:{name}"</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If <code>name</code> is already the full name, this method
  will collapse to a no-op.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an item&#39;s complete name, including the namespace</span>
<span class="sd">    in which it exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): the name of an item</span>

<span class="sd">    Returns:</span>
<span class="sd">        full_name (str): a name of the form ``&quot;{NAMESPACE}:{name}&quot;``</span>

<span class="sd">    Notes:</span>
<span class="sd">        * If ``name`` is already the full name, this method</span>
<span class="sd">          will collapse to a no-op.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Get <code>name</code> from the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default</code>
            </td>
            <td>
                  <code>(<span title="typing.Any">Any</span>, <span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="Empty (alsek.types.Empty)" href="#alsek.types.Empty">Empty</a>])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default value for <code>name</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Empty</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get ``name`` from the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>
<span class="sd">        default (Any, Type[Empty], optional): default value for ``name``</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.in_namespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">in_namespace</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Determine if <code>name</code> belong to the current namespace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a name (key)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li><code>name</code> should be a complete (i.e., <em>full</em>) name.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">in_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if ``name`` belong to the current namespace.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): a name (key)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    Warning:</span>
<span class="sd">        * ``name`` should be a complete (i.e., _full_) name.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.priority_add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Add an item to a priority-sorted set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The item's (Message's) unique identifier</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>priority</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The numeric priority score (decide if lower or higher means higher priority).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">priority_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an item to a priority-sorted set.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>
<span class="sd">        unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>
<span class="sd">        priority (float): The numeric priority score (decide if lower or higher means higher priority).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.priority_get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Get (peek) the highest-priority item without removing it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>item</code></td>            <td>
                  <code>(<span title="str">str</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The member with the highest priority, or None if empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">priority_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get (peek) the highest-priority item without removing it.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        item (str, optional): The member with the highest priority, or None if empty.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.priority_iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_iter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Iterate over the items in a priority-sorted set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>priority</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An iterable of members in the sorted set, sorted by priority.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">priority_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over the items in a priority-sorted set.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        priority (Iterable[str]): An iterable of members in the sorted set, sorted by priority.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.priority_remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_remove</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Remove an item from a priority-sorted set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The item's (Message's) unique identifier</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">priority_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove an item from a priority-sorted set.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>
<span class="sd">        unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.pub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pub</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Publish to a channel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>channel name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value to publish</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publish to a channel.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel (str): channel name</span>
<span class="sd">        value (Any): value to publish</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Scan the backend for matching names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pattern to limit search to</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>matches_stream</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a stream of matching name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan the backend for matching names.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern (str, optional): pattern to limit search to</span>

<span class="sd">    Returns:</span>
<span class="sd">        matches_stream (Iterable[str]): a stream of matching name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Set <code>name</code> to <code>value</code> in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value to set for <code>name</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nx</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> the item must not exist prior to being set</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live for the entry in milliseconds</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>nx</code> is <code>True</code> and <code>name</code> already exists</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set ``name`` to ``value`` in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>
<span class="sd">        value (Any): value to set for ``name``</span>
<span class="sd">        nx (bool): if ``True`` the item must not exist prior to being set</span>
<span class="sd">        ttl (int, optional): time to live for the entry in milliseconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: if ``nx`` is ``True`` and ``name`` already exists</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.short_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">short_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Get an item's short name, without the namespace
in which it exists.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the full name of an item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>short_name</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>name</code> without the namespace prefix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If <code>name</code> is already the short name, this method
  will collapse to a no-op.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an item&#39;s short name, without the namespace</span>
<span class="sd">    in which it exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): the full name of an item</span>

<span class="sd">    Returns:</span>
<span class="sd">        short_name (str): ``name`` without the namespace prefix</span>

<span class="sd">    Notes:</span>
<span class="sd">        * If ``name`` is already the short name, this method</span>
<span class="sd">          will collapse to a no-op.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.abstract.BaseBackend.sub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Subscribe to a channel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>channel name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="str">str</span> | <span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterable[str | dict[str, Any]]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/abstract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subscribe to a channel.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel (str): channel name</span>

<span class="sd">    Returns:</span>
<span class="sd">        Iterable[str | dict[str, Any]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.storage.backends.lazy" class="doc doc-heading">
            <code>lazy</code>


</h5>

    <div class="doc doc-contents ">

        <p>Lazy</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="alsek.storage.backends.lazy.LazyClient" class="doc doc-heading">
            <code>LazyClient</code>


</h6>


    <div class="doc doc-contents ">


        <p>Lazy client.</p>
<p>Wrapper for lazy client initialization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client_func</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a callable which returns
a backend client.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/storage/backends/lazy.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LazyClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lazy client.</span>

<span class="sd">    Wrapper for lazy client initialization.</span>

<span class="sd">    Args:</span>
<span class="sd">        client_func (callable): a callable which returns</span>
<span class="sd">            a backend client.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_func</span> <span class="o">=</span> <span class="n">client_func</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute ``client_func``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            client (Any): a backend client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_func</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="alsek.storage.backends.lazy.LazyClient.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Execute <code>client_func</code>.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>client</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a backend client</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/lazy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute ``client_func``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        client (Any): a backend client</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_func</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="alsek.storage.backends.redis" class="doc doc-heading">
            <code>redis</code>


</h5>

    <div class="doc doc-contents ">

        <p>Redis</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h6 id="alsek.storage.backends.redis.asyncio" class="doc doc-heading">
            <code>asyncio</code>


</h6>

    <div class="doc doc-contents ">

        <p>Asynchronous Redis Backend</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h7 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend" class="doc doc-heading">
            <code>AsyncRedisBackend</code>


</h7>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="alsek.storage.backends.abstract.AsyncBackend">AsyncBackend</span></code></p>


        <p>Asynchronous Redis Backend.</p>
<p>This backend is powered by Redis and provides asynchronous support
for Redis operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conn</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="AsyncRedis">AsyncRedis</span>, <a class="autorefs autorefs-internal" title="LazyClient (alsek.storage.backends.lazy.LazyClient)" href="#alsek.storage.backends.lazy.LazyClient">LazyClient</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A connection URL,
an <code>AsyncRedis</code> instance, or a <code>LazyClient</code>. If <code>None</code>, a default
<code>AsyncRedis</code> instance is created.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>namespace</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prefix to use when inserting
names in the backend</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_NAMESPACE">DEFAULT_NAMESPACE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>serializer</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Serializer (alsek.storage.serialization.Serializer)" href="#alsek.storage.serialization.Serializer">Serializer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tool for encoding and decoding
values written into the backend.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="JsonSerializer (alsek.storage.serialization.JsonSerializer)" href="#alsek.storage.serialization.JsonSerializer">JsonSerializer</a>()</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AsyncRedisBackend</span><span class="p">(</span><span class="n">AsyncBackend</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Asynchronous Redis Backend.</span>

<span class="sd">    This backend is powered by Redis and provides asynchronous support</span>
<span class="sd">    for Redis operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        conn (Optional[Union[str, AsyncRedis, LazyClient]]): A connection URL,</span>
<span class="sd">            an `AsyncRedis` instance, or a `LazyClient`. If `None`, a default</span>
<span class="sd">            `AsyncRedis` instance is created.</span>
<span class="sd">        namespace (str): prefix to use when inserting</span>
<span class="sd">            names in the backend</span>
<span class="sd">        serializer (Serializer): tool for encoding and decoding</span>
<span class="sd">            values written into the backend.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">IS_ASYNC</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">SUPPORTS_PUBSUB</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">conn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RedisAsync</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_NAMESPACE</span><span class="p">,</span>
        <span class="n">serializer</span><span class="p">:</span> <span class="n">Serializer</span> <span class="o">=</span> <span class="n">JsonSerializer</span><span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
            <span class="n">serializer</span><span class="o">=</span><span class="n">serializer</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn_parse</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_conn_parse</span><span class="p">(</span>
        <span class="n">conn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RedisAsync</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">RedisAsync</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the connection parameter to obtain an AsyncRedis or LazyClient instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            conn (Optional[Union[str, AsyncRedis, LazyClient]]): The connection parameter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[AsyncRedis, LazyClient]: An `AsyncRedis` instance or a `LazyClient` wrapping one.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the connection parameter is of an unsupported type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">conn</span>
        <span class="k">elif</span> <span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RedisAsync</span><span class="p">(</span><span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">RedisAsync</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">conn</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">RedisAsync</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported `conn` </span><span class="si">{</span><span class="n">conn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">conn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RedisAsync</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Asynchronous Redis connection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AsyncRedis: The asynchronous Redis client instance.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">conn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span>
            <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">=</span><span class="n">gather_init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;conn&quot;</span><span class="p">,)),</span>
        <span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;conn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">connection_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">connection_class</span><span class="p">,</span>
            <span class="n">max_connections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">max_connections</span><span class="p">,</span>
            <span class="n">connection_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">connection_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">dill</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_settings</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncRedisBackend</span><span class="p">:</span>
        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RedisAsync</span><span class="p">(</span>
            <span class="n">connection_pool</span><span class="o">=</span><span class="n">AsyncConnectionPool</span><span class="p">(</span>
                <span class="n">connection_class</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">][</span><span class="s2">&quot;connection_class&quot;</span><span class="p">],</span>
                <span class="n">max_connections</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">][</span><span class="s2">&quot;max_connections&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">][</span><span class="s2">&quot;connection_kwargs&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a key exists in the Redis backend asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the key to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: `True` if the key exists, `False` otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a value for a key in the Redis backend asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the key.</span>
<span class="sd">            value (Any): The value to set.</span>
<span class="sd">            nx (bool, optional): If `True`, only set the key if it does not already exist.</span>
<span class="sd">            ttl (Optional[int], optional): Time to live for the key in milliseconds.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If `nx` is `True` and the key already exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
            <span class="n">px</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
            <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span>
            <span class="n">keepttl</span><span class="o">=</span><span class="n">ttl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">nx</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Empty</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Empty</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the value of a key from the Redis backend asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the key.</span>
<span class="sd">            default (Optional[Union[Any, Type[Empty]]], optional): Default value if the key does not exist.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The value of the key.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If the key does not exist and no default is provided.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_engine</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a key from the Redis backend asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the key to delete.</span>
<span class="sd">            missing_ok (bool, optional): If `True`, do not raise an error if the key does not exist.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If the key does not exist and `missing_ok` is `False`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; found&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish a message to a Redis channel asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel (str): The name of the channel.</span>
<span class="sd">            value (Any): The message to publish.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subscribe to a Redis channel and asynchronously yield messages.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel (str): The name of the channel to subscribe to.</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict[str, Any]: A dictionary representing the message data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pubsub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">pubsub</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">listen</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">parse_sub_data</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Asynchronously scan the Redis backend for keys matching a pattern.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern (Optional[str], optional): The pattern to match keys against. Defaults to &#39;*&#39;.</span>

<span class="sd">        Yields:</span>
<span class="sd">            str: The names of matching keys without the namespace prefix.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">or</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_add</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an item to a priority-sorted set asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>
<span class="sd">            unique_id (str): The item&#39;s unique identifier.</span>
<span class="sd">            priority (int | float): The numeric priority score.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">unique_id</span><span class="p">:</span> <span class="n">priority</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Peek the highest-priority item in a sorted set asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            item (str, optional): The ID of the highest-priority item, or None if empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">results</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over all items in a priority-sorted set asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>

<span class="sd">        Yields:</span>
<span class="sd">            item (str): Member of the sorted set, in priority order.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ToDo: switch to this for better async:</span>
        <span class="c1">#   async for item in self.conn.zscan_iter(self.full_name(key)):</span>
        <span class="c1">#       yield item[0]  # item is a (member, score) tuple</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">item</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an item from a priority-sorted set asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>
<span class="sd">            unique_id (str): The ID of the item to remove.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">unique_id</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">conn</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Asynchronous Redis connection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>AsyncRedis</code></td>            <td>
                  <code><span title="redis.asyncio.Redis">Redis</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The asynchronous Redis client instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Delete a key from the Redis backend asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the key to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>missing_ok</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, do not raise an error if the key does not exist.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the key does not exist and <code>missing_ok</code> is <code>False</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a key from the Redis backend asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the key to delete.</span>
<span class="sd">        missing_ok (bool, optional): If `True`, do not raise an error if the key does not exist.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If the key does not exist and `missing_ok` is `False`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Check if a key exists in the Redis backend asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the key to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>True</code> if the key exists, <code>False</code> otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a key exists in the Redis backend asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the key to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: `True` if the key exists, `False` otherwise.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Empty</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Get the value of a key from the Redis backend asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Any">Any</span>, <span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="Empty (alsek.types.Empty)" href="#alsek.types.Empty">Empty</a>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default value if the key does not exist.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Empty (alsek.types.Empty)" href="#alsek.types.Empty">Empty</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value of the key.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the key does not exist and no default is provided.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Empty</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Empty</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the value of a key from the Redis backend asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the key.</span>
<span class="sd">        default (Optional[Union[Any, Type[Empty]]], optional): Default value if the key does not exist.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The value of the key.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If the key does not exist and no default is provided.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_engine</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.priority_add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Add an item to a priority-sorted set asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The item's unique identifier.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>priority</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The numeric priority score.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_add</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an item to a priority-sorted set asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>
<span class="sd">        unique_id (str): The item&#39;s unique identifier.</span>
<span class="sd">        priority (int | float): The numeric priority score.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">unique_id</span><span class="p">:</span> <span class="n">priority</span><span class="p">},</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.priority_get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Peek the highest-priority item in a sorted set asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>item</code></td>            <td>
                  <code>(<span title="str">str</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the highest-priority item, or None if empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Peek the highest-priority item in a sorted set asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        item (str, optional): The ID of the highest-priority item, or None if empty.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">results</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.priority_iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_iter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Iterate over all items in a priority-sorted set asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>item</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Member of the sorted set, in priority order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over all items in a priority-sorted set asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>

<span class="sd">    Yields:</span>
<span class="sd">        item (str): Member of the sorted set, in priority order.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ToDo: switch to this for better async:</span>
    <span class="c1">#   async for item in self.conn.zscan_iter(self.full_name(key)):</span>
    <span class="c1">#       yield item[0]  # item is a (member, score) tuple</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">item</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.priority_remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_remove</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Remove an item from a priority-sorted set asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the item to remove.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">priority_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove an item from a priority-sorted set asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>
<span class="sd">        unique_id (str): The ID of the item to remove.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">unique_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.pub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pub</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Publish a message to a Redis channel asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the channel.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message to publish.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publish a message to a Redis channel asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel (str): The name of the channel.</span>
<span class="sd">        value (Any): The message to publish.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
        <span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Asynchronously scan the Redis backend for keys matching a pattern.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pattern to match keys against. Defaults to '*'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="typing.AsyncIterable">AsyncIterable</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The names of matching keys without the namespace prefix.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Asynchronously scan the Redis backend for keys matching a pattern.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern (Optional[str], optional): The pattern to match keys against. Defaults to &#39;*&#39;.</span>

<span class="sd">    Yields:</span>
<span class="sd">        str: The names of matching keys without the namespace prefix.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">or</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Set a value for a key in the Redis backend asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nx</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, only set the key if it does not already exist.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttl</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time to live for the key in milliseconds.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>nx</code> is <code>True</code> and the key already exists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a value for a key in the Redis backend asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the key.</span>
<span class="sd">        value (Any): The value to set.</span>
<span class="sd">        nx (bool, optional): If `True`, only set the key if it does not already exist.</span>
<span class="sd">        ttl (Optional[int], optional): Time to live for the key in milliseconds.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If `nx` is `True` and the key already exists.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
        <span class="n">px</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
        <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span>
        <span class="n">keepttl</span><span class="o">=</span><span class="n">ttl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">nx</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.asyncio.AsyncRedisBackend.sub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Subscribe to a Redis channel and asynchronously yield messages.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the channel to subscribe to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncIterable">AsyncIterable</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: A dictionary representing the message data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/asyncio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subscribe to a Redis channel and asynchronously yield messages.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel (str): The name of the channel to subscribe to.</span>

<span class="sd">    Yields:</span>
<span class="sd">        dict[str, Any]: A dictionary representing the message data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pubsub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">pubsub</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">listen</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">parse_sub_data</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="alsek.storage.backends.redis.standard" class="doc doc-heading">
            <code>standard</code>


</h6>

    <div class="doc doc-contents ">

        <p>Redis Backend</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h7 id="alsek.storage.backends.redis.standard.RedisBackend" class="doc doc-heading">
            <code>RedisBackend</code>


</h7>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="alsek.storage.backends.abstract.Backend">Backend</span></code></p>


        <p>Redis Backend.</p>
<p>Backend powered by Redis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conn</code>
            </td>
            <td>
                  <code>(<span title="str">str</span>, <span title="redis.Redis">Redis</span>, <a class="autorefs autorefs-internal" title="LazyClient (alsek.storage.backends.lazy.LazyClient)" href="#alsek.storage.backends.lazy.LazyClient">LazyClient</a>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a connection url, <code>Redis()</code> object
or <code>LazyClient</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>namespace</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prefix to use when inserting
names in the backend</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.defaults.DEFAULT_NAMESPACE">DEFAULT_NAMESPACE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>serializer</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Serializer (alsek.storage.serialization.Serializer)" href="#alsek.storage.serialization.Serializer">Serializer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tool for encoding and decoding
values written into the backend.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="JsonSerializer (alsek.storage.serialization.JsonSerializer)" href="#alsek.storage.serialization.JsonSerializer">JsonSerializer</a>()</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>If <code>conn</code> is a <code>Redis()</code> object, <code>decode_responses</code>
  is expected to be set to <code>True</code>.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RedisBackend</span><span class="p">(</span><span class="n">Backend</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redis Backend.</span>

<span class="sd">    Backend powered by Redis.</span>

<span class="sd">    Args:</span>
<span class="sd">        conn (str, Redis, LazyClient, optional): a connection url, ``Redis()`` object</span>
<span class="sd">            or ``LazyClient``.</span>
<span class="sd">        namespace (str): prefix to use when inserting</span>
<span class="sd">            names in the backend</span>
<span class="sd">        serializer (Serializer): tool for encoding and decoding</span>
<span class="sd">            values written into the backend.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * If ``conn`` is a ``Redis()`` object, ``decode_responses``</span>
<span class="sd">          is expected to be set to ``True``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUPPORTS_PUBSUB</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">conn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Redis</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_NAMESPACE</span><span class="p">,</span>
        <span class="n">serializer</span><span class="p">:</span> <span class="n">Serializer</span> <span class="o">=</span> <span class="n">JsonSerializer</span><span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="n">serializer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn_parse</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_conn_parse</span><span class="p">(</span>
        <span class="n">conn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Redis</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Redis</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">conn</span>

        <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Redis</span><span class="p">(</span><span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">Redis</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">conn</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported `conn` </span><span class="si">{</span><span class="n">conn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">conn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Redis</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connection to the backend.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span> <span class="n">LazyClient</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">Redis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">conn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span>
            <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">=</span><span class="n">gather_init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;conn&quot;</span><span class="p">,)),</span>
        <span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;conn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">connection_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">connection_class</span><span class="p">,</span>
            <span class="n">max_connections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">max_connections</span><span class="p">,</span>
            <span class="n">connection_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">connection_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">dill</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_settings</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">RedisBackend</span><span class="p">:</span>
        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span>
            <span class="n">connection_pool</span><span class="o">=</span><span class="n">ConnectionPool</span><span class="p">(</span>
                <span class="n">connection_class</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">][</span><span class="s2">&quot;connection_class&quot;</span><span class="p">],</span>
                <span class="n">max_connections</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">][</span><span class="s2">&quot;max_connections&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;conn&quot;</span><span class="p">][</span><span class="s2">&quot;connection_kwargs&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if ``name`` exists in the Redis backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set ``name`` to ``value`` in the Redis backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>
<span class="sd">            value (Any): value to set for ``name``</span>
<span class="sd">            nx (bool): if ``True`` the item must not exist prior to being set</span>
<span class="sd">            ttl (int, optional): time to live for the entry in milliseconds</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if ``nx`` is ``True`` and ``name`` already exists</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
            <span class="n">px</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
            <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span>
            <span class="n">keepttl</span><span class="o">=</span><span class="n">ttl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">nx</span> <span class="ow">and</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Empty</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ``name`` from the Redis backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>
<span class="sd">            default (Any, Type[Empty], optional): default value for ``name``</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_engine</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a ``name`` from the Redis backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the item</span>
<span class="sd">            missing_ok (bool): if ``True``, do not raise for missing</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if ``missing_ok`` is ``False`` and ``name`` is not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; found&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">priority_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an item to a priority-sorted set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>
<span class="sd">            unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>
<span class="sd">            priority (float): The numeric priority score (decide if lower or higher means higher priority).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">unique_id</span><span class="p">:</span> <span class="n">priority</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">priority_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get (peek) the highest-priority item without removing it.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            item (str, optional): The member with the highest priority, or None if empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">results</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">priority_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over the items in a priority-sorted set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            priority (Iterable[str]): An iterable of members in the sorted set, sorted by priority.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">priority_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an item from a priority-sorted set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the sorted set.</span>
<span class="sd">            unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="n">unique_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">pubsub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">pubsub</span><span class="p">()</span>
        <span class="n">pubsub</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">pubsub</span><span class="o">.</span><span class="n">listen</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">parse_sub_data</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">pubsub</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="n">pubsub</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scan the backend for matching names.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern (str): pattern to match against</span>

<span class="sd">        Returns:</span>
<span class="sd">            names_stream (Iterable[str]): a stream of matching name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">or</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h8 id="alsek.storage.backends.redis.standard.RedisBackend.conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">conn</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h8>


    <div class="doc doc-contents ">

        <p>Connection to the backend.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Delete a <code>name</code> from the Redis backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>missing_ok</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, do not raise for missing</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>missing_ok</code> is <code>False</code> and <code>name</code> is not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a ``name`` from the Redis backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>
<span class="sd">        missing_ok (bool): if ``True``, do not raise for missing</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: if ``missing_ok`` is ``False`` and ``name`` is not found.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Check if <code>name</code> exists in the Redis backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if ``name`` exists in the Redis backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Get <code>name</code> from the Redis backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default</code>
            </td>
            <td>
                  <code>(<span title="typing.Any">Any</span>, <span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="Empty (alsek.types.Empty)" href="#alsek.types.Empty">Empty</a>])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default value for <code>name</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Empty</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get ``name`` from the Redis backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>
<span class="sd">        default (Any, Type[Empty], optional): default value for ``name``</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_engine</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.priority_add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Add an item to a priority-sorted set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The item's (Message's) unique identifier</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>priority</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The numeric priority score (decide if lower or higher means higher priority).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">priority_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an item to a priority-sorted set.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>
<span class="sd">        unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>
<span class="sd">        priority (float): The numeric priority score (decide if lower or higher means higher priority).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">unique_id</span><span class="p">:</span> <span class="n">priority</span><span class="p">},</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.priority_get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Get (peek) the highest-priority item without removing it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>item</code></td>            <td>
                  <code>(<span title="str">str</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The member with the highest priority, or None if empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">priority_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get (peek) the highest-priority item without removing it.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        item (str, optional): The member with the highest priority, or None if empty.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">results</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.priority_iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_iter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Iterate over the items in a priority-sorted set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>priority</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An iterable of members in the sorted set, sorted by priority.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">priority_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over the items in a priority-sorted set.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        priority (Iterable[str]): An iterable of members in the sorted set, sorted by priority.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.priority_remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_remove</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Remove an item from a priority-sorted set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the sorted set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The item's (Message's) unique identifier</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">priority_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove an item from a priority-sorted set.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The name of the sorted set.</span>
<span class="sd">        unique_id (str): The item&#39;s (Message&#39;s) unique identifier</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">unique_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Scan the backend for matching names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pattern to match against</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>names_stream</code></td>            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a stream of matching name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan the backend for matching names.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern (str): pattern to match against</span>

<span class="sd">    Returns:</span>
<span class="sd">        names_stream (Iterable[str]): a stream of matching name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">or</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="alsek.storage.backends.redis.standard.RedisBackend.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h8>


    <div class="doc doc-contents ">

        <p>Set <code>name</code> to <code>value</code> in the Redis backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the item</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value to set for <code>name</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nx</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> the item must not exist prior to being set</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ttl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to live for the entry in milliseconds</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>nx</code> is <code>True</code> and <code>name</code> already exists</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/backends/redis/standard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set ``name`` to ``value`` in the Redis backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name of the item</span>
<span class="sd">        value (Any): value to set for ``name``</span>
<span class="sd">        nx (bool): if ``True`` the item must not exist prior to being set</span>
<span class="sd">        ttl (int, optional): time to live for the entry in milliseconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: if ``nx`` is ``True`` and ``name`` already exists</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
        <span class="n">px</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
        <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span>
        <span class="n">keepttl</span><span class="o">=</span><span class="n">ttl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">nx</span> <span class="ow">and</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.storage.result" class="doc doc-heading">
            <code>result</code>


</h4>

    <div class="doc doc-contents ">

        <p>Result Storage</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.storage.result.ResultStore" class="doc doc-heading">
            <code>ResultStore</code>


</h5>


    <div class="doc doc-contents ">


        <p>Alsek Result Store.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
                  <code><span title="alsek.storage.backends.abstract.Backend">Backend</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backend for data storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>In order for a result to be stored, it must be
  serializable by the <code>serializer</code> used by <code>backend</code>.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>alsek/storage/result.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResultStore</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alsek Result Store.</span>

<span class="sd">    Args:</span>
<span class="sd">        backend (Backend): backend for data storage</span>

<span class="sd">    Warning:</span>
<span class="sd">        * In order for a result to be stored, it must be</span>
<span class="sd">          serializable by the ``serializer`` used by ``backend``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ResultStore</span><span class="p">:</span>
        <span class="n">backend_data</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">])</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">from_settings</span><span class="p">(</span><span class="n">backend_data</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_stable_prefix</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a prefix that does not change based on</span>
<span class="sd">        whether the message has a progenitor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;results:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">message</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name for ``message`` in the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>

<span class="sd">        Returns:</span>
<span class="sd">            name (str): message-specific name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Message does not have a uuid&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;results:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="si">}</span><span class="s2">:descendants:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;results:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_all_storage_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">descendants</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">descendant_uuids</span><span class="p">:</span>
                <span class="n">descendant_names</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span>
                        <span class="n">Message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">progenitor_uuid</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">descendant_uuids</span>
                <span class="p">]</span>
                <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">descendant_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stable_prefix</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">),</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_uuid</span><span class="p">(</span><span class="n">storage_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">storage_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether data for ``message`` exists in the store.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message</span>
<span class="sd">            descendants (bool): if ``True``, this method will return ``True``</span>
<span class="sd">                iff all of the descendants of ``message`` also exist.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_storage_names</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store a ``result`` for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message.</span>
<span class="sd">            result (Any): the result to persist</span>
<span class="sd">            nx (bool): if ``True`` the item must not exist prior to being set</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">utcnow_timestamp_ms</span><span class="p">()},</span>
            <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">result_ttl</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">with_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">bundle_data</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_metadata</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_uuid</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="n">results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">bundle_data</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">],</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span> <span class="k">if</span> <span class="n">with_metadata</span> <span class="k">else</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">keep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the result for ``message``.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message.</span>
<span class="sd">            timeout (int): amount of time (in milliseconds) to wait</span>
<span class="sd">                for the result to become available</span>
<span class="sd">            keep (bool): whether to keep the result after fetching it.</span>
<span class="sd">                Defaults to ``False`` to conserve storage space.</span>
<span class="sd">            with_metadata (bool): if ``True`` return results of the form</span>
<span class="sd">                ``{&quot;result&quot;: &lt;result&gt;, &quot;uuid&quot;: str, &quot;timestamp&quot;: int}``, where</span>
<span class="sd">                &quot;result&quot; is the result persisted to the backend, &quot;uuid&quot; if the uuid</span>
<span class="sd">                 of the message associated with the result and &quot;timestamp&quot; is the</span>
<span class="sd">                time at which the result was written to the backend.</span>
<span class="sd">            descendants (bool): if ``True`` also fetch results for descendants.</span>

<span class="sd">        Returns:</span>
<span class="sd">            result (Any, list[Any]): the stored result. If ``descendants``</span>
<span class="sd">                is ``True`` a list of results will be returned.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if results are not available for ``message``</span>
<span class="sd">            TimeoutError: if results are not available for ``message``</span>
<span class="sd">                following ``timeout``.</span>

<span class="sd">        Notes:</span>
<span class="sd">            * The order of results when ``descendants=True`` is determined</span>
<span class="sd">              by the time at which the data was written to the backend.</span>

<span class="sd">        Warning:</span>
<span class="sd">            * If a message has a projenitor, the ``projenitor_uuid`` field in the</span>
<span class="sd">              ``message`` must be set.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from alsek import Message</span>
<span class="sd">            &gt;&gt;&gt; from alsek.storage.backends.redis.standard import RedisBackend</span>
<span class="sd">            &gt;&gt;&gt; from alsek.storage.result import ResultStore</span>

<span class="sd">            &gt;&gt;&gt; backend = RedisBackend()</span>
<span class="sd">            &gt;&gt;&gt; result_store = ResultStore(backend)</span>

<span class="sd">            &gt;&gt;&gt; result_store.get(Message(uuid=&quot;...&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">waiter</span><span class="p">(</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">),</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="n">timeout_msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Timeout waiting on result for </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">sleep_interval</span><span class="o">=</span><span class="n">_GET_RESULT_WAIT_SLEEP_INTERVAL</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No results for </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_storage_names</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_engine</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">with_metadata</span><span class="o">=</span><span class="n">with_metadata</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span> <span class="k">if</span> <span class="n">descendants</span> <span class="k">else</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete any data for ``message`` from the backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Message): an Alsek message.</span>
<span class="sd">            descendants (bool): if ``True`` also delete results for descendants.</span>
<span class="sd">            missing_ok (bool): if ``True``, do not raise for missing</span>

<span class="sd">        Returns:</span>
<span class="sd">            count (int): number of results deleted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_storage_names</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">missing_ok</span><span class="o">=</span><span class="n">missing_ok</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.storage.result.ResultStore.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">missing_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Delete any data for <code>message</code> from the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descendants</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> also delete results for descendants.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>missing_ok</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, do not raise for missing</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>count</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of results deleted</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">missing_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete any data for ``message`` from the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message.</span>
<span class="sd">        descendants (bool): if ``True`` also delete results for descendants.</span>
<span class="sd">        missing_ok (bool): if ``True``, do not raise for missing</span>

<span class="sd">    Returns:</span>
<span class="sd">        count (int): number of results deleted</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_storage_names</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">missing_ok</span><span class="o">=</span><span class="n">missing_ok</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.result.ResultStore.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Whether data for <code>message</code> exists in the store.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descendants</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, this method will return <code>True</code>
iff all of the descendants of <code>message</code> also exist.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether data for ``message`` exists in the store.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>
<span class="sd">        descendants (bool): if ``True``, this method will return ``True``</span>
<span class="sd">            iff all of the descendants of ``message`` also exist.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_storage_names</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.result.ResultStore.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the result for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>amount of time (in milliseconds) to wait
for the result to become available</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to keep the result after fetching it.
Defaults to <code>False</code> to conserve storage space.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> return results of the form
<code>{"result": &lt;result&gt;, "uuid": str, "timestamp": int}</code>, where
"result" is the result persisted to the backend, "uuid" if the uuid
 of the message associated with the result and "timestamp" is the
time at which the result was written to the backend.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descendants</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> also fetch results for descendants.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
                  <code>(<span title="typing.Any">Any</span>, <span title="list">list</span>[<span title="typing.Any">Any</span>])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the stored result. If <code>descendants</code>
is <code>True</code> a list of results will be returned.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if results are not available for <code>message</code></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TimeoutError">TimeoutError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if results are not available for <code>message</code>
following <code>timeout</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The order of results when <code>descendants=True</code> is determined
  by the time at which the data was written to the backend.</li>
</ul>
</details>

<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>If a message has a projenitor, the <code>projenitor_uuid</code> field in the
  <code>message</code> must be set.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.storage.backends.redis.standard</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisBackend</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.storage.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResultStore</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">backend</span> <span class="o">=</span> <span class="n">RedisBackend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result_store</span> <span class="o">=</span> <span class="n">ResultStore</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">result_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Message</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">))</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">keep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the result for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message.</span>
<span class="sd">        timeout (int): amount of time (in milliseconds) to wait</span>
<span class="sd">            for the result to become available</span>
<span class="sd">        keep (bool): whether to keep the result after fetching it.</span>
<span class="sd">            Defaults to ``False`` to conserve storage space.</span>
<span class="sd">        with_metadata (bool): if ``True`` return results of the form</span>
<span class="sd">            ``{&quot;result&quot;: &lt;result&gt;, &quot;uuid&quot;: str, &quot;timestamp&quot;: int}``, where</span>
<span class="sd">            &quot;result&quot; is the result persisted to the backend, &quot;uuid&quot; if the uuid</span>
<span class="sd">             of the message associated with the result and &quot;timestamp&quot; is the</span>
<span class="sd">            time at which the result was written to the backend.</span>
<span class="sd">        descendants (bool): if ``True`` also fetch results for descendants.</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (Any, list[Any]): the stored result. If ``descendants``</span>
<span class="sd">            is ``True`` a list of results will be returned.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: if results are not available for ``message``</span>
<span class="sd">        TimeoutError: if results are not available for ``message``</span>
<span class="sd">            following ``timeout``.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * The order of results when ``descendants=True`` is determined</span>
<span class="sd">          by the time at which the data was written to the backend.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * If a message has a projenitor, the ``projenitor_uuid`` field in the</span>
<span class="sd">          ``message`` must be set.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from alsek import Message</span>
<span class="sd">        &gt;&gt;&gt; from alsek.storage.backends.redis.standard import RedisBackend</span>
<span class="sd">        &gt;&gt;&gt; from alsek.storage.result import ResultStore</span>

<span class="sd">        &gt;&gt;&gt; backend = RedisBackend()</span>
<span class="sd">        &gt;&gt;&gt; result_store = ResultStore(backend)</span>

<span class="sd">        &gt;&gt;&gt; result_store.get(Message(uuid=&quot;...&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="n">waiter</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">timeout_msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Timeout waiting on result for </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">sleep_interval</span><span class="o">=</span><span class="n">_GET_RESULT_WAIT_SLEEP_INTERVAL</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No results for </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_storage_names</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_engine</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">with_metadata</span><span class="o">=</span><span class="n">with_metadata</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span> <span class="k">if</span> <span class="n">descendants</span> <span class="k">else</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.result.ResultStore.get_storage_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Get the name for <code>message</code> in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>name</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message-specific name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the name for ``message`` in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        name (str): message-specific name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">uuid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Message does not have a uuid&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;results:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">progenitor_uuid</span><span class="si">}</span><span class="s2">:descendants:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;results:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.result.ResultStore.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Store a <code>result</code> for <code>message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the result to persist</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nx</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> the item must not exist prior to being set</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">nx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store a ``result`` for ``message``.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message.</span>
<span class="sd">        result (Any): the result to persist</span>
<span class="sd">        nx (bool): if ``True`` the item must not exist prior to being set</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_name</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">utcnow_timestamp_ms</span><span class="p">()},</span>
        <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span>
        <span class="n">ttl</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">result_ttl</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.storage.serialization" class="doc doc-heading">
            <code>serialization</code>


</h4>

    <div class="doc doc-contents ">

        <p>Serialization</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.storage.serialization.BinarySerializer" class="doc doc-heading">
            <code>BinarySerializer</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Serializer (alsek.storage.serialization.Serializer)" href="#alsek.storage.serialization.Serializer">Serializer</a></code></p>


        <p>Binary serialization.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BinarySerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binary serialization.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode an object.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Any): an object to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">            encoded (Any): base64 encoded ``dill``-serialized object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dill_bytes</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">dill_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode an object.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Any): an object to decode</span>

<span class="sd">        Returns:</span>
<span class="sd">            decoded (Any): ``dill``-deserialized object from base64 encoded string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">base64_bytes</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="n">base64_bytes</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.storage.serialization.BinarySerializer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Encode an object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to encode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>encoded</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>base64 encoded <code>dill</code>-serialized object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode an object.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): an object to encode</span>

<span class="sd">    Returns:</span>
<span class="sd">        encoded (Any): base64 encoded ``dill``-serialized object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dill_bytes</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">dill_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.serialization.BinarySerializer.reverse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Decode an object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to decode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>decoded</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>dill</code>-deserialized object from base64 encoded string</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode an object.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): an object to decode</span>

<span class="sd">    Returns:</span>
<span class="sd">        decoded (Any): ``dill``-deserialized object from base64 encoded string</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">base64_bytes</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dill</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="n">base64_bytes</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.storage.serialization.JsonSerializer" class="doc doc-heading">
            <code>JsonSerializer</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Serializer (alsek.storage.serialization.Serializer)" href="#alsek.storage.serialization.Serializer">Serializer</a></code></p>


        <p>JSON serialization.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">JsonSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;JSON serialization.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode an object.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Any): an object to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">            encoded (Any): JSON encoded object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode an object.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Any): an object to decode</span>

<span class="sd">        Returns:</span>
<span class="sd">            decoded (Any): JSON decoded object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.storage.serialization.JsonSerializer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Encode an object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to encode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>encoded</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JSON encoded object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode an object.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): an object to encode</span>

<span class="sd">    Returns:</span>
<span class="sd">        encoded (Any): JSON encoded object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.serialization.JsonSerializer.reverse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Decode an object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to decode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>decoded</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JSON decoded object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode an object.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): an object to decode</span>

<span class="sd">    Returns:</span>
<span class="sd">        decoded (Any): JSON decoded object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="alsek.storage.serialization.Serializer" class="doc doc-heading">
            <code>Serializer</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base Serializer Class.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Serializer</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base Serializer Class.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auto_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode an object for backend serialization.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Any): an object to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">            encoded (Any): encoded object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode an object.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Any): an object to decode</span>

<span class="sd">        Returns:</span>
<span class="sd">            decoded (Any): decoded object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.storage.serialization.Serializer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Encode an object for backend serialization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to encode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>encoded</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>encoded object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode an object for backend serialization.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): an object to encode</span>

<span class="sd">    Returns:</span>
<span class="sd">        encoded (Any): encoded object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.storage.serialization.Serializer.reverse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Decode an object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to decode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>decoded</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>decoded object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/storage/serialization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode an object.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): an object to decode</span>

<span class="sd">    Returns:</span>
<span class="sd">        decoded (Any): decoded object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.tools" class="doc doc-heading">
            <code>tools</code>


</h3>

    <div class="doc doc-contents ">

        <p>Tools</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="alsek.tools.iteration" class="doc doc-heading">
            <code>iteration</code>


</h4>

    <div class="doc doc-contents ">

        <p>Result Iteration</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.tools.iteration.ResultPool" class="doc doc-heading">
            <code>ResultPool</code>


</h5>


    <div class="doc doc-contents ">


        <p>Tooling for iterating over task results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>result_store</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ResultStore (alsek.storage.result.ResultStore)" href="#alsek.storage.result.ResultStore">ResultStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>store where task results are persisted</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.storage.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResultStore</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.tools.iteration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResultPool</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result_store</span> <span class="o">=</span> <span class="n">ResultStore</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">ResultPool</span><span class="p">(</span><span class="n">result_store</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">istream</span><span class="p">(</span><span class="o">*</span><span class="n">messages</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>alsek/tools/iteration.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResultPool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tooling for iterating over task results.</span>

<span class="sd">    Args:</span>
<span class="sd">        result_store (ResultStore): store where task results are persisted</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from alsek.storage.result import ResultStore</span>
<span class="sd">        &gt;&gt;&gt; from alsek.tools.iteration import ResultPool</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; result_store = ResultStore(...)</span>
<span class="sd">        &gt;&gt;&gt; pool = ResultPool(result_store)</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; messages = [...]</span>
<span class="sd">        &gt;&gt;&gt; for uuid, result in pool.istream(*messages):</span>
<span class="sd">        ...     pass</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_store</span><span class="p">:</span> <span class="n">ResultStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span> <span class="o">=</span> <span class="n">result_store</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span> <span class="o">=</span> <span class="n">StopSignalListener</span><span class="p">(</span><span class="n">exit_override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_duplicates</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">uuid</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Duplicate messages detected&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_engine</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">messages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">wait</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">break_on_error</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

        <span class="n">outstanding</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)))</span>
        <span class="k">while</span> <span class="n">outstanding</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
            <span class="n">to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outstanding</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">messages</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">to_drop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">break_on_error</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="n">outstanding</span> <span class="o">=</span> <span class="n">_idx_drop</span><span class="p">(</span><span class="n">outstanding</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="n">to_drop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">wait</span> <span class="k">if</span> <span class="n">outstanding</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">istream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">messages</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">wait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream the results of one or more messages. Results are yielded</span>
<span class="sd">        in the order in which they become available. (This may differ from</span>
<span class="sd">        the order in which messages are provided.)</span>

<span class="sd">        Args:</span>
<span class="sd">            *messages (Message): one or more messages to iterate over</span>
<span class="sd">            wait (int): time to wait (in milliseconds) between checks for</span>
<span class="sd">                available results</span>
<span class="sd">            descendants (bool): if ``True``, wait for and return</span>
<span class="sd">                the results of all descendant (callback) messages.</span>
<span class="sd">            **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">                ``result_store.get()``.</span>

<span class="sd">        results (iterable): an iterable of results of the form</span>
<span class="sd">            ``(Message, result)``.</span>

<span class="sd">        Warning:</span>
<span class="sd">            * By default, ``result_store`` does not keep messages once</span>
<span class="sd">              they have been collected. As a result, providing messages</span>
<span class="sd">              for which the corresponding results have already been collected</span>
<span class="sd">              (and deleted) will cause this method to loop indefinitely.</span>
<span class="sd">              In order to loop over messages multiple times set ``keep=True``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="p">(</span>
            <span class="n">messages</span><span class="p">,</span>
            <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span>
            <span class="n">break_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">messages</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">wait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream the results of one or more messages. The order of the</span>
<span class="sd">        results are guaranteed to match the order of ``messages``.</span>

<span class="sd">        Args:</span>
<span class="sd">            *messages (Message): one or more messages to iterate over</span>
<span class="sd">            wait (int): time to wait (in milliseconds) between checks for</span>
<span class="sd">                available results</span>
<span class="sd">            descendants (bool): if ``True``, wait for and return</span>
<span class="sd">                the results of all descendant (callback) messages.</span>
<span class="sd">            **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">                ``result_store.get()``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            results (iterable): an iterable of results of the form</span>
<span class="sd">                ``(Message, result)``.</span>

<span class="sd">        Warning:</span>
<span class="sd">            * By default, ``result_store`` does not keep messages once</span>
<span class="sd">              they have been collected. As a result, providing messages</span>
<span class="sd">              for which the corresponding results have already been collected</span>
<span class="sd">              (and deleted) will cause this method to loop indefinitely.</span>
<span class="sd">              In order to loop over messages multiple times set ``keep=True``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="p">(</span>
            <span class="n">messages</span><span class="p">,</span>
            <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span>
            <span class="n">break_on_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.tools.iteration.ResultPool.istream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">istream</span><span class="p">(</span><span class="o">*</span><span class="n">messages</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Stream the results of one or more messages. Results are yielded
in the order in which they become available. (This may differ from
the order in which messages are provided.)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*messages</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one or more messages to iterate over</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to wait (in milliseconds) between checks for
available results</p>
              </div>
            </td>
            <td>
                  <code>5 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descendants</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, wait for and return
the results of all descendant (callback) messages.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to
<code>result_store.get()</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>results (iterable): an iterable of results of the form
    <code>(Message, result)</code>.</p>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>By default, <code>result_store</code> does not keep messages once
  they have been collected. As a result, providing messages
  for which the corresponding results have already been collected
  (and deleted) will cause this method to loop indefinitely.
  In order to loop over messages multiple times set <code>keep=True</code>.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/tools/iteration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">istream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">messages</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stream the results of one or more messages. Results are yielded</span>
<span class="sd">    in the order in which they become available. (This may differ from</span>
<span class="sd">    the order in which messages are provided.)</span>

<span class="sd">    Args:</span>
<span class="sd">        *messages (Message): one or more messages to iterate over</span>
<span class="sd">        wait (int): time to wait (in milliseconds) between checks for</span>
<span class="sd">            available results</span>
<span class="sd">        descendants (bool): if ``True``, wait for and return</span>
<span class="sd">            the results of all descendant (callback) messages.</span>
<span class="sd">        **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">            ``result_store.get()``.</span>

<span class="sd">    results (iterable): an iterable of results of the form</span>
<span class="sd">        ``(Message, result)``.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * By default, ``result_store`` does not keep messages once</span>
<span class="sd">          they have been collected. As a result, providing messages</span>
<span class="sd">          for which the corresponding results have already been collected</span>
<span class="sd">          (and deleted) will cause this method to loop indefinitely.</span>
<span class="sd">          In order to loop over messages multiple times set ``keep=True``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="p">(</span>
        <span class="n">messages</span><span class="p">,</span>
        <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span>
        <span class="n">break_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.tools.iteration.ResultPool.stream" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stream</span><span class="p">(</span><span class="o">*</span><span class="n">messages</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">descendants</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Stream the results of one or more messages. The order of the
results are guaranteed to match the order of <code>messages</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*messages</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one or more messages to iterate over</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time to wait (in milliseconds) between checks for
available results</p>
              </div>
            </td>
            <td>
                  <code>5 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descendants</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code>, wait for and return
the results of all descendant (callback) messages.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to
<code>result_store.get()</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>results</code></td>            <td>
                  <code><span title="iterable">iterable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an iterable of results of the form
<code>(Message, result)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>By default, <code>result_store</code> does not keep messages once
  they have been collected. As a result, providing messages
  for which the corresponding results have already been collected
  (and deleted) will cause this method to loop indefinitely.
  In order to loop over messages multiple times set <code>keep=True</code>.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/tools/iteration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">messages</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">descendants</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stream the results of one or more messages. The order of the</span>
<span class="sd">    results are guaranteed to match the order of ``messages``.</span>

<span class="sd">    Args:</span>
<span class="sd">        *messages (Message): one or more messages to iterate over</span>
<span class="sd">        wait (int): time to wait (in milliseconds) between checks for</span>
<span class="sd">            available results</span>
<span class="sd">        descendants (bool): if ``True``, wait for and return</span>
<span class="sd">            the results of all descendant (callback) messages.</span>
<span class="sd">        **kwargs (Keyword Args): keyword arguments to pass to</span>
<span class="sd">            ``result_store.get()``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        results (iterable): an iterable of results of the form</span>
<span class="sd">            ``(Message, result)``.</span>

<span class="sd">    Warning:</span>
<span class="sd">        * By default, ``result_store`` does not keep messages once</span>
<span class="sd">          they have been collected. As a result, providing messages</span>
<span class="sd">          for which the corresponding results have already been collected</span>
<span class="sd">          (and deleted) will cause this method to loop indefinitely.</span>
<span class="sd">          In order to loop over messages multiple times set ``keep=True``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="p">(</span>
        <span class="n">messages</span><span class="p">,</span>
        <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span>
        <span class="n">break_on_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">descendants</span><span class="o">=</span><span class="n">descendants</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.types" class="doc doc-heading">
            <code>types</code>


</h3>

    <div class="doc doc-contents ">

        <p>Types</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="alsek.types.Empty" class="doc doc-heading">
            <code>Empty</code>


</h4>


    <div class="doc doc-contents ">


        <p>Empty sentinel.</p>







              <details class="quote">
                <summary>Source code in <code>alsek/types.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Empty</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Empty sentinel.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="alsek.utils" class="doc doc-heading">
            <code>utils</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="alsek.utils.aggregation" class="doc doc-heading">
            <code>aggregation</code>


</h4>

    <div class="doc doc-contents ">

        <p>Aggregation Utils</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.aggregation.gather_init_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gather_init_params</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extract the parameters passed to an object's <code>__init__()</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameters in <code>__init__()</code> to ignore</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameters from <code>__init__()</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/aggregation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gather_init_params</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">ignore</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the parameters passed to an object&#39;s ``__init__()``.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (object):</span>
<span class="sd">        ignore (tuple, optional): parameters in ``__init__()`` to ignore</span>

<span class="sd">    Returns:</span>
<span class="sd">        params (dict): parameters from ``__init__()``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ignore</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.checks" class="doc doc-heading">
            <code>checks</code>


</h4>

    <div class="doc doc-contents ">

        <p>Check Utils</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.checks.has_duplicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_duplicates</span><span class="p">(</span><span class="n">itera</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Determine if <code>itera</code> contains duplicates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>itera</code>
            </td>
            <td>
                  <code><span title="typing.Collection">Collection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a sized iterable</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/checks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">has_duplicates</span><span class="p">(</span><span class="n">itera</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if ``itera`` contains duplicates.</span>

<span class="sd">    Args:</span>
<span class="sd">        itera (Collection): a sized iterable</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itera</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.decorators" class="doc doc-heading">
            <code>decorators</code>


</h4>

    <div class="doc doc-contents ">

        <p>Decorators</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.environment" class="doc doc-heading">
            <code>environment</code>


</h4>

    <div class="doc doc-contents ">

        <p>Environment</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.helpers" class="doc doc-heading">
            <code>helpers</code>


</h4>

    <div class="doc doc-contents ">

        <p>Helpers</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.logging" class="doc doc-heading">
            <code>logging</code>


</h4>

    <div class="doc doc-contents ">

        <p>Logging</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.logging.get_logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_logger</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the Alsek logger.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>logger</code></td>            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alsek logger</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_logger</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the Alsek logger.</span>

<span class="sd">    Returns:</span>
<span class="sd">        logger (logging.Logger): Alsek logger</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;alsek&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.logging.magic_logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">magic_logger</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Logging decorator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>before</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function to log a message before function
execution. This callable will be passed only those parameters
    which it shares with the deocrated function.</p>
              </div>
            </td>
            <td>
                  <code>lambda: None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>after</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function to log a message after function
execution. This callable will be passed:
    * <code>input_</code>: a dictionary where the key is a parameter accepted
      by the wrapped function and the value is the value passed. If not
      present in the signature of <code>after</code> this data will not be provided.
    * <code>output</code>: the output of the function. If not present in the signature
      of <code>after</code> this data will not be provided.</p>
              </div>
            </td>
            <td>
                  <code>lambda: None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>wrapper</code></td>            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wrapped <code>function</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">alsek.utils.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">magic_logger</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nd">@magic_logger</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">input_</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">add99</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">99</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">after</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logging decorator.</span>

<span class="sd">    Args:</span>
<span class="sd">        before (callable): function to log a message before function</span>
<span class="sd">            execution. This callable will be passed only those parameters</span>
<span class="sd">                which it shares with the deocrated function.</span>
<span class="sd">        after (callable): function to log a message after function</span>
<span class="sd">            execution. This callable will be passed:</span>
<span class="sd">                * ``input_``: a dictionary where the key is a parameter accepted</span>
<span class="sd">                  by the wrapped function and the value is the value passed. If not</span>
<span class="sd">                  present in the signature of ``after`` this data will not be provided.</span>
<span class="sd">                * ``output``: the output of the function. If not present in the signature</span>
<span class="sd">                  of ``after`` this data will not be provided.</span>

<span class="sd">    Returns:</span>
<span class="sd">        wrapper (callable): wrapped ``function``</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import logging</span>
<span class="sd">        &gt;&gt;&gt; from alsek.utils.logging import magic_logger</span>

<span class="sd">        &gt;&gt;&gt; log = logging.getLogger(__name__)</span>

<span class="sd">        &gt;&gt;&gt; @magic_logger(</span>
<span class="sd">        &gt;&gt;&gt;    before=lambda a: log.debug(a),</span>
<span class="sd">        &gt;&gt;&gt;    after=lambda input_, output: log.info(output)</span>
<span class="sd">        &gt;&gt;&gt; )</span>
<span class="sd">        &gt;&gt;&gt; def add99(a: int) -&gt; int:</span>
<span class="sd">        &gt;&gt;&gt;    return a + 99</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="n">function_raw</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">function_raw</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args_raw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_raw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
            <span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_magic_parser</span><span class="p">(</span>
                <span class="n">function_raw</span><span class="p">,</span>
                <span class="n">args_raw</span><span class="o">=</span><span class="n">args_raw</span><span class="p">,</span>
                <span class="n">kwargs_raw</span><span class="o">=</span><span class="n">kwargs_raw</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">full_kwargs</span> <span class="o">=</span> <span class="n">_merge_args_kwargs</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">_run_func</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="o">**</span><span class="n">full_kwargs</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">_run_func</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="n">input_</span><span class="o">=</span><span class="n">full_kwargs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span>

        <span class="k">return</span> <span class="n">inner</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.logging.setup_logging" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_logging</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Setup Alsek-style logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>level</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup Alsek-style logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): logging level to use</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">LOGGING_FORMAT</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="n">LOGGING_DATEFMT</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">handler</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># &lt;-- super important!</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.namespacing" class="doc doc-heading">
            <code>namespacing</code>


</h4>

    <div class="doc doc-contents ">

        <p>Namespacing</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_dlq_message_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the name for <code>message</code> in the backend's dead letter queue (DLQ).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dlq_name</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message-specific name in the DLQ</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dlq_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the name for ``message`` in the backend&#39;s dead letter queue (DLQ).</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        dlq_name (str): message-specific name in the DLQ</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DLQ_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_message_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the name for <code>message</code> in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>name</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message-specific name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the name for ``message`` in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        name (str): message-specific name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subnamespace</span> <span class="o">=</span> <span class="n">get_messages_namespace</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subnamespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_message_signature" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_message_signature</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the signature for <code>message</code> in the backend.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>signature</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message-specific signature.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_message_signature</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the signature for ``message`` in the backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        signature (str): message-specific signature.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_message_name</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2">:retry:</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">retries</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_messages_namespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_messages_namespace</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the namespace for a message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>namespace</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the namespace for the message</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_messages_namespace</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the namespace for a message.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        namespace (str): the namespace for the message</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subnamespace</span> <span class="o">=</span> <span class="n">get_subnamespace</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subnamespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">MESSAGES_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_priority_namespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_priority_namespace</span><span class="p">(</span><span class="n">subnamespace</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the namespace for a message's priority information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>subnamespace</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the namespace for the message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>priority_namespace</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the namespace for priority information</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_priority_namespace</span><span class="p">(</span><span class="n">subnamespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the namespace for a message&#39;s priority information.</span>

<span class="sd">    Args:</span>
<span class="sd">        subnamespace (str): the namespace for the message</span>

<span class="sd">    Returns:</span>
<span class="sd">        priority_namespace (str): the namespace for priority information</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PRIORITY_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">subnamespace</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_priority_namespace_from_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_priority_namespace_from_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the namespace for message's priority information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Message (alsek.core.message.Message)" href="#alsek.core.message.Message">Message</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an Alsek message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>namespace</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the fully-qualified priority queue name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_priority_namespace_from_message</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the namespace for message&#39;s priority information.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (Message): an Alsek message</span>

<span class="sd">    Returns:</span>
<span class="sd">        namespace (str): the fully-qualified priority queue name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subnamespace</span> <span class="o">=</span> <span class="n">get_subnamespace</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">task_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_priority_namespace</span><span class="p">(</span><span class="n">subnamespace</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.namespacing.get_subnamespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subnamespace</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">task_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the subnamespace for a given <code>queue</code>
and (optionally) <code>task_name</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>queue</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the queue</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>task_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the task</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>subnamespace</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>queue-specific namespace</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>task_name</code> is provided and <code>queue</code> is not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/namespacing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subnamespace</span><span class="p">(</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnamespace for a given ``queue``</span>
<span class="sd">    and (optionally) ``task_name``.</span>

<span class="sd">    Args:</span>
<span class="sd">        queue (str, optional): the name of the queue</span>
<span class="sd">        task_name (str): name of the task</span>

<span class="sd">    Returns:</span>
<span class="sd">        subnamespace (str): queue-specific namespace</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if ``task_name`` is provided and ``queue`` is not.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">queue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">task_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`queue` must be provided if `task_name` is not None&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">queue</span> <span class="ow">and</span> <span class="n">task_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">QUEUES_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">queue</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">TASK_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">queue</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">QUEUES_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">queue</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">QUEUES_NAMESPACE_KEY</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.parsing" class="doc doc-heading">
            <code>parsing</code>


</h4>

    <div class="doc doc-contents ">

        <p>Parsing</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.utils.parsing.ExceptionDetails" class="doc doc-heading">
            <code>ExceptionDetails</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>








              <details class="quote">
                <summary>Source code in <code>alsek/utils/parsing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExceptionDetails</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the NamedTuple to a dictionary</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="ne">BaseException</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return parsed exception information as a Python exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            strict (bool): if ``True`` do not coerce failures to</span>
<span class="sd">                import the correct error</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseException</span>

<span class="sd">        Warnings:</span>
<span class="sd">            This will not include the original traceback.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exc</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">_get_exception_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">exc</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exc</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">exc</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="alsek.utils.parsing.ExceptionDetails.as_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">as_dict</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Convert the NamedTuple to a dictionary</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/parsing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the NamedTuple to a dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="alsek.utils.parsing.ExceptionDetails.as_exception" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">as_exception</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Return parsed exception information as a Python exception.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>strict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if <code>True</code> do not coerce failures to
import the correct error</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>BaseException</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/parsing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">as_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="ne">BaseException</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return parsed exception information as a Python exception.</span>

<span class="sd">    Args:</span>
<span class="sd">        strict (bool): if ``True`` do not coerce failures to</span>
<span class="sd">            import the correct error</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseException</span>

<span class="sd">    Warnings:</span>
<span class="sd">        This will not include the original traceback.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">exc</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">_get_exception_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">exc</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exc</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">exc</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="alsek.utils.parsing.get_exception_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_exception_name</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the name of an exception as a string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code>(<span title="BaseException">BaseException</span>, <span title="typing.Type">Type</span>[<span title="BaseException">BaseException</span>])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception class</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>name</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the exception name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/parsing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_exception_name</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the name of an exception as a string.</span>

<span class="sd">    Args:</span>
<span class="sd">        exception (BaseException, Type[BaseException]): Exception class</span>

<span class="sd">    Returns:</span>
<span class="sd">        name (str): the exception name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exception_type</span> <span class="o">=</span> <span class="n">exception</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
    <span class="n">module</span><span class="p">,</span> <span class="n">qualname</span> <span class="o">=</span> <span class="n">exception_type</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="n">exception_type</span><span class="o">.</span><span class="vm">__qualname__</span>
    <span class="k">return</span> <span class="n">qualname</span> <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s2">&quot;builtins&quot;</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">qualname</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.parsing.parse_exception" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts the exception type, exception message, and exception
traceback from an error.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception to extract details from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>details</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="ExceptionDetails (alsek.utils.parsing.ExceptionDetails)" href="#alsek.utils.parsing.ExceptionDetails">ExceptionDetails</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A named tuple containing the exception information</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/parsing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_exception</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExceptionDetails</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the exception type, exception message, and exception</span>
<span class="sd">    traceback from an error.</span>

<span class="sd">    Args:</span>
<span class="sd">        error (BaseException): The exception to extract details from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        details (ExceptionDetails): A named tuple containing the exception information</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ExceptionDetails</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">get_exception_name</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
        <span class="n">traceback</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
                <span class="n">value</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                <span class="n">tb</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.printing" class="doc doc-heading">
            <code>printing</code>


</h4>

    <div class="doc doc-contents ">

        <p>Printing Utils</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.printing.auto_repr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">auto_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">new_line_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Autogenerate a class repr string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object to generate a repr for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_line_threshold</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of <code>params</code>
required to split the parameters over multiple lines.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**params</code>
            </td>
            <td>
                  <code>Keyword Args</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameters to include in the
repr string</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>repr</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>repr string</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/printing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">auto_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">new_line_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Autogenerate a class repr string.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (object): an object to generate a repr for</span>
<span class="sd">        new_line_threshold (int, optional): number of ``params``</span>
<span class="sd">            required to split the parameters over multiple lines.</span>
<span class="sd">        **params (Keyword Args): parameters to include in the</span>
<span class="sd">            repr string</span>

<span class="sd">    Returns:</span>
<span class="sd">        repr (str): repr string</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">class_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="n">new_line_threshold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">new_line_threshold</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">join_on</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">join_on</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="p">,</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">start</span><span class="si">}{</span><span class="n">_format_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">join_on</span><span class="o">=</span><span class="n">join_on</span><span class="p">)</span><span class="si">}{</span><span class="n">end</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.scanning" class="doc doc-heading">
            <code>scanning</code>


</h4>

    <div class="doc doc-contents ">

        <p>Helpers</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.scanning.collect_tasks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_tasks</span><span class="p">(</span><span class="n">module</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Recursively collect all tasks in <code>name</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>module</code>
            </td>
            <td>
                  <code>(<span title="str">str</span>, <span title="types.ModuleType">ModuleType</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of a module</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>module</code></td>            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="Task (alsek.core.task.Task)" href="#alsek.core.task.Task">Task</a>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>collected tasks</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="NoTasksFoundError (alsek.exceptions.NoTasksFoundError)" href="#alsek.exceptions.NoTasksFoundError">NoTasksFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if no tasks can be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/scanning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magic_logger</span><span class="p">(</span>
    <span class="n">before</span><span class="o">=</span><span class="k">lambda</span> <span class="n">module</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scanning </span><span class="si">%r</span><span class="s2"> for tasks...&quot;</span><span class="p">,</span> <span class="n">module</span><span class="p">),</span>
    <span class="n">after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> task</span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">),</span>
        <span class="s2">&quot;s&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collect_tasks</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">ModuleType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Task</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recursively collect all tasks in ``name``.</span>

<span class="sd">    Args:</span>
<span class="sd">        module (str, ModuleType): name of a module</span>

<span class="sd">    Returns:</span>
<span class="sd">        module (tuple[Task, ...]): collected tasks</span>

<span class="sd">    Raises:</span>
<span class="sd">        NoTasksFoundError: if no tasks can be found</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">ModuleType</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported input type, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">all_tasks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Task</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_enumerate_modules</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">_is_task</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_tasks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">task</span> <span class="o">!=</span> <span class="n">all_tasks</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">TaskNameCollisionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple tasks &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_tasks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span>

    <span class="k">if</span> <span class="n">all_tasks</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_tasks</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoTasksFoundError</span><span class="p">(</span><span class="s2">&quot;No tasks found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.sorting" class="doc doc-heading">
            <code>sorting</code>


</h4>

    <div class="doc doc-contents ">

        <p>Sorting</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.sorting.dict_sort" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dict_sort</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Sort a dictionary by key.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dictionary</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a callable which consumes a key
and returns an object which supports the
less than comparison operator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sorted_dictionary</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>dictionary</code> sorted</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/sorting.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dict_sort</span><span class="p">(</span>
    <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sort a dictionary by key.</span>

<span class="sd">    Args:</span>
<span class="sd">        dictionary:</span>
<span class="sd">        key (callable): a callable which consumes a key</span>
<span class="sd">            and returns an object which supports the</span>
<span class="sd">            less than comparison operator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sorted_dictionary (dict): ``dictionary`` sorted</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">key</span> <span class="ow">or</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">))(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>  <span class="c1"># type: ignore</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.string" class="doc doc-heading">
            <code>string</code>


</h4>

    <div class="doc doc-contents ">

        <p>String Utils</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.string.smart_join" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smart_join</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Joins a list of strings with a delimiter, limiting the number of items to display
and optionally appending a continuation indicator or providing a grammatically
correct conjunction for the last two items.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>items</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of strings to be joined.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of items to include in the joined
string. If None, join all items without limiting.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delimiter</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string used to separate the items in the joined output.</p>
              </div>
            </td>
            <td>
                  <code>&#39;, &#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string containing the joined items, formatted according to the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specified delimiter and limits.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the <code>items</code> list is empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/string.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smart_join</span><span class="p">(</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Joins a list of strings with a delimiter, limiting the number of items to display</span>
<span class="sd">    and optionally appending a continuation indicator or providing a grammatically</span>
<span class="sd">    correct conjunction for the last two items.</span>

<span class="sd">    Args:</span>
<span class="sd">        items (list[str]): A list of strings to be joined.</span>
<span class="sd">        limit (Optional[int]): The maximum number of items to include in the joined</span>
<span class="sd">            string. If None, join all items without limiting.</span>
<span class="sd">        delimiter (str): The string used to separate the items in the joined output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string containing the joined items, formatted according to the</span>
<span class="sd">        specified delimiter and limits.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the `items` list is empty.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No items to join&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
        <span class="o">*</span><span class="n">start</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">items</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">last</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">[:</span><span class="n">limit</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.system" class="doc doc-heading">
            <code>system</code>


</h4>

    <div class="doc doc-contents ">

        <p>System Utils</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="alsek.utils.system.StopSignalListener" class="doc doc-heading">
            <code>StopSignalListener</code>


</h5>


    <div class="doc doc-contents ">


        <p>Tool for listing for stop signals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stop_signals</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one or more stop
signals to listen for.</p>
              </div>
            </td>
            <td>
                  <code><span title="alsek.utils.system.DEFAULT_STOP_SIGNALS">DEFAULT_STOP_SIGNALS</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exit_override</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trigger an immediate and non-graceful shutdown
of the current process if two or more SIGTERM or SIGINT signals
are received.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>alsek/utils/system.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StopSignalListener</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tool for listing for stop signals.</span>

<span class="sd">    Args:</span>
<span class="sd">        stop_signals (tuple[int, ...], optional): one or more stop</span>
<span class="sd">            signals to listen for.</span>
<span class="sd">        exit_override (bool): trigger an immediate and non-graceful shutdown</span>
<span class="sd">            of the current process if two or more SIGTERM or SIGINT signals</span>
<span class="sd">            are received.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stop_signals</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_STOP_SIGNALS</span><span class="p">,</span>
        <span class="n">exit_override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_signals</span> <span class="o">=</span> <span class="n">stop_signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_override</span> <span class="o">=</span> <span class="n">exit_override</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signals</span><span class="p">:</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_handler</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_signal_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signum</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Received stop signal </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">Signals</span><span class="p">(</span><span class="n">signum</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_override</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for a stop signal to be received.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeout (int, optional): amount of time</span>
<span class="sd">                (in milliseconds) to wait</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timeout</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">received</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether a stop signal has been received.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="alsek.utils.system.StopSignalListener.received" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">received</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Whether a stop signal has been received.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="alsek.utils.system.StopSignalListener.wait" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Wait for a stop signal to be received.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>amount of time
(in milliseconds) to wait</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/system.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wait for a stop signal to be received.</span>

<span class="sd">    Args:</span>
<span class="sd">        timeout (int, optional): amount of time</span>
<span class="sd">            (in milliseconds) to wait</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timeout</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="alsek.utils.system.smart_cpu_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smart_cpu_count</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Count the number of CPUs, with one reserved
for the main process.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>count</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of cpus</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/system.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smart_cpu_count</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of CPUs, with one reserved</span>
<span class="sd">    for the main process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        count (int): number of cpus</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.system.thread_raise" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">thread_raise</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Raise an exception in a thread asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ident</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ident of the thread</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exception</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="BaseException">BaseException</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>type of exception to raise in the thread</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="references" open>
  <summary>References</summary>
  <ul>
<li>https://docs.python.org/3/c-api/init.html#c.PyThreadState_SetAsyncExc</li>
</ul>
</details>

<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Intended for use with CPython only</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>alsek/utils/system.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">thread_raise</span><span class="p">(</span><span class="n">ident</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise an exception in a thread asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        ident (int): ident of the thread</span>
<span class="sd">        exception (Type[BaseException]): type of exception to raise in the thread</span>

<span class="sd">    References:</span>
<span class="sd">        * https://docs.python.org/3/c-api/init.html#c.PyThreadState_SetAsyncExc</span>

<span class="sd">    Warning:</span>
<span class="sd">        * Intended for use with CPython only</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyThreadState_SetAsyncExc</span><span class="p">(</span>
        <span class="n">_cast_ident_to_ctype</span><span class="p">(</span><span class="n">ident</span><span class="p">),</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">(</span><span class="n">exception</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raising </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2"> in thread </span><span class="si">{</span><span class="n">ident</span><span class="si">}</span><span class="s2"> modified </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> threads&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.temporal" class="doc doc-heading">
            <code>temporal</code>


</h4>

    <div class="doc doc-contents ">

        <p>Temporal Utils</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.temporal.from_timestamp_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_timestamp_ms</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Construct datetime object from UTC timestamp in milliseconds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>timestamp</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UTC time in milliseconds</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>datetime</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/temporal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_timestamp_ms</span><span class="p">(</span><span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct datetime object from UTC timestamp in milliseconds.</span>

<span class="sd">    Args:</span>
<span class="sd">        timestamp (int): UTC time in milliseconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        datetime</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.temporal.time_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">time_ms</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the current time since the Epoch in milliseconds.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>time</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current time in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/temporal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">time_ms</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current time since the Epoch in milliseconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        time (int): current time in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="alsek.utils.temporal.utcnow_timestamp_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">utcnow_timestamp_ms</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>UTC timestamp in milliseconds.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>timestamp</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UTC time in milliseconds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/temporal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">utcnow_timestamp_ms</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;UTC timestamp in milliseconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        timestamp (int): UTC time in milliseconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="alsek.utils.waiting" class="doc doc-heading">
            <code>waiting</code>


</h4>

    <div class="doc doc-contents ">

        <p>Waiting</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="alsek.utils.waiting.waiter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">waiter</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">sleep_interval</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Wait for <code>condition</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>condition</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>condition to wait for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sleep_interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time (in milliseconds) to sleep
between checks of <code>condition</code>.</p>
              </div>
            </td>
            <td>
                  <code>1 * 1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum amount of time (in milliseconds)
this function can wait for <code>condition</code> to evaluate
to <code>True</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout_msg</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message to display in the
event of a timeout</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>alsek/utils/waiting.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">waiter</span><span class="p">(</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">bool</span><span class="p">],</span>
    <span class="n">sleep_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout_msg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wait for ``condition``.</span>

<span class="sd">    Args:</span>
<span class="sd">        condition (callable): condition to wait for</span>
<span class="sd">        sleep_interval (int): time (in milliseconds) to sleep</span>
<span class="sd">            between checks of ``condition``.</span>
<span class="sd">        timeout (int, optional): maximum amount of time (in milliseconds)</span>
<span class="sd">            this function can wait for ``condition`` to evaluate</span>
<span class="sd">            to ``True``.</span>
<span class="sd">        timeout_msg (str, optional): message to display in the</span>
<span class="sd">            event of a timeout</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time_ms</span><span class="p">()</span>
    <span class="n">stop_signal</span> <span class="o">=</span> <span class="n">StopSignalListener</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stop_signal</span><span class="o">.</span><span class="n">received</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">condition</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time_ms</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="n">timeout_msg</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stop_signal</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">sleep_interval</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span> <span class="k">if</span> <span class="n">timeout</span> <span class="k">else</span> <span class="n">sleep_interval</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2025 Tariq Hassan
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>